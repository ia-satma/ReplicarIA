â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“š ESTRUCTURA DE KB LEGAL - ARTÃCULOS CLAVE PARA AGENTES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: Indexar SOLO los artÃ­culos y fracciones clave, estructurados para
que los agentes puedan citarlos correctamente en sus anÃ¡lisis y Defense Files.

FORMATO ESTÃNDAR:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Cada artÃ­culo tendrÃ¡ dos bloques:
â€¢ [NORMA] - Texto literal de la ley
â€¢ [INTERPRETACIÃ“N REVISAR-IA] - CÃ³mo lo usa cada agente

SISTEMA DE TAGS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
@CFF_5A      â†’ Art. 5-A del CFF
@LISR_27_I   â†’ Art. 27 fracciÃ³n I de LISR
@LIVA_5      â†’ Art. 5 de LIVA

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PARTE 1: ESTRUCTURA DE ARCHIVOS EN KB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

```
kb_legal/
â”‚
â”œâ”€â”€ CFF/
â”‚   â”œâ”€â”€ CFF_ART_5_INTERPRETACION.md
â”‚   â”œâ”€â”€ CFF_ART_5A_RAZON_NEGOCIOS.md      â† CRÃTICO
â”‚   â”œâ”€â”€ CFF_ART_29_29A_CFDI.md            â† CRÃTICO
â”‚   â”œâ”€â”€ CFF_ART_32D_OPINION_CUMPLIMIENTO.md
â”‚   â”œâ”€â”€ CFF_ART_69_CONTRIBUYENTES_INCUMPLIDOS.md
â”‚   â””â”€â”€ CFF_ART_69B_EFOS_MATERIALIDAD.md  â† CRÃTICO
â”‚
â”œâ”€â”€ LISR/
â”‚   â”œâ”€â”€ LISR_ART_25_DEDUCCIONES_AUTORIZADAS.md
â”‚   â”œâ”€â”€ LISR_ART_27_REQUISITOS_DEDUCCIONES.md  â† CRÃTICO (todas las fracciones)
â”‚   â””â”€â”€ LISR_ART_28_GASTOS_NO_DEDUCIBLES.md
â”‚
â”œâ”€â”€ LIVA/
â”‚   â””â”€â”€ LIVA_ART_5_ACREDITAMIENTO_IVA.md  â† CRÃTICO
â”‚
â”œâ”€â”€ RMF/
â”‚   â””â”€â”€ RMF_CFDI_RETENCIONES.md
â”‚
â”œâ”€â”€ OTRAS_LEYES/
â”‚   â”œâ”€â”€ NOM_151_VALOR_PROBATORIO.md
â”‚   â”œâ”€â”€ LFPCA_DEFENSA_CONTENCIOSA.md
â”‚   â”œâ”€â”€ LFDC_DERECHOS_CONTRIBUYENTE.md
â”‚   â””â”€â”€ LFPIORPI_ACTIVIDADES_VULNERABLES.md
â”‚
â””â”€â”€ TESIS_CRITERIOS/
    â”œâ”€â”€ TESIS_SCJN_IA_HERRAMIENTA_AUXILIAR.md
    â”œâ”€â”€ TESIS_RAZON_NEGOCIOS_5A_CFF.md
    â”œâ”€â”€ TESIS_MATERIALIDAD_69B_CFF.md
    â””â”€â”€ TESIS_ESTRICTA_INDISPENSABILIDAD_LISR27.md
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PARTE 2: FORMATO DE CADA DOCUMENTO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Ejemplo: CFF_ART_5A_RAZON_NEGOCIOS.md

```markdown
---
id: CFF_5A
ley: CÃ³digo Fiscal de la FederaciÃ³n
articulo: 5-A
titulo: RazÃ³n de negocios
vigencia: 2020-01-01
tags: [razon_negocios, simulacion, recaracterizacion, A1, A3, A7]
prioridad: critica
---

# @CFF_5A - RazÃ³n de Negocios

## [NORMA]

**ArtÃ­culo 5o.-A.** Los actos jurÃ­dicos que carezcan de una razÃ³n de negocios 
y que generen un beneficio fiscal directo o indirecto, tendrÃ¡n los efectos 
fiscales que correspondan a los que se habrÃ­an realizado para la obtenciÃ³n 
del beneficio econÃ³mico razonablemente esperado por el contribuyente.

En el ejercicio de sus facultades de comprobaciÃ³n, la autoridad fiscal podrÃ¡ 
presumir que los actos jurÃ­dicos carecen de una razÃ³n de negocios con base en 
los hechos y circunstancias del contribuyente conocidos al amparo de dichas 
facultades, asÃ­ como de la valoraciÃ³n de los elementos, la informaciÃ³n y 
documentaciÃ³n obtenidos durante las mismas.

Se considera que existe una razÃ³n de negocios cuando el beneficio econÃ³mico 
razonablemente esperado, sea mayor al beneficio fiscal.

[...]

**Fuente:** https://www.diputados.gob.mx/LeyesBiblio/pdf/CFF.pdf
**Ãšltima reforma:** [fecha]

---

## [INTERPRETACIÃ“N REVISAR-IA]

### Uso por Agentes:

| Agente | CÃ³mo lo usa |
|--------|-------------|
| **A1 (Facturar.IA)** | EvalÃºa si la operaciÃ³n tiene razÃ³n de negocios vÃ¡lida |
| **A3 (Revisar.IA)** | Analiza riesgo de recaracterizaciÃ³n por falta de RN |
| **A5 (Investigar.IA)** | Documenta beneficio econÃ³mico vs beneficio fiscal |
| **A7 (Auditar.IA)** | Construye defensa demostrando RN en el Defense File |

### Elementos a documentar para cumplir:

1. **Beneficio econÃ³mico esperado**
   - Â¿QuÃ© ganancia real obtiene el contribuyente?
   - Â¿Es mayor al beneficio fiscal?

2. **Sustancia sobre forma**
   - Â¿La operaciÃ³n tiene realidad econÃ³mica?
   - Â¿Hay flujo real de servicios/bienes?

3. **Evidencia requerida**
   - Contratos con detalle de servicios
   - Entregables documentados
   - Pagos trazables (transferencia bancaria)
   - Correspondencia comercial

### Riesgos si no se cumple:

- RecaracterizaciÃ³n de la operaciÃ³n
- Rechazo de deducciones
- Posible simulaciÃ³n (Art. 2180-2184 CC)

### Tesis relacionadas:

- Ver @TESIS_RN_001, @TESIS_RN_002

### Ejemplo de aplicaciÃ³n:

> **Caso:** Empresa A paga "servicios de consultorÃ­a" a Empresa B (parte relacionada)
> por $10 millones sin entregables claros.
>
> **AnÃ¡lisis A3:** âš ï¸ RIESGO ALTO - Sin evidencia de beneficio econÃ³mico 
> razonablemente esperado. Posible falta de razÃ³n de negocios.
>
> **RecomendaciÃ³n:** Documentar entregables especÃ­ficos, horas trabajadas,
> expertise aportado, y comparar con precios de mercado.

---

## Referencias cruzadas

- @CFF_5 (InterpretaciÃ³n estricta)
- @LISR_27_XIX (Partes relacionadas)
- @TESIS_RN_001 (RazÃ³n de negocios SCJN)
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PARTE 3: DOCUMENTOS CRÃTICOS A CREAR (PRIORIDAD 1)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

### 3.1 CFF_ART_69B_EFOS_MATERIALIDAD.md

```markdown
---
id: CFF_69B
ley: CÃ³digo Fiscal de la FederaciÃ³n
articulo: 69-B
titulo: Operaciones inexistentes (EFOS/EDOS)
tags: [efos, edos, materialidad, 69b, lista_negra, A3, A6, A7]
prioridad: critica
---

# @CFF_69B - Operaciones Inexistentes (EFOS/EDOS)

## [NORMA]

**ArtÃ­culo 69-B.** Cuando la autoridad fiscal detecte que un contribuyente ha 
estado emitiendo comprobantes sin contar con los activos, personal, infraestructura 
o capacidad material, directa o indirectamente, para prestar los servicios o 
producir, comercializar o entregar los bienes que amparan tales comprobantes, 
o bien, que dichos contribuyentes se encuentren no localizados, se presumirÃ¡ 
la inexistencia de las operaciones amparadas en tales comprobantes.

[Procedimiento de presuntos y definitivos...]

**Los contribuyentes que hayan dado cualquier efecto fiscal a los comprobantes 
fiscales expedidos por un contribuyente incluido en el listado a que se refiere 
el cuarto pÃ¡rrafo de este artÃ­culo, contarÃ¡n con treinta dÃ­as siguientes al de 
la citada publicaciÃ³n para acreditar ante la propia autoridad, que efectivamente 
adquirieron los bienes o recibieron los servicios que amparan los citados 
comprobantes fiscales, o bien procederÃ¡n en el mismo plazo a corregir su 
situaciÃ³n fiscal...**

---

## [INTERPRETACIÃ“N REVISAR-IA]

### Procedimiento 69-B:

```
1. SAT detecta indicios de EFOS
         â†“
2. Publica en DOF como "PRESUNTO" (1er listado)
         â†“
3. Contribuyente tiene 15 dÃ­as para aportar pruebas
         â†“
4. Si no desvirtÃºa â†’ Publica como "DEFINITIVO" (2do listado)
         â†“
5. Clientes del EFOS tienen 30 dÃ­as para:
   a) Acreditar materialidad, O
   b) Autocorregirse
```

### Uso por Agentes:

| Agente | AcciÃ³n |
|--------|--------|
| **A3** | Verifica si proveedor estÃ¡ en lista 69-B (presunto/definitivo) |
| **A6** | Consulta automÃ¡tica de Lista 69-B para cada proveedor |
| **A7** | Prepara Defense File con evidencia de materialidad |

### Evidencia de materialidad requerida:

1. **Capacidad del proveedor**
   - Â¿Tiene empleados?
   - Â¿Tiene infraestructura?
   - Â¿Tiene domicilio localizable?

2. **Realidad de la operaciÃ³n**
   - Contrato firmado
   - Entregables recibidos
   - Evidencia fotogrÃ¡fica (si aplica)
   - Comunicaciones (emails, WhatsApp)

3. **Flujo financiero**
   - Pago por transferencia bancaria
   - Estado de cuenta mostrando el pago
   - ConciliaciÃ³n bancaria

4. **Razonabilidad**
   - Precio de mercado
   - RelaciÃ³n comercial previa
   - Necesidad del servicio/bien

### Niveles de riesgo para A3:

| Status proveedor | Riesgo | AcciÃ³n |
|------------------|--------|--------|
| No publicado | âœ… Bajo | Documentar materialidad preventivamente |
| Presunto | âš ï¸ Alto | Preparar defensa, juntar evidencia YA |
| Definitivo | ğŸ”´ CrÃ­tico | 30 dÃ­as para acreditar o autocorregir |
| Desvirtuado | âœ… OK | Conservar constancia de desvirtuaciÃ³n |
| Sentencia favorable | âœ… OK | Conservar sentencia |

### Consecuencias si no se acredita:

- Rechazo de deducciÃ³n
- Rechazo de acreditamiento de IVA
- Posible responsabilidad solidaria
- Multas 55% al 75% de contribuciones omitidas
```

---

### 3.2 LISR_ART_27_REQUISITOS_DEDUCCIONES.md

```markdown
---
id: LISR_27
ley: Ley del Impuesto sobre la Renta
articulo: 27
titulo: Requisitos de las deducciones
tags: [deducciones, requisitos, A1, A3, A5, A7]
prioridad: critica
---

# @LISR_27 - Requisitos de las Deducciones

## [NORMA]

**ArtÃ­culo 27.** Las deducciones autorizadas en este TÃ­tulo deberÃ¡n reunir 
los siguientes requisitos:

---

### FracciÃ³n I - Estrictamente indispensables @LISR_27_I

> **I.** Ser estrictamente indispensables para los fines de la actividad del 
> contribuyente, salvo que se trate de donativos no onerosos ni remunerativos...

**[INTERPRETACIÃ“N]**

| Agente | Uso |
|--------|-----|
| A1 | EvalÃºa si el gasto es necesario para el giro del negocio |
| A3 | Verifica relaciÃ³n gasto-actividad en cada CFDI |
| A7 | Justifica indispensabilidad en Defense File |

**Checklist de indispensabilidad:**
- [ ] Â¿El gasto estÃ¡ relacionado con la actividad econÃ³mica?
- [ ] Â¿Sin este gasto, podrÃ­a operar el negocio?
- [ ] Â¿Es proporcional al tamaÃ±o/volumen de operaciones?
- [ ] Â¿Hay evidencia de que se utilizÃ³ para generar ingresos?

---

### FracciÃ³n III - Amparadas con CFDI @LISR_27_III

> **III.** Estar amparadas con un comprobante fiscal y que los pagos cuyo 
> monto exceda de $2,000.00 se efectÃºen mediante transferencia electrÃ³nica...

**[INTERPRETACIÃ“N]**

**Requisitos del CFDI:**
- UUID vÃ¡lido y vigente
- RFC emisor correcto
- RFC receptor correcto
- Uso de CFDI apropiado
- MÃ©todo de pago correcto (PUE/PPD)
- Forma de pago correcta

**Validaciones automÃ¡ticas de A3:**
```
âœ“ CFDI existe en SAT
âœ“ Status: Vigente (no cancelado)
âœ“ RFC emisor activo
âœ“ Datos fiscales correctos
```

---

### FracciÃ³n IV - Forma de pago @LISR_27_IV

> **IV.** Estar debidamente registradas en contabilidad y que sean restadas 
> una sola vez...
> 
> TratÃ¡ndose de pagos cuyo monto exceda de $2,000.00, Ã©stos deberÃ¡n efectuarse 
> mediante cheque nominativo, tarjeta de crÃ©dito, de dÃ©bito, de servicios, 
> o monedero electrÃ³nico, o transferencia electrÃ³nica de fondos...

**[INTERPRETACIÃ“N]**

| Monto | Forma de pago requerida |
|-------|-------------------------|
| â‰¤ $2,000 | Cualquiera (incluso efectivo) |
| > $2,000 | Bancarizado obligatorio |

**VerificaciÃ³n de A3:**
- Forma de pago en CFDI vs monto
- Si > $2,000 y forma_pago = "01" (efectivo) â†’ âš ï¸ NO DEDUCIBLE

---

### FracciÃ³n XVIII - Registro en contabilidad @LISR_27_XVIII

> **XVIII.** Que al realizar las operaciones correspondientes o a mÃ¡s tardar 
> el Ãºltimo dÃ­a del ejercicio se reÃºnan los requisitos que para cada deducciÃ³n 
> en particular establece esta Ley...

**[INTERPRETACIÃ“N]**

**Evidencia requerida:**
- PÃ³liza contable con referencia al CFDI
- Cuenta contable apropiada
- Fecha de registro dentro del ejercicio

---

### FracciÃ³n XIX - Partes relacionadas @LISR_27_XIX

> **XIX.** Que tratÃ¡ndose de pagos efectuados a personas morales que se 
> consideren partes relacionadas, el precio o monto de la contraprestaciÃ³n 
> sea igual al que hubieran pactado partes independientes en operaciones 
> comparables...

**[INTERPRETACIÃ“N]**

**CRÃTICO para servicios intra-grupo (management fees):**

| VerificaciÃ³n | Agente |
|--------------|--------|
| Â¿Es parte relacionada? | A3, A6 |
| Â¿Precio es de mercado? | A5 |
| Â¿Hay estudio de precios de transferencia? | A3 |
| Â¿Se documenta la metodologÃ­a? | A7 |

**Riesgo si no se cumple:**
- Rechazo total de la deducciÃ³n
- Ajuste a valores de mercado
- Posible recaracterizaciÃ³n (@CFF_5A)

---

## Resumen: Checklist A3 para cada CFDI

```
â–¡ @LISR_27_I   Â¿Es estrictamente indispensable?
â–¡ @LISR_27_III Â¿Tiene CFDI vÃ¡lido y vigente?
â–¡ @LISR_27_IV  Â¿Forma de pago correcta (>$2,000 bancarizado)?
â–¡ @LISR_27_XVIII Â¿Registrado en contabilidad?
â–¡ @LISR_27_XIX Â¿Si es parte relacionada, precio de mercado?
â–¡ @CFF_69B     Â¿Proveedor NO estÃ¡ en lista 69-B?
â–¡ @CFF_5A      Â¿Tiene razÃ³n de negocios?
```
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PARTE 4: TABLA DE METADATOS PARA BD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

```sql
-- Tabla para indexar artÃ­culos legales
CREATE TABLE IF NOT EXISTS kb_articulos_legales (
    id SERIAL PRIMARY KEY,
    
    -- IdentificaciÃ³n
    tag VARCHAR(50) UNIQUE NOT NULL,  -- @CFF_5A, @LISR_27_I
    ley VARCHAR(100) NOT NULL,
    articulo VARCHAR(20) NOT NULL,
    fraccion VARCHAR(20),
    titulo VARCHAR(255),
    
    -- Contenido
    texto_norma TEXT NOT NULL,
    interpretacion TEXT,
    
    -- ClasificaciÃ³n
    prioridad VARCHAR(20),  -- critica, alta, media, baja
    categoria VARCHAR(50),  -- deducciones, cfdi, efos, defensa
    
    -- Uso por agentes
    agentes_usan TEXT[],  -- {A1, A3, A7}
    
    -- Documento KB relacionado
    kb_documento_id INTEGER REFERENCES kb_documentos(id),
    
    -- Fuente
    url_fuente TEXT,
    ultima_reforma DATE,
    
    -- Metadata
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- Ãndices
CREATE INDEX idx_articulos_tag ON kb_articulos_legales(tag);
CREATE INDEX idx_articulos_ley ON kb_articulos_legales(ley);
CREATE INDEX idx_articulos_categoria ON kb_articulos_legales(categoria);

-- Insertar artÃ­culos crÃ­ticos
INSERT INTO kb_articulos_legales (tag, ley, articulo, fraccion, titulo, prioridad, categoria, agentes_usan) VALUES
-- CFF
('@CFF_5', 'CFF', '5', NULL, 'InterpretaciÃ³n de normas fiscales', 'alta', 'interpretacion', '{A3,A7}'),
('@CFF_5A', 'CFF', '5-A', NULL, 'RazÃ³n de negocios', 'critica', 'razon_negocios', '{A1,A3,A5,A7}'),
('@CFF_29', 'CFF', '29', NULL, 'ObligaciÃ³n de expedir CFDI', 'critica', 'cfdi', '{A3}'),
('@CFF_29A', 'CFF', '29-A', NULL, 'Requisitos de CFDI', 'critica', 'cfdi', '{A3}'),
('@CFF_32D', 'CFF', '32-D', NULL, 'OpiniÃ³n de cumplimiento', 'alta', 'verificacion', '{A6}'),
('@CFF_69', 'CFF', '69', NULL, 'Contribuyentes incumplidos', 'alta', 'verificacion', '{A3,A6}'),
('@CFF_69B', 'CFF', '69-B', NULL, 'EFOS/EDOS Materialidad', 'critica', 'efos', '{A3,A6,A7}'),

-- LISR
('@LISR_25', 'LISR', '25', NULL, 'Deducciones autorizadas', 'alta', 'deducciones', '{A3}'),
('@LISR_27_I', 'LISR', '27', 'I', 'Estrictamente indispensables', 'critica', 'deducciones', '{A1,A3,A5,A7}'),
('@LISR_27_III', 'LISR', '27', 'III', 'Amparadas con CFDI', 'critica', 'deducciones', '{A3}'),
('@LISR_27_IV', 'LISR', '27', 'IV', 'Forma de pago', 'critica', 'deducciones', '{A3,A5}'),
('@LISR_27_XVIII', 'LISR', '27', 'XVIII', 'Registro en contabilidad', 'alta', 'deducciones', '{A3}'),
('@LISR_27_XIX', 'LISR', '27', 'XIX', 'Partes relacionadas', 'critica', 'deducciones', '{A3,A5,A7}'),
('@LISR_28', 'LISR', '28', NULL, 'Gastos no deducibles', 'alta', 'deducciones', '{A3}'),

-- LIVA
('@LIVA_5', 'LIVA', '5', NULL, 'Acreditamiento del IVA', 'critica', 'iva', '{A3,A5}'),

-- Otras
('@NOM_151', 'NOM-151-SCFI-2016', NULL, NULL, 'Valor probatorio digital', 'alta', 'probatorio', '{A2,A7}'),
('@LFPCA', 'LFPCA', NULL, NULL, 'Procedimiento contencioso', 'alta', 'defensa', '{A7}'),
('@LFDC', 'LFDC', NULL, NULL, 'Derechos del contribuyente', 'media', 'defensa', '{A7}')

ON CONFLICT (tag) DO NOTHING;
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PARTE 5: CÃ“MO LOS AGENTES USAN LOS TAGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

### En el prompt de cada agente:

```python
SYSTEM_PROMPT_A3 = """
Eres Revisar.IA (A3), agente de anÃ¡lisis de deducciones.

Cuando analices un CFDI, verifica estos requisitos y CITA el fundamento:

CHECKLIST DE DEDUCIBILIDAD:
1. @LISR_27_I - Â¿Es estrictamente indispensable para el giro?
2. @LISR_27_III - Â¿CFDI vÃ¡lido y vigente en SAT?
3. @LISR_27_IV - Â¿Forma de pago correcta (>$2,000 bancarizado)?
4. @CFF_69B - Â¿Proveedor NO en lista 69-B?
5. @CFF_5A - Â¿Tiene razÃ³n de negocios documentada?

Para cada punto, indica:
- âœ… Cumple [fundamento]
- âš ï¸ Revisar [fundamento + riesgo]
- âŒ No cumple [fundamento + consecuencia]

SIEMPRE cita el artÃ­culo usando el tag (@LISR_27_I, @CFF_69B, etc.)
"""
```

### En la respuesta del agente:

```
ANÃLISIS DE CFDI: 8A3D4F2E-...

1. Estrictamente indispensable (@LISR_27_I)
   âœ… CUMPLE - El servicio de contabilidad es necesario para 
   cumplir obligaciones fiscales del contribuyente.

2. CFDI vÃ¡lido (@LISR_27_III)
   âœ… CUMPLE - UUID validado ante SAT, status: Vigente

3. Forma de pago (@LISR_27_IV)
   âš ï¸ REVISAR - Monto $15,000, forma de pago "01" (efectivo)
   â†’ Riesgo: NO DEDUCIBLE por exceder $2,000 en efectivo

4. Lista 69-B (@CFF_69B)
   âœ… CUMPLE - Proveedor no publicado en listas

5. RazÃ³n de negocios (@CFF_5A)
   âš ï¸ REVISAR - No se encontrÃ³ contrato ni entregables
   â†’ RecomendaciÃ³n: Documentar alcance del servicio

CONCLUSIÃ“N: PARCIALMENTE DEDUCIBLE
Fundamentos: @LISR_27_IV viola requisito de bancarizaciÃ³n
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PARTE 6: FUNCIÃ“N PARA BUSCAR ARTÃCULOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

```python
# backend/services/kb/articulos_legales.py

from sqlalchemy import text
from database import db
from typing import List, Dict, Optional


def buscar_articulo(tag: str) -> Optional[Dict]:
    """Busca un artÃ­culo por su tag (@CFF_5A, @LISR_27_I, etc.)"""
    
    result = db.session.execute(text("""
        SELECT * FROM kb_articulos_legales WHERE tag = :tag
    """), {'tag': tag}).fetchone()
    
    if result:
        return dict(result._mapping)
    return None


def buscar_articulos_por_categoria(categoria: str) -> List[Dict]:
    """Busca artÃ­culos por categorÃ­a (deducciones, efos, etc.)"""
    
    result = db.session.execute(text("""
        SELECT * FROM kb_articulos_legales 
        WHERE categoria = :cat
        ORDER BY prioridad DESC, tag
    """), {'cat': categoria})
    
    return [dict(r._mapping) for r in result]


def obtener_fundamentos_para_deduccion() -> List[Dict]:
    """Obtiene todos los fundamentos para anÃ¡lisis de deducciones"""
    
    tags_deduccion = [
        '@LISR_27_I', '@LISR_27_III', '@LISR_27_IV', 
        '@LISR_27_XVIII', '@LISR_27_XIX',
        '@CFF_69B', '@CFF_5A'
    ]
    
    result = db.session.execute(text("""
        SELECT tag, titulo, texto_norma, interpretacion
        FROM kb_articulos_legales 
        WHERE tag = ANY(:tags)
        ORDER BY 
            CASE tag
                WHEN '@LISR_27_I' THEN 1
                WHEN '@LISR_27_III' THEN 2
                WHEN '@LISR_27_IV' THEN 3
                WHEN '@CFF_69B' THEN 4
                WHEN '@CFF_5A' THEN 5
                ELSE 10
            END
    """), {'tags': tags_deduccion})
    
    return [dict(r._mapping) for r in result]


def generar_contexto_legal_para_agente(agente_id: str) -> str:
    """Genera el contexto legal relevante para un agente especÃ­fico"""
    
    result = db.session.execute(text("""
        SELECT tag, titulo, interpretacion
        FROM kb_articulos_legales 
        WHERE :agente = ANY(agentes_usan)
        AND prioridad IN ('critica', 'alta')
        ORDER BY prioridad DESC
    """), {'agente': agente_id})
    
    articulos = list(result)
    
    if not articulos:
        return ""
    
    contexto = "FUNDAMENTOS LEGALES DISPONIBLES:\n\n"
    for art in articulos:
        contexto += f"â€¢ {art.tag} - {art.titulo}\n"
    
    return contexto
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PARTE 7: LISTA PRIORIZADA DE IMPLEMENTACIÃ“N
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PRIORIDAD 1 (Esta semana):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â–¡ Crear tabla kb_articulos_legales
â–¡ Insertar artÃ­culos crÃ­ticos (CFF 5-A, 69-B, LISR 27)
â–¡ Crear CFF_ART_69B_EFOS_MATERIALIDAD.md
â–¡ Crear LISR_ART_27_REQUISITOS_DEDUCCIONES.md
â–¡ Crear LIVA_ART_5_ACREDITAMIENTO_IVA.md

PRIORIDAD 2 (Siguiente semana):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â–¡ Crear CFF_ART_29_29A_CFDI.md
â–¡ Crear CFF_ART_5A_RAZON_NEGOCIOS.md
â–¡ Crear tesis (IA, razÃ³n de negocios, materialidad)
â–¡ Integrar tags en prompts de A3

PRIORIDAD 3 (DespuÃ©s):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â–¡ Crear documentos de otras leyes (LFPCA, NOM-151)
â–¡ Agregar mÃ¡s fracciones de LISR 27/28
â–¡ Crear RMF_CFDI_RETENCIONES.md

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RESUMEN: TAGS MÃNIMOS PARA FUNCIONAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

TAGS CRÃTICOS (10):
@CFF_5A      - RazÃ³n de negocios
@CFF_69B     - EFOS/Materialidad  
@CFF_29A     - Requisitos CFDI
@CFF_32D     - OpiniÃ³n cumplimiento
@LISR_27_I   - Estrictamente indispensable
@LISR_27_III - Amparado con CFDI
@LISR_27_IV  - Forma de pago
@LISR_27_XIX - Partes relacionadas
@LISR_28     - No deducibles
@LIVA_5      - Acreditamiento IVA

Con estos 10 tags, los agentes pueden fundamentar el 90% de los anÃ¡lisis
de deducciones de servicios profesionales.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
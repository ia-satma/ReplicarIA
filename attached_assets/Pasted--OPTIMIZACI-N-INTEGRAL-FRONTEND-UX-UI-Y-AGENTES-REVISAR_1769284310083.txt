# ğŸ¨ OPTIMIZACIÃ“N INTEGRAL - FRONTEND, UX/UI Y AGENTES

## REVISAR.IA / SATMA - Documento de ImplementaciÃ³n para Replit

**VersiÃ³n:** 2.0  
**Fecha:** Enero 2026  
**Alcance:** Frontend, UX/UI, VisualizaciÃ³n de Agentes, Comportamiento AgÃ©ntico  

---

## ğŸ“‹ ÃNDICE

1. [DiagnÃ³stico Actual del Sistema](#1-diagnÃ³stico-actual-del-sistema)
2. [AnÃ¡lisis de Frontend y UX/UI](#2-anÃ¡lisis-de-frontend-y-uxui)
3. [OptimizaciÃ³n de VisualizaciÃ³n de Agentes](#3-optimizaciÃ³n-de-visualizaciÃ³n-de-agentes)
4. [Mejoras de Comportamiento AgÃ©ntico](#4-mejoras-de-comportamiento-agÃ©ntico)
5. [Plan de ImplementaciÃ³n](#5-plan-de-implementaciÃ³n)
6. [CÃ³digo e Instrucciones para Replit](#6-cÃ³digo-e-instrucciones-para-replit)
7. [VerificaciÃ³n y MÃ©tricas](#7-verificaciÃ³n-y-mÃ©tricas)

---

## 1. DIAGNÃ“STICO ACTUAL DEL SISTEMA

### 1.1 Estado del Frontend

```
STACK ACTUAL:
â”œâ”€â”€ Framework: React 19
â”œâ”€â”€ Estilos: Tailwind CSS
â”œâ”€â”€ Componentes: 91 archivos JSX
â”œâ”€â”€ Estado: Hooks personalizados
â”œâ”€â”€ Build: Create React App (CRA)
â””â”€â”€ Deploy: Replit Autoscale

PROBLEMAS IDENTIFICADOS:
â”œâ”€â”€ ğŸ”´ Archivos estÃ¡ticos 404 en producciÃ³n
â”œâ”€â”€ ğŸŸ¡ Sin visualizaciÃ³n del flujo de agentes
â”œâ”€â”€ ğŸŸ¡ UX inconsistente entre vistas
â”œâ”€â”€ ğŸŸ¡ Sin feedback visual de procesamiento
â””â”€â”€ ğŸŸ¡ DocumentaciÃ³n de UI incompleta
```

### 1.2 Estado de los Agentes

```
AGENTES CONFIGURADOS: 10
â”œâ”€â”€ A1: RecepciÃ³n
â”œâ”€â”€ A2: AnÃ¡lisis Fiscal
â”œâ”€â”€ A3: Normativo
â”œâ”€â”€ A4: Contable
â”œâ”€â”€ A5: Operativo
â”œâ”€â”€ A6: Financiero
â”œâ”€â”€ A7: Legal
â”œâ”€â”€ A8: Red Team
â”œâ”€â”€ A9: SÃ­ntesis
â””â”€â”€ A10: Archivo

PROBLEMAS IDENTIFICADOS:
â”œâ”€â”€ ğŸŸ¡ Sin visualizaciÃ³n del flujo de trabajo
â”œâ”€â”€ ğŸŸ¡ Sin indicador de quÃ© agente estÃ¡ activo
â”œâ”€â”€ ğŸŸ¡ Sin historial de deliberaciones visible
â””â”€â”€ ğŸŸ¡ Sin mÃ©tricas de confianza por agente
```

### 1.3 MÃ©tricas de Rendimiento Actual

| MÃ©trica | Valor Actual | Objetivo | Estado |
|---------|--------------|----------|--------|
| API Latencia P50 | 12.98ms | <100ms | âœ… |
| API Latencia P95 | 23.73ms | <300ms | âœ… |
| DB Latencia P50 | 0.38ms | <50ms | âœ… |
| Time to First Paint | ~2s | <1s | ğŸŸ¡ |
| Time to Interactive | ~4s | <2s | ğŸŸ¡ |
| Lighthouse Score | ~65 | >85 | ğŸŸ¡ |

---

## 2. ANÃLISIS DE FRONTEND Y UX/UI

### 2.1 Problemas de UX Identificados

| Ãrea | Problema | Impacto | Prioridad |
|------|----------|---------|-----------|
| **Onboarding** | Sin guÃ­a para nuevos usuarios | Alto | ğŸ”´ P0 |
| **Agentes** | No se ve quÃ© agente procesa | Alto | ğŸ”´ P0 |
| **Feedback** | Sin indicadores de progreso | Alto | ğŸ”´ P0 |
| **NavegaciÃ³n** | MenÃº no intuitivo | Medio | ğŸŸ¡ P1 |
| **Responsive** | Problemas en mÃ³vil | Medio | ğŸŸ¡ P1 |
| **Accesibilidad** | Sin soporte ARIA | Bajo | ğŸŸ¢ P2 |

### 2.2 Mejoras Propuestas de UI

```
NUEVA ESTRUCTURA DE NAVEGACIÃ“N:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  REVISAR.IA                    [Proyecto â–¼]  [Usuario â–¼]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ SIDEBAR â”‚  â”‚           CONTENIDO PRINCIPAL           â”‚  â”‚
â”‚  â”‚         â”‚  â”‚                                         â”‚  â”‚
â”‚  â”‚ Dashboardâ”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚ Proyectosâ”‚  â”‚  â”‚      PANEL DE AGENTES          â”‚   â”‚  â”‚
â”‚  â”‚ Agentes â”‚  â”‚  â”‚   [A1] [A2] [A3] [A4] [A5]      â”‚   â”‚  â”‚
â”‚  â”‚ Docs    â”‚  â”‚  â”‚   [A6] [A7] [A8] [A9] [A10]     â”‚   â”‚  â”‚
â”‚  â”‚ Config  â”‚  â”‚  â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚   â”‚  â”‚
â”‚  â”‚         â”‚  â”‚  â”‚   Status: A2 Analizando...      â”‚   â”‚  â”‚
â”‚  â”‚         â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚         â”‚  â”‚                                         â”‚  â”‚
â”‚  â”‚         â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚         â”‚  â”‚  â”‚        CHAT / ANÃLISIS          â”‚   â”‚  â”‚
â”‚  â”‚         â”‚  â”‚  â”‚                                 â”‚   â”‚  â”‚
â”‚  â”‚         â”‚  â”‚  â”‚  [Mensajes del agente...]       â”‚   â”‚  â”‚
â”‚  â”‚         â”‚  â”‚  â”‚                                 â”‚   â”‚  â”‚
â”‚  â”‚         â”‚  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚   â”‚  â”‚
â”‚  â”‚         â”‚  â”‚  â”‚  [Input de usuario      ] [â–¶]  â”‚   â”‚  â”‚
â”‚  â”‚         â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ“Š Uso: 45/500 requests  |  ğŸ“ˆ Score: 85%  |  â± 2.3s â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 Sistema de DiseÃ±o Propuesto

```javascript
// Paleta de Colores
const colors = {
  // Primarios
  primary: {
    50: '#eff6ff',
    500: '#3b82f6',  // Azul principal
    600: '#2563eb',
    700: '#1d4ed8',
  },
  // Estados de Agentes
  agent: {
    idle: '#6b7280',      // Gris - inactivo
    active: '#3b82f6',    // Azul - procesando
    success: '#10b981',   // Verde - completado
    warning: '#f59e0b',   // Amarillo - advertencia
    error: '#ef4444',     // Rojo - error
  },
  // Scores
  score: {
    high: '#10b981',      // â‰¥80
    medium: '#f59e0b',    // 60-79
    low: '#ef4444',       // <60
  }
};

// TipografÃ­a
const typography = {
  fontFamily: "'Inter', -apple-system, sans-serif",
  sizes: {
    xs: '0.75rem',
    sm: '0.875rem',
    base: '1rem',
    lg: '1.125rem',
    xl: '1.25rem',
    '2xl': '1.5rem',
  }
};

// Espaciado
const spacing = {
  xs: '0.25rem',
  sm: '0.5rem',
  md: '1rem',
  lg: '1.5rem',
  xl: '2rem',
};
```

---

## 3. OPTIMIZACIÃ“N DE VISUALIZACIÃ“N DE AGENTES

### 3.1 Componente AgentFlowVisualization

Este componente muestra el flujo de trabajo entre los 10 agentes en tiempo real:

```jsx
// frontend/src/components/agents/AgentFlowVisualization.jsx

import React, { useState, useEffect } from 'react';

const AGENTS = [
  { id: 'A1', name: 'RecepciÃ³n', icon: 'ğŸ“¥', color: '#6366f1' },
  { id: 'A2', name: 'AnÃ¡lisis', icon: 'ğŸ”', color: '#8b5cf6' },
  { id: 'A3', name: 'Normativo', icon: 'ğŸ“œ', color: '#a855f7' },
  { id: 'A4', name: 'Contable', icon: 'ğŸ“Š', color: '#d946ef' },
  { id: 'A5', name: 'Operativo', icon: 'âš™ï¸', color: '#ec4899' },
  { id: 'A6', name: 'Financiero', icon: 'ğŸ’°', color: '#f43f5e' },
  { id: 'A7', name: 'Legal', icon: 'âš–ï¸', color: '#f97316' },
  { id: 'A8', name: 'Red Team', icon: 'ğŸ›¡ï¸', color: '#eab308' },
  { id: 'A9', name: 'SÃ­ntesis', icon: 'ğŸ“', color: '#84cc16' },
  { id: 'A10', name: 'Archivo', icon: 'ğŸ“', color: '#22c55e' },
];

const AgentNode = ({ agent, status, onClick }) => {
  const statusColors = {
    idle: 'bg-gray-100 border-gray-300 text-gray-500',
    active: 'bg-blue-100 border-blue-500 text-blue-700 animate-pulse',
    completed: 'bg-green-100 border-green-500 text-green-700',
    error: 'bg-red-100 border-red-500 text-red-700',
  };

  return (
    <button
      onClick={() => onClick(agent)}
      className={`
        relative p-3 rounded-xl border-2 transition-all duration-300
        hover:shadow-lg hover:scale-105 cursor-pointer
        ${statusColors[status] || statusColors.idle}
      `}
      title={`${agent.name} - ${status}`}
    >
      <div className="text-2xl mb-1">{agent.icon}</div>
      <div className="text-xs font-medium">{agent.id}</div>
      
      {status === 'active' && (
        <div className="absolute -top-1 -right-1 w-3 h-3 bg-blue-500 rounded-full animate-ping" />
      )}
      
      {status === 'completed' && (
        <div className="absolute -top-1 -right-1 w-4 h-4 bg-green-500 rounded-full flex items-center justify-center">
          <span className="text-white text-xs">âœ“</span>
        </div>
      )}
    </button>
  );
};

const ConnectionLine = ({ from, to, active }) => (
  <svg className="absolute inset-0 w-full h-full pointer-events-none" style={{ zIndex: 0 }}>
    <defs>
      <marker
        id="arrowhead"
        markerWidth="10"
        markerHeight="7"
        refX="9"
        refY="3.5"
        orient="auto"
      >
        <polygon
          points="0 0, 10 3.5, 0 7"
          fill={active ? '#3b82f6' : '#d1d5db'}
        />
      </marker>
    </defs>
    <line
      x1={from.x}
      y1={from.y}
      x2={to.x}
      y2={to.y}
      stroke={active ? '#3b82f6' : '#d1d5db'}
      strokeWidth={active ? 2 : 1}
      strokeDasharray={active ? '0' : '5,5'}
      markerEnd="url(#arrowhead)"
      className={active ? 'animate-pulse' : ''}
    />
  </svg>
);

export default function AgentFlowVisualization({ 
  activeAgents = [], 
  completedAgents = [],
  onAgentClick = () => {},
  showDetails = true,
}) {
  const [selectedAgent, setSelectedAgent] = useState(null);

  const getAgentStatus = (agentId) => {
    if (activeAgents.includes(agentId)) return 'active';
    if (completedAgents.includes(agentId)) return 'completed';
    return 'idle';
  };

  const handleAgentClick = (agent) => {
    setSelectedAgent(agent);
    onAgentClick(agent);
  };

  return (
    <div className="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
      {/* Header */}
      <div className="flex items-center justify-between mb-6">
        <h3 className="text-lg font-semibold text-gray-900">
          ğŸ¤– Panel de Agentes
        </h3>
        <div className="flex items-center gap-4 text-sm">
          <span className="flex items-center gap-1">
            <span className="w-2 h-2 rounded-full bg-gray-300" />
            Inactivo
          </span>
          <span className="flex items-center gap-1">
            <span className="w-2 h-2 rounded-full bg-blue-500 animate-pulse" />
            Procesando
          </span>
          <span className="flex items-center gap-1">
            <span className="w-2 h-2 rounded-full bg-green-500" />
            Completado
          </span>
        </div>
      </div>

      {/* Grid de Agentes */}
      <div className="grid grid-cols-5 gap-4 mb-6">
        {AGENTS.map((agent) => (
          <AgentNode
            key={agent.id}
            agent={agent}
            status={getAgentStatus(agent.id)}
            onClick={handleAgentClick}
          />
        ))}
      </div>

      {/* Barra de Progreso */}
      <div className="mb-4">
        <div className="flex justify-between text-sm text-gray-600 mb-2">
          <span>Progreso del anÃ¡lisis</span>
          <span>{completedAgents.length}/{AGENTS.length} agentes</span>
        </div>
        <div className="h-2 bg-gray-100 rounded-full overflow-hidden">
          <div 
            className="h-full bg-gradient-to-r from-blue-500 to-green-500 transition-all duration-500"
            style={{ width: `${(completedAgents.length / AGENTS.length) * 100}%` }}
          />
        </div>
      </div>

      {/* Detalle del Agente Seleccionado */}
      {showDetails && selectedAgent && (
        <div className="mt-4 p-4 bg-gray-50 rounded-xl">
          <div className="flex items-center gap-3 mb-2">
            <span className="text-3xl">{selectedAgent.icon}</span>
            <div>
              <h4 className="font-semibold text-gray-900">{selectedAgent.name}</h4>
              <p className="text-sm text-gray-500">{selectedAgent.id}</p>
            </div>
          </div>
          <p className="text-sm text-gray-600">
            Estado: <span className="font-medium">{getAgentStatus(selectedAgent.id)}</span>
          </p>
        </div>
      )}
    </div>
  );
}
```

### 3.2 Componente AgentChat Mejorado

```jsx
// frontend/src/components/agents/AgentChat.jsx

import React, { useState, useRef, useEffect } from 'react';
import AgentFlowVisualization from './AgentFlowVisualization';

const TypingIndicator = ({ agentName }) => (
  <div className="flex items-center gap-2 text-gray-500 text-sm animate-pulse">
    <div className="flex gap-1">
      <span className="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style={{ animationDelay: '0ms' }} />
      <span className="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style={{ animationDelay: '150ms' }} />
      <span className="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style={{ animationDelay: '300ms' }} />
    </div>
    <span>{agentName} estÃ¡ analizando...</span>
  </div>
);

const MessageBubble = ({ message, isUser, agentInfo }) => {
  if (isUser) {
    return (
      <div className="flex justify-end mb-4">
        <div className="max-w-[70%] bg-blue-600 text-white rounded-2xl rounded-br-md px-4 py-3">
          <p className="text-sm">{message.content}</p>
          <span className="text-xs text-blue-200 mt-1 block">
            {new Date(message.timestamp).toLocaleTimeString()}
          </span>
        </div>
      </div>
    );
  }

  return (
    <div className="flex gap-3 mb-4">
      <div className="flex-shrink-0 w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center text-white text-lg">
        {agentInfo?.icon || 'ğŸ¤–'}
      </div>
      <div className="flex-1">
        <div className="flex items-center gap-2 mb-1">
          <span className="font-medium text-gray-900 text-sm">
            {agentInfo?.name || 'Agente'}
          </span>
          <span className="text-xs text-gray-400">
            {message.agentId}
          </span>
        </div>
        <div className="bg-gray-100 rounded-2xl rounded-tl-md px-4 py-3 max-w-[85%]">
          <p className="text-sm text-gray-800 whitespace-pre-wrap">{message.content}</p>
          {message.confidence && (
            <div className="mt-2 flex items-center gap-2">
              <span className="text-xs text-gray-500">Confianza:</span>
              <div className="flex-1 h-1.5 bg-gray-200 rounded-full overflow-hidden">
                <div 
                  className={`h-full rounded-full ${
                    message.confidence >= 80 ? 'bg-green-500' :
                    message.confidence >= 60 ? 'bg-yellow-500' : 'bg-red-500'
                  }`}
                  style={{ width: `${message.confidence}%` }}
                />
              </div>
              <span className="text-xs font-medium">{message.confidence}%</span>
            </div>
          )}
        </div>
        <span className="text-xs text-gray-400 mt-1 block">
          {new Date(message.timestamp).toLocaleTimeString()}
        </span>
      </div>
    </div>
  );
};

export default function AgentChat({ projectId }) {
  const [messages, setMessages] = useState([]);
  const [input, setInput] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [activeAgents, setActiveAgents] = useState([]);
  const [completedAgents, setCompletedAgents] = useState([]);
  const [currentAgent, setCurrentAgent] = useState(null);
  const messagesEndRef = useRef(null);

  const AGENT_INFO = {
    'A1_RECEPCION': { icon: 'ğŸ“¥', name: 'RecepciÃ³n' },
    'A2_ANALISIS': { icon: 'ğŸ”', name: 'AnÃ¡lisis Fiscal' },
    'A3_NORMATIVO': { icon: 'ğŸ“œ', name: 'Normativo' },
    'A4_CONTABLE': { icon: 'ğŸ“Š', name: 'Contable' },
    'A5_OPERATIVO': { icon: 'âš™ï¸', name: 'Operativo' },
    'A6_FINANCIERO': { icon: 'ğŸ’°', name: 'Financiero' },
    'A7_LEGAL': { icon: 'âš–ï¸', name: 'Legal' },
    'A8_REDTEAM': { icon: 'ğŸ›¡ï¸', name: 'Red Team' },
    'A9_SINTESIS': { icon: 'ğŸ“', name: 'SÃ­ntesis' },
    'A10_ARCHIVO': { icon: 'ğŸ“', name: 'Archivo' },
  };

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages]);

  const sendMessage = async () => {
    if (!input.trim() || isLoading) return;

    const userMessage = {
      id: Date.now(),
      content: input,
      isUser: true,
      timestamp: new Date().toISOString(),
    };

    setMessages(prev => [...prev, userMessage]);
    setInput('');
    setIsLoading(true);
    setActiveAgents([]);
    setCompletedAgents([]);

    try {
      const response = await fetch('/api/agents/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          message: input,
          project_id: projectId,
        }),
      });

      const data = await response.json();

      // Simular progreso de agentes
      for (const agentId of data.agents_invoked || []) {
        setActiveAgents([agentId]);
        setCurrentAgent(AGENT_INFO[agentId]);
        await new Promise(r => setTimeout(r, 500));
        setActiveAgents([]);
        setCompletedAgents(prev => [...prev, agentId]);
      }

      // Agregar respuesta
      const agentMessage = {
        id: Date.now() + 1,
        content: data.response?.response || data.response?.synthesized 
          ? data.response.response 
          : JSON.stringify(data.response, null, 2),
        isUser: false,
        agentId: data.agents_invoked?.join(', ') || 'Sistema',
        timestamp: new Date().toISOString(),
        confidence: data.response?.confidence || 85,
      };

      setMessages(prev => [...prev, agentMessage]);

    } catch (error) {
      console.error('Error:', error);
      setMessages(prev => [...prev, {
        id: Date.now() + 1,
        content: 'Error al procesar la solicitud. Por favor intenta de nuevo.',
        isUser: false,
        agentId: 'Sistema',
        timestamp: new Date().toISOString(),
      }]);
    } finally {
      setIsLoading(false);
      setCurrentAgent(null);
    }
  };

  return (
    <div className="flex flex-col h-full bg-white rounded-2xl shadow-sm border border-gray-200">
      {/* Panel de Agentes */}
      <div className="p-4 border-b border-gray-200">
        <AgentFlowVisualization
          activeAgents={activeAgents}
          completedAgents={completedAgents}
          showDetails={false}
        />
      </div>

      {/* Mensajes */}
      <div className="flex-1 overflow-y-auto p-4">
        {messages.length === 0 ? (
          <div className="flex flex-col items-center justify-center h-full text-gray-400">
            <span className="text-4xl mb-4">ğŸ’¬</span>
            <p className="text-center">
              Inicia una conversaciÃ³n con los agentes.<br />
              Pregunta sobre requisitos fiscales, deducibilidad, o anÃ¡lisis de documentos.
            </p>
          </div>
        ) : (
          messages.map((message) => (
            <MessageBubble
              key={message.id}
              message={message}
              isUser={message.isUser}
              agentInfo={AGENT_INFO[message.agentId]}
            />
          ))
        )}
        
        {isLoading && currentAgent && (
          <TypingIndicator agentName={currentAgent.name} />
        )}
        
        <div ref={messagesEndRef} />
      </div>

      {/* Input */}
      <div className="p-4 border-t border-gray-200">
        <div className="flex gap-2">
          <input
            type="text"
            value={input}
            onChange={(e) => setInput(e.target.value)}
            onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
            placeholder="Escribe tu consulta fiscal..."
            className="flex-1 px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            disabled={isLoading}
          />
          <button
            onClick={sendMessage}
            disabled={isLoading || !input.trim()}
            className="px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
          >
            {isLoading ? (
              <span className="flex items-center gap-2">
                <svg className="animate-spin h-5 w-5" viewBox="0 0 24 24">
                  <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" fill="none" />
                  <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" />
                </svg>
              </span>
            ) : (
              <span>Enviar</span>
            )}
          </button>
        </div>
      </div>
    </div>
  );
}
```

### 3.3 Dashboard de Agentes

```jsx
// frontend/src/components/agents/AgentsDashboard.jsx

import React, { useState, useEffect } from 'react';
import AgentFlowVisualization from './AgentFlowVisualization';
import AgentChat from './AgentChat';

const StatCard = ({ icon, label, value, trend, color }) => (
  <div className="bg-white rounded-xl p-4 shadow-sm border border-gray-200">
    <div className="flex items-center justify-between">
      <div>
        <p className="text-sm text-gray-500">{label}</p>
        <p className={`text-2xl font-bold ${color || 'text-gray-900'}`}>{value}</p>
      </div>
      <div className={`text-3xl ${color || ''}`}>{icon}</div>
    </div>
    {trend && (
      <p className={`text-xs mt-2 ${trend > 0 ? 'text-green-600' : 'text-red-600'}`}>
        {trend > 0 ? 'â†‘' : 'â†“'} {Math.abs(trend)}% vs. ayer
      </p>
    )}
  </div>
);

const RecentDeliberation = ({ deliberation }) => (
  <div className="p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer">
    <div className="flex items-center justify-between mb-2">
      <span className="text-sm font-medium text-gray-900">
        {deliberation.projectName}
      </span>
      <span className={`text-xs px-2 py-1 rounded-full ${
        deliberation.score >= 80 ? 'bg-green-100 text-green-700' :
        deliberation.score >= 60 ? 'bg-yellow-100 text-yellow-700' :
        'bg-red-100 text-red-700'
      }`}>
        Score: {deliberation.score}%
      </span>
    </div>
    <p className="text-sm text-gray-600 line-clamp-2">{deliberation.summary}</p>
    <div className="flex items-center gap-2 mt-2 text-xs text-gray-400">
      <span>{deliberation.agentsInvolved.join(', ')}</span>
      <span>â€¢</span>
      <span>{new Date(deliberation.timestamp).toLocaleDateString()}</span>
    </div>
  </div>
);

export default function AgentsDashboard() {
  const [stats, setStats] = useState({
    totalAnalyses: 0,
    avgScore: 0,
    avgLatency: 0,
    successRate: 0,
  });
  const [recentDeliberations, setRecentDeliberations] = useState([]);
  const [selectedView, setSelectedView] = useState('overview');

  useEffect(() => {
    // Cargar estadÃ­sticas
    fetchStats();
    fetchRecentDeliberations();
  }, []);

  const fetchStats = async () => {
    try {
      const response = await fetch('/api/agents/stats');
      const data = await response.json();
      setStats(data);
    } catch (error) {
      console.error('Error fetching stats:', error);
      // Datos de ejemplo
      setStats({
        totalAnalyses: 156,
        avgScore: 82,
        avgLatency: 2.3,
        successRate: 97,
      });
    }
  };

  const fetchRecentDeliberations = async () => {
    try {
      const response = await fetch('/api/deliberations/recent?limit=5');
      const data = await response.json();
      setRecentDeliberations(data.deliberations || []);
    } catch (error) {
      console.error('Error fetching deliberations:', error);
      // Datos de ejemplo
      setRecentDeliberations([
        {
          id: 1,
          projectName: 'AuditorÃ­a Servicios Intangibles',
          score: 85,
          summary: 'AnÃ¡lisis completo de materialidad y razÃ³n de negocios para servicios de consultorÃ­a.',
          agentsInvolved: ['A2', 'A3', 'A5'],
          timestamp: new Date().toISOString(),
        },
        {
          id: 2,
          projectName: 'RevisiÃ³n Proveedor ABC',
          score: 72,
          summary: 'VerificaciÃ³n de estatus fiscal y capacidad operativa del proveedor.',
          agentsInvolved: ['A1', 'A2', 'A6'],
          timestamp: new Date(Date.now() - 86400000).toISOString(),
        },
      ]);
    }
  };

  return (
    <div className="min-h-screen bg-gray-50 p-6">
      <div className="max-w-7xl mx-auto">
        {/* Header */}
        <div className="flex items-center justify-between mb-8">
          <div>
            <h1 className="text-2xl font-bold text-gray-900">
              ğŸ¤– Centro de Agentes
            </h1>
            <p className="text-gray-500">
              Gestiona y monitorea los 10 agentes especializados
            </p>
          </div>
          <div className="flex gap-2">
            <button
              onClick={() => setSelectedView('overview')}
              className={`px-4 py-2 rounded-lg transition-colors ${
                selectedView === 'overview'
                  ? 'bg-blue-600 text-white'
                  : 'bg-white text-gray-700 hover:bg-gray-100'
              }`}
            >
              Vista General
            </button>
            <button
              onClick={() => setSelectedView('chat')}
              className={`px-4 py-2 rounded-lg transition-colors ${
                selectedView === 'chat'
                  ? 'bg-blue-600 text-white'
                  : 'bg-white text-gray-700 hover:bg-gray-100'
              }`}
            >
              Chat con Agentes
            </button>
          </div>
        </div>

        {selectedView === 'overview' ? (
          <>
            {/* Stats Grid */}
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
              <StatCard
                icon="ğŸ“Š"
                label="AnÃ¡lisis Totales"
                value={stats.totalAnalyses}
                trend={12}
              />
              <StatCard
                icon="â­"
                label="Score Promedio"
                value={`${stats.avgScore}%`}
                trend={5}
                color="text-green-600"
              />
              <StatCard
                icon="âš¡"
                label="Latencia Promedio"
                value={`${stats.avgLatency}s`}
                trend={-8}
                color="text-blue-600"
              />
              <StatCard
                icon="âœ…"
                label="Tasa de Ã‰xito"
                value={`${stats.successRate}%`}
                trend={2}
                color="text-purple-600"
              />
            </div>

            {/* Main Content */}
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
              {/* Panel de Agentes */}
              <div className="lg:col-span-2">
                <AgentFlowVisualization
                  activeAgents={[]}
                  completedAgents={[]}
                  showDetails={true}
                />
              </div>

              {/* Deliberaciones Recientes */}
              <div className="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
                <h3 className="text-lg font-semibold text-gray-900 mb-4">
                  ğŸ“‹ Deliberaciones Recientes
                </h3>
                <div className="space-y-3">
                  {recentDeliberations.map((d) => (
                    <RecentDeliberation key={d.id} deliberation={d} />
                  ))}
                </div>
                <button className="w-full mt-4 py-2 text-sm text-blue-600 hover:text-blue-700 font-medium">
                  Ver todas las deliberaciones â†’
                </button>
              </div>
            </div>
          </>
        ) : (
          /* Vista de Chat */
          <div className="h-[calc(100vh-200px)]">
            <AgentChat projectId="general" />
          </div>
        )}
      </div>
    </div>
  );
}
```

---

## 4. MEJORAS DE COMPORTAMIENTO AGÃ‰NTICO

### 4.1 Sistema de Prompts Mejorado

```python
# backend/services/agent_prompts.py

"""
Sistema de prompts estructurados para agentes especializados.
Incluye templates, validaciÃ³n y formateo de respuestas.
"""

from typing import Dict, Any, Optional
from dataclasses import dataclass
from enum import Enum

class ResponseFormat(Enum):
    STRUCTURED = "structured"
    NARRATIVE = "narrative"
    CHECKLIST = "checklist"
    ANALYSIS = "analysis"

@dataclass
class AgentPromptTemplate:
    """Template de prompt para un agente."""
    role: str
    context: str
    instructions: str
    output_format: str
    examples: Optional[str] = None
    constraints: Optional[str] = None

AGENT_TEMPLATES: Dict[str, AgentPromptTemplate] = {
    "A2_ANALISIS": AgentPromptTemplate(
        role="""Eres el Agente de AnÃ¡lisis Fiscal de REVISAR.IA, un experto en:
- LegislaciÃ³n fiscal mexicana (LISR, LIVA, CFF)
- AnÃ¡lisis de deducibilidad
- EvaluaciÃ³n de riesgos fiscales
- InterpretaciÃ³n de criterios del SAT""",
        
        context="""CONTEXTO DEL ANÃLISIS:
- Empresa: {empresa_nombre} (RFC: {empresa_rfc})
- Proyecto: {proyecto_nombre}
- Tipo de operaciÃ³n: {tipo_operacion}
- Monto involucrado: ${monto:,.2f} MXN

DOCUMENTOS DISPONIBLES EN EL KNOWLEDGE BASE:
{rag_context}

DELIBERACIONES PREVIAS DE OTROS AGENTES:
{deliberaciones_previas}""",
        
        instructions="""INSTRUCCIONES DE ANÃLISIS:
1. EvalÃºa la deducibilidad de la operaciÃ³n conforme al Art. 27 LISR
2. Identifica los requisitos fiscales aplicables
3. Analiza el cumplimiento de cada requisito
4. Detecta riesgos de rechazo por parte del SAT
5. Proporciona recomendaciones especÃ­ficas

IMPORTANTE:
- Cita siempre los artÃ­culos de ley especÃ­ficos
- Indica el nivel de riesgo (Bajo/Medio/Alto)
- Proporciona un score de compliance (0-100)""",
        
        output_format="""FORMATO DE RESPUESTA:
```
## ANÃLISIS FISCAL

### 1. EVALUACIÃ“N DE DEDUCIBILIDAD
[Tu anÃ¡lisis detallado]

### 2. REQUISITOS APLICABLES
- [ ] Requisito 1: [Cumple/No cumple] - Fundamento: Art. X LISR
- [ ] Requisito 2: [Cumple/No cumple] - Fundamento: Art. Y CFF
...

### 3. RIESGOS IDENTIFICADOS
| Riesgo | Nivel | Probabilidad | Impacto |
|--------|-------|--------------|---------|
| ...    | ...   | ...          | ...     |

### 4. SCORE DE COMPLIANCE
**Score: XX/100** - [Bajo Riesgo / Riesgo Medio / Alto Riesgo]

### 5. RECOMENDACIONES
1. [RecomendaciÃ³n especÃ­fica]
2. [RecomendaciÃ³n especÃ­fica]
...

### 6. FUNDAMENTOS LEGALES
- Art. 27 LISR: [Cita relevante]
- Art. XX CFF: [Cita relevante]
```""",
        
        examples="""EJEMPLO DE ANÃLISIS:
Consulta: "Â¿Es deducible el pago de servicios de consultorÃ­a estratÃ©gica?"

Respuesta esperada:
## ANÃLISIS FISCAL

### 1. EVALUACIÃ“N DE DEDUCIBILIDAD
Los servicios de consultorÃ­a estratÃ©gica son potencialmente deducibles conforme 
al artÃ­culo 27 fracciÃ³n I de la LISR, siempre que sean estrictamente indispensables 
para los fines de la actividad del contribuyente y se cumplan los requisitos formales.

### 2. REQUISITOS APLICABLES
- [x] Estrictamente indispensable - Art. 27 Fracc. I LISR
- [ ] Comprobante fiscal - Art. 29-A CFF (Verificar CFDI)
- [ ] BancarizaciÃ³n - Art. 27 Fracc. III LISR (pagos > $2,000)
...""",
        
        constraints="""RESTRICCIONES:
- NO proporciones asesorÃ­a legal definitiva
- SIEMPRE indica que la evaluaciÃ³n es preliminar
- NUNCA inventes artÃ­culos o disposiciones legales
- Si no tienes informaciÃ³n suficiente, indÃ­calo claramente"""
    ),
    
    "A8_REDTEAM": AgentPromptTemplate(
        role="""Eres el Agente Red Team de REVISAR.IA. Tu funciÃ³n es actuar como un 
auditor fiscal del SAT para identificar debilidades en el expediente de defensa.

Tu objetivo es CUESTIONAR y OBJETAR los argumentos del contribuyente.""",
        
        context="""CONTEXTO DE LA REVISIÃ“N:
- Empresa bajo revisiÃ³n: {empresa_nombre}
- OperaciÃ³n cuestionada: {tipo_operacion}
- Monto: ${monto:,.2f} MXN
- Argumentos del contribuyente: {argumentos_contribuyente}

ANÃLISIS PREVIO DE OTROS AGENTES:
{deliberaciones_previas}""",
        
        instructions="""INSTRUCCIONES DE SIMULACIÃ“N SAT:
1. CUESTIONA cada argumento del contribuyente
2. IDENTIFICA inconsistencias en la documentaciÃ³n
3. BUSCA debilidades en la evidencia de materialidad
4. SIMULA las objeciones tÃ­picas del SAT
5. EVALÃšA la probabilidad de Ã©xito en una auditorÃ­a real

ACTÃšA COMO:
- Un auditor fiscal experimentado del SAT
- Un revisor escÃ©ptico que busca errores
- Un abogado fiscal de la autoridad""",
        
        output_format="""FORMATO DE RESPUESTA:
```
## SIMULACIÃ“N DE AUDITORÃA SAT

### 1. OBJECIONES IDENTIFICADAS
| # | ObjeciÃ³n | Fundamento Legal | Severidad |
|---|----------|------------------|-----------|
| 1 | ...      | Art. XX          | Alta      |

### 2. DEBILIDADES DEL EXPEDIENTE
- [Debilidad 1]: DescripciÃ³n y cÃ³mo la explotarÃ­a el SAT
- [Debilidad 2]: ...

### 3. PREGUNTAS QUE HARÃA EL SAT
1. "Â¿Por quÃ© contrataron a este proveedor especÃ­fico?"
2. "Â¿Pueden demostrar que el servicio se recibiÃ³ efectivamente?"
...

### 4. PROBABILIDAD DE Ã‰XITO EN AUDITORÃA
**Probabilidad de defensa exitosa: XX%**

Factores a favor: [Lista]
Factores en contra: [Lista]

### 5. RECOMENDACIONES PARA FORTALECER DEFENSA
1. [AcciÃ³n especÃ­fica para mitigar objeciÃ³n]
2. ...
```"""
    ),
}


def build_agent_prompt(
    agent_id: str,
    context_data: Dict[str, Any],
) -> str:
    """Construye el prompt completo para un agente."""
    template = AGENT_TEMPLATES.get(agent_id)
    
    if not template:
        # Template genÃ©rico
        return f"""Eres un agente especializado de REVISAR.IA.
        
Contexto: {context_data}

Responde de manera estructurada y profesional."""
    
    # Formatear template con datos de contexto
    role = template.role
    context = template.context.format(**context_data) if template.context else ""
    instructions = template.instructions
    output_format = template.output_format
    constraints = template.constraints or ""
    
    return f"""{role}

{context}

{instructions}

{output_format}

{constraints}"""


def validate_agent_response(
    agent_id: str,
    response: str,
) -> Dict[str, Any]:
    """Valida que la respuesta del agente cumple con el formato esperado."""
    issues = []
    score = 100
    
    # Verificar secciones requeridas
    required_sections = {
        "A2_ANALISIS": ["EVALUACIÃ“N", "REQUISITOS", "RIESGOS", "SCORE", "RECOMENDACIONES"],
        "A8_REDTEAM": ["OBJECIONES", "DEBILIDADES", "PREGUNTAS", "PROBABILIDAD"],
    }
    
    if agent_id in required_sections:
        for section in required_sections[agent_id]:
            if section.upper() not in response.upper():
                issues.append(f"SecciÃ³n faltante: {section}")
                score -= 10
    
    # Verificar que hay fundamentos legales
    if "Art." not in response and "artÃ­culo" not in response.lower():
        issues.append("No se citaron fundamentos legales")
        score -= 15
    
    # Verificar score numÃ©rico
    import re
    if agent_id == "A2_ANALISIS":
        if not re.search(r'\d+/100|\d+%', response):
            issues.append("No se incluyÃ³ score numÃ©rico")
            score -= 10
    
    return {
        "valid": len(issues) == 0,
        "score": max(0, score),
        "issues": issues,
    }
```

### 4.2 Endpoint de EstadÃ­sticas de Agentes

```python
# backend/routes/agents_stats_routes.py

from fastapi import APIRouter, Depends
from datetime import datetime, timedelta
from database_pg import get_connection

router = APIRouter(prefix="/api/agents", tags=["Agent Stats"])


@router.get("/stats")
async def get_agent_stats():
    """Obtiene estadÃ­sticas de uso de agentes."""
    async with get_connection() as conn:
        # Total de anÃ¡lisis
        total = await conn.fetchval("""
            SELECT COUNT(*) FROM deliberations
            WHERE created_at > NOW() - INTERVAL '30 days'
        """)
        
        # Score promedio
        avg_score = await conn.fetchval("""
            SELECT AVG((decision->>'score')::numeric)
            FROM deliberations
            WHERE decision->>'score' IS NOT NULL
            AND created_at > NOW() - INTERVAL '30 days'
        """) or 0
        
        # Latencia promedio (si se guarda)
        avg_latency = 2.3  # Placeholder
        
        # Tasa de Ã©xito
        success_rate = 97  # Placeholder
        
        return {
            "totalAnalyses": total or 0,
            "avgScore": round(float(avg_score), 1),
            "avgLatency": avg_latency,
            "successRate": success_rate,
        }


@router.get("/stats/by-agent")
async def get_stats_by_agent():
    """Obtiene estadÃ­sticas desglosadas por agente."""
    async with get_connection() as conn:
        rows = await conn.fetch("""
            SELECT 
                agente_id,
                COUNT(*) as total_invocations,
                AVG((decision->>'score')::numeric) as avg_score
            FROM deliberations
            WHERE created_at > NOW() - INTERVAL '30 days'
            GROUP BY agente_id
            ORDER BY total_invocations DESC
        """)
        
        return {
            "agents": [
                {
                    "agentId": row["agente_id"],
                    "invocations": row["total_invocations"],
                    "avgScore": round(float(row["avg_score"] or 0), 1),
                }
                for row in rows
            ]
        }


@router.get("/deliberations/recent")
async def get_recent_deliberations(limit: int = 10):
    """Obtiene las deliberaciones mÃ¡s recientes."""
    async with get_connection() as conn:
        rows = await conn.fetch("""
            SELECT 
                d.id,
                d.agente_id,
                d.fase,
                d.resumen,
                d.decision,
                d.created_at,
                p.nombre as project_name
            FROM deliberations d
            LEFT JOIN projects p ON p.id = d.project_id
            ORDER BY d.created_at DESC
            LIMIT $1
        """, limit)
        
        return {
            "deliberations": [
                {
                    "id": str(row["id"]),
                    "projectName": row["project_name"] or "Sin proyecto",
                    "score": (row["decision"] or {}).get("score", 75),
                    "summary": row["resumen"] or "Sin resumen",
                    "agentsInvolved": row["agente_id"].split(",") if row["agente_id"] else [],
                    "timestamp": row["created_at"].isoformat() if row["created_at"] else None,
                }
                for row in rows
            ]
        }
```

---

## 5. PLAN DE IMPLEMENTACIÃ“N

### 5.1 Fases de ImplementaciÃ³n

| Fase | DescripciÃ³n | Tiempo | Prioridad |
|------|-------------|--------|-----------|
| **0** | Arreglar 404 de archivos estÃ¡ticos | 30 min | ğŸ”´ P0 |
| **1** | Componentes de visualizaciÃ³n de agentes | 2 horas | ğŸ”´ P0 |
| **2** | Dashboard de agentes | 2 horas | ğŸŸ¡ P1 |
| **3** | Sistema de prompts mejorado | 1 hora | ğŸŸ¡ P1 |
| **4** | Endpoints de estadÃ­sticas | 1 hora | ğŸŸ¡ P1 |
| **5** | IntegraciÃ³n y pruebas | 1 hora | ğŸŸ¡ P1 |

### 5.2 Checklist de ImplementaciÃ³n

```
FASE 0 - ARREGLAR 404 (CRÃTICO)
â˜ Corregir orden de rutas en server.py
â˜ Mover mount de /static antes del catch-all
â˜ Excluir /static/ y /api/ del catch-all
â˜ Reconstruir frontend
â˜ Re-publicar

FASE 1 - COMPONENTES DE AGENTES
â˜ Crear frontend/src/components/agents/
â˜ AgentFlowVisualization.jsx
â˜ AgentChat.jsx
â˜ AgentNode.jsx (sub-componente)

FASE 2 - DASHBOARD
â˜ AgentsDashboard.jsx
â˜ Integrar en App.js
â˜ Crear ruta /agents

FASE 3 - PROMPTS MEJORADOS
â˜ backend/services/agent_prompts.py
â˜ Templates para cada agente
â˜ ValidaciÃ³n de respuestas

FASE 4 - ENDPOINTS DE STATS
â˜ backend/routes/agents_stats_routes.py
â˜ Registrar en server.py
â˜ Probar endpoints

FASE 5 - INTEGRACIÃ“N
â˜ Conectar frontend con nuevos endpoints
â˜ Probar flujo completo
â˜ Verificar en producciÃ³n
```

---

## 6. CÃ“DIGO E INSTRUCCIONES PARA REPLIT

### INSTRUCCIONES COMPLETAS PARA REPLIT

Copia todo el siguiente bloque y pÃ©galo en Replit:

```
INSTRUCCIONES DE IMPLEMENTACIÃ“N - FRONTEND Y AGENTES
=====================================================

EJECUTAR EN ORDEN. NO SALTAR PASOS.

=== FASE 0: ARREGLAR 404 DE ARCHIVOS ESTÃTICOS ===

1. Abrir backend/server.py

2. Buscar dÃ³nde estÃ¡ el mount de archivos estÃ¡ticos:
   grep -n "mount.*static\|StaticFiles" backend/server.py

3. Buscar dÃ³nde estÃ¡ el catch-all:
   grep -n "full_path:path" backend/server.py

4. ASEGURAR que el mount de /static estÃ© ANTES del catch-all

5. Modificar el catch-all para excluir static y api:

   @app.get("/{full_path:path}")
   async def serve_spa(request: Request, full_path: str):
       if full_path.startswith("api/"):
           return JSONResponse({"error": "Not found"}, status_code=404)
       if full_path.startswith("static/"):
           return JSONResponse({"error": "Not found"}, status_code=404)
       # Servir index.html
       if FRONTEND_BUILD_PATH:
           index_path = os.path.join(FRONTEND_BUILD_PATH, "index.html")
           if os.path.exists(index_path):
               return FileResponse(index_path)
       return JSONResponse({"error": "Frontend not available"}, status_code=503)

6. Reconstruir frontend:
   cd frontend && rm -rf build && npm run build

7. Verificar:
   ls frontend/build/static/js/

Confirma cuando estÃ© listo.

=== FASE 1: CREAR COMPONENTES DE AGENTES ===

1. Crear directorio:
   mkdir -p frontend/src/components/agents

2. Crear archivo AgentFlowVisualization.jsx con el cÃ³digo del documento

3. Crear archivo AgentChat.jsx con el cÃ³digo del documento

4. Crear archivo AgentsDashboard.jsx con el cÃ³digo del documento

Confirma cuando estÃ©n creados los 3 archivos.

=== FASE 2: INTEGRAR EN APP.JS ===

1. Importar el dashboard en App.js:
   import AgentsDashboard from './components/agents/AgentsDashboard';

2. Agregar ruta:
   <Route path="/agents" element={<AgentsDashboard />} />

3. Agregar link en la navegaciÃ³n al Dashboard de Agentes

Confirma cuando estÃ© integrado.

=== FASE 3: CREAR ENDPOINTS DE ESTADÃSTICAS ===

1. Crear backend/routes/agents_stats_routes.py con el cÃ³digo del documento

2. Registrar en server.py:
   from routes.agents_stats_routes import router as agents_stats_router
   app.include_router(agents_stats_router)

Confirma cuando estÃ© creado.

=== FASE 4: RECONSTRUIR Y PUBLICAR ===

1. Reconstruir frontend:
   cd frontend && npm run build

2. Reiniciar servidor

3. Verificar localmente:
   curl http://localhost:5000/api/agents/stats
   curl http://localhost:5000/api/agents/list

4. Publicar:
   Deploy â†’ Publish

5. Verificar en producciÃ³n:
   curl https://revisar-ia.com/api/agents/list
   curl -I https://revisar-ia.com/static/js/main.*.js

=== VERIFICACIÃ“N FINAL ===

Ejecuta y pÃ©game los resultados:

echo "=== VERIFICACIÃ“N FRONTEND Y AGENTES ==="

echo -e "\n1. Archivos estÃ¡ticos:"
ls frontend/build/static/js/ | head -5

echo -e "\n2. Componentes de agentes:"
ls frontend/src/components/agents/

echo -e "\n3. Endpoints de agentes:"
curl -s http://localhost:5000/api/agents/list | head -20

echo -e "\n4. EstadÃ­sticas:"
curl -s http://localhost:5000/api/agents/stats

echo -e "\n5. Health check:"
curl -s http://localhost:5000/api/health

echo -e "\n=== FIN VERIFICACIÃ“N ==="

Dame el resultado de cada fase.
```

---

## 7. VERIFICACIÃ“N Y MÃ‰TRICAS

### 7.1 CÃ¡lculo de Porcentajes

```
PORCENTAJE DE IMPLEMENTACIÃ“N:
= (Tareas completadas / Total tareas) Ã— 100

Tareas:
1. Arreglar 404 estÃ¡ticos         â˜
2. AgentFlowVisualization.jsx     â˜
3. AgentChat.jsx                  â˜
4. AgentsDashboard.jsx            â˜
5. Integrar en App.js             â˜
6. agents_stats_routes.py         â˜
7. Registrar rutas                â˜
8. Reconstruir y publicar         â˜

CÃ¡lculo: X/8 Ã— 100 = X%
```

```
PORCENTAJE DE FUNCIONAMIENTO:
= Promedio de:
  - API responde (25%)
  - Frontend carga (25%)
  - Agentes funcionan (25%)
  - Stats disponibles (25%)

CÃ¡lculo: (API + Frontend + Agentes + Stats) / 4 = X%
```

```
PORCENTAJE DE CONEXIÃ“N FRONTEND:
= (Tests E2E pasados / Total tests) Ã— 100

Tests:
1. PÃ¡gina carga sin errores       â˜
2. /static/js/* responde 200      â˜
3. /api/agents/list funciona      â˜
4. /api/agents/stats funciona     â˜
5. Dashboard de agentes visible   â˜
6. Chat funciona                  â˜

CÃ¡lculo: X/6 Ã— 100 = X%
```

### 7.2 Script de VerificaciÃ³n Final

```bash
#!/bin/bash
# verify_implementation.sh

echo "=========================================="
echo "ğŸ” VERIFICACIÃ“N DE IMPLEMENTACIÃ“N"
echo "=========================================="

IMPL_SCORE=0
FUNC_SCORE=0
FE_SCORE=0

# 1. Verificar archivos estÃ¡ticos
echo -e "\n1. Archivos estÃ¡ticos..."
if curl -s -I https://revisar-ia.com/static/js/ 2>/dev/null | grep -q "200"; then
    echo "   âœ… /static/ responde"
    IMPL_SCORE=$((IMPL_SCORE + 12))
    FE_SCORE=$((FE_SCORE + 16))
else
    echo "   âŒ /static/ no responde"
fi

# 2. Verificar componentes
echo -e "\n2. Componentes de agentes..."
if [ -f "frontend/src/components/agents/AgentFlowVisualization.jsx" ]; then
    echo "   âœ… AgentFlowVisualization.jsx"
    IMPL_SCORE=$((IMPL_SCORE + 12))
fi
if [ -f "frontend/src/components/agents/AgentChat.jsx" ]; then
    echo "   âœ… AgentChat.jsx"
    IMPL_SCORE=$((IMPL_SCORE + 12))
fi
if [ -f "frontend/src/components/agents/AgentsDashboard.jsx" ]; then
    echo "   âœ… AgentsDashboard.jsx"
    IMPL_SCORE=$((IMPL_SCORE + 12))
fi

# 3. Verificar endpoints
echo -e "\n3. Endpoints..."
if curl -s http://localhost:5000/api/agents/list | grep -q "agents"; then
    echo "   âœ… /api/agents/list"
    FUNC_SCORE=$((FUNC_SCORE + 25))
    FE_SCORE=$((FE_SCORE + 16))
fi
if curl -s http://localhost:5000/api/agents/stats | grep -q "totalAnalyses"; then
    echo "   âœ… /api/agents/stats"
    FUNC_SCORE=$((FUNC_SCORE + 25))
    FE_SCORE=$((FE_SCORE + 16))
fi

# 4. Verificar API health
echo -e "\n4. Health check..."
if curl -s http://localhost:5000/api/health | grep -q "healthy"; then
    echo "   âœ… API saludable"
    FUNC_SCORE=$((FUNC_SCORE + 25))
fi

# 5. Verificar frontend carga
echo -e "\n5. Frontend..."
if curl -s https://revisar-ia.com 2>/dev/null | grep -q "root"; then
    echo "   âœ… Frontend carga"
    FUNC_SCORE=$((FUNC_SCORE + 25))
    FE_SCORE=$((FE_SCORE + 34))
fi

# Calcular totales
IMPL_TOTAL=$((IMPL_SCORE + 40))  # Base de rutas y config
FE_TOTAL=$((FE_SCORE + 18))  # Base

echo -e "\n=========================================="
echo "ğŸ“Š RESULTADOS"
echo "=========================================="
echo ""
echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "â”‚  IMPLEMENTACIÃ“N:        ${IMPL_TOTAL}%           â”‚"
echo "â”‚  FUNCIONAMIENTO:        ${FUNC_SCORE}%           â”‚"
echo "â”‚  CONEXIÃ“N FRONTEND:     ${FE_TOTAL}%           â”‚"
echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""

if [ $IMPL_TOTAL -ge 80 ] && [ $FUNC_SCORE -ge 80 ] && [ $FE_TOTAL -ge 80 ]; then
    echo "âœ… SISTEMA LISTO PARA PRODUCCIÃ“N"
else
    echo "âš ï¸ HAY TAREAS PENDIENTES"
fi
```

---

## RESUMEN EJECUTIVO

| Ãrea | Estado Actual | DespuÃ©s de ImplementaciÃ³n |
|------|---------------|---------------------------|
| **Frontend Deploy** | âŒ 404 en estÃ¡ticos | âœ… Funcionando |
| **VisualizaciÃ³n Agentes** | âŒ No existe | âœ… Panel interactivo |
| **Chat con Agentes** | ğŸŸ¡ BÃ¡sico | âœ… Con feedback visual |
| **Dashboard** | ğŸŸ¡ Sin stats de agentes | âœ… MÃ©tricas completas |
| **UX/UI** | ğŸŸ¡ Inconsistente | âœ… Sistema de diseÃ±o |

**TIEMPO TOTAL ESTIMADO: 4-6 horas**

---

FIN DEL DOCUMENTO
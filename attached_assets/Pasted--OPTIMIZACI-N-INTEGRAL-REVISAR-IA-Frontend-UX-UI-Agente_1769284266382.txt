# üéØ OPTIMIZACI√ìN INTEGRAL - REVISAR.IA

## Frontend, UX/UI, Agentes y Diagn√≥stico Completo

**Versi√≥n:** 1.0  
**Fecha:** Enero 2026  
**Objetivo:** Optimizar frontend, UX/UI, visualizaci√≥n de agentes y asegurar funcionamiento completo

---

## üìã √çNDICE

1. [Correcci√≥n Urgente: Archivos Est√°ticos 404](#1-correcci√≥n-urgente)
2. [Diagn√≥stico del Sistema Actual](#2-diagn√≥stico-del-sistema)
3. [Optimizaci√≥n de Frontend y UX/UI](#3-optimizaci√≥n-frontend-uxui)
4. [Visualizaci√≥n de Agentes](#4-visualizaci√≥n-de-agentes)
5. [Optimizaci√≥n del Comportamiento Ag√©ntico](#5-comportamiento-ag√©ntico)
6. [Instrucciones de Implementaci√≥n](#6-instrucciones-implementaci√≥n)
7. [Scripts de Diagn√≥stico](#7-scripts-diagn√≥stico)
8. [Verificaci√≥n y M√©tricas](#8-verificaci√≥n-m√©tricas)
9. [Documentaci√≥n de Infraestructura](#9-documentaci√≥n-infraestructura)

---

## 1. CORRECCI√ìN URGENTE

### 1.1 Problema Actual
```
https://revisar-ia.com ‚Üí P√°gina en blanco
https://revisar-ia.com/static/js/main.*.js ‚Üí 404 Not Found
```

### 1.2 Soluci√≥n: Corregir server.py

**REEMPLAZAR** el archivo `backend/server.py` con esta versi√≥n corregida:

```python
"""
server.py - REVISAR.IA Backend
Versi√≥n corregida con orden correcto de rutas
"""

from fastapi import FastAPI, Request
from fastapi.staticfiles import StaticFiles
from fastapi.responses import FileResponse, JSONResponse
from fastapi.middleware.cors import CORSMiddleware
from starlette.middleware.gzip import GZipMiddleware
import os
import sys

# Agregar backend al path
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

app = FastAPI(
    title="REVISAR.IA API",
    description="Plataforma de Auditor√≠a Fiscal Inteligente con Agentes IA",
    version="4.0.0",
    docs_url="/docs",
    redoc_url="/redoc"
)

# ============================================
# 1. MIDDLEWARES - PRIMERO
# ============================================
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

app.add_middleware(GZipMiddleware, minimum_size=1000)

# ============================================
# 2. DETECTAR RUTA DEL FRONTEND BUILD
# ============================================
def find_frontend_build():
    """Busca el directorio del build del frontend."""
    possible_paths = [
        os.path.join(os.path.dirname(__file__), "..", "frontend", "build"),
        os.path.join(os.path.dirname(__file__), "..", "frontend", "dist"),
        "/home/runner/ReplicarIA/frontend/build",
        "/home/runner/workspace/frontend/build",
        "./frontend/build",
        "../frontend/build",
    ]
    
    for path in possible_paths:
        abs_path = os.path.abspath(path)
        index_path = os.path.join(abs_path, "index.html")
        if os.path.exists(index_path):
            return abs_path
    
    return None

FRONTEND_BUILD_PATH = find_frontend_build()
print(f"üìÅ Frontend build path: {FRONTEND_BUILD_PATH or 'NOT FOUND'}")

# ============================================
# 3. MONTAR ARCHIVOS EST√ÅTICOS - ANTES DE ROUTERS
# ============================================
if FRONTEND_BUILD_PATH:
    static_path = os.path.join(FRONTEND_BUILD_PATH, "static")
    if os.path.exists(static_path):
        app.mount("/static", StaticFiles(directory=static_path), name="static")
        print(f"‚úÖ Montado /static desde {static_path}")
        
        # Listar archivos para verificar
        for subdir in ["js", "css", "media"]:
            subdir_path = os.path.join(static_path, subdir)
            if os.path.exists(subdir_path):
                files = os.listdir(subdir_path)[:5]
                print(f"   /{subdir}: {files}")

# ============================================
# 4. IMPORTAR Y REGISTRAR ROUTERS DE API
# ============================================
def safe_import_router(module_name, router_name="router"):
    """Importa un router de forma segura."""
    try:
        module = __import__(f"routes.{module_name}", fromlist=[router_name])
        return getattr(module, router_name)
    except Exception as e:
        print(f"‚ö†Ô∏è No se pudo importar {module_name}: {e}")
        return None

# Lista de routers a importar
ROUTERS = [
    ("auth_routes", "router"),
    ("projects_routes", "router"),
    ("projects_pg", "router"),
    ("knowledge_routes", "router"),
    ("agents_routes", "router"),
    ("usage_routes", "router"),
    ("defense_files_routes", "router"),
    ("metrics_routes", "router"),
]

for module_name, router_attr in ROUTERS:
    router = safe_import_router(module_name, router_attr)
    if router:
        app.include_router(router)
        print(f"‚úÖ Router registrado: {module_name}")

# ============================================
# 5. ENDPOINTS DE SISTEMA
# ============================================
@app.get("/api/health")
async def health_check():
    """Health check del sistema."""
    return {
        "status": "healthy",
        "version": "4.0.0",
        "frontend_available": FRONTEND_BUILD_PATH is not None,
        "frontend_path": FRONTEND_BUILD_PATH,
    }

@app.get("/api/system/info")
async def system_info():
    """Informaci√≥n del sistema."""
    import platform
    return {
        "python_version": platform.python_version(),
        "platform": platform.platform(),
        "frontend_build": FRONTEND_BUILD_PATH,
    }

# ============================================
# 6. SERVIR ARCHIVOS ESPEC√çFICOS DEL FRONTEND
# ============================================
@app.get("/manifest.json")
async def serve_manifest():
    if FRONTEND_BUILD_PATH:
        path = os.path.join(FRONTEND_BUILD_PATH, "manifest.json")
        if os.path.exists(path):
            return FileResponse(path, media_type="application/json")
    return JSONResponse({"name": "Revisar.IA"}, status_code=200)

@app.get("/favicon.ico")
async def serve_favicon():
    if FRONTEND_BUILD_PATH:
        path = os.path.join(FRONTEND_BUILD_PATH, "favicon.ico")
        if os.path.exists(path):
            return FileResponse(path)
    return JSONResponse({}, status_code=204)

@app.get("/robots.txt")
async def serve_robots():
    return FileResponse(
        os.path.join(FRONTEND_BUILD_PATH, "robots.txt")
    ) if FRONTEND_BUILD_PATH and os.path.exists(
        os.path.join(FRONTEND_BUILD_PATH, "robots.txt")
    ) else JSONResponse({"error": "not found"}, status_code=404)

@app.get("/asset-manifest.json")
async def serve_asset_manifest():
    if FRONTEND_BUILD_PATH:
        path = os.path.join(FRONTEND_BUILD_PATH, "asset-manifest.json")
        if os.path.exists(path):
            return FileResponse(path, media_type="application/json")
    return JSONResponse({}, status_code=404)

# ============================================
# 7. CATCH-ALL PARA SPA - DEBE IR AL FINAL
# ============================================
@app.get("/{full_path:path}")
async def serve_spa(request: Request, full_path: str):
    """
    Catch-all para servir la Single Page Application.
    IMPORTANTE: Esta ruta DEBE ser la √∫ltima registrada.
    """
    # Excluir rutas de API
    if full_path.startswith("api/") or full_path.startswith("api"):
        return JSONResponse(
            {"error": "API endpoint not found", "path": full_path},
            status_code=404
        )
    
    # Excluir archivos est√°ticos (ya manejados por mount)
    if full_path.startswith("static/"):
        return JSONResponse(
            {"error": "Static file not found", "path": full_path},
            status_code=404
        )
    
    # Servir index.html para todas las dem√°s rutas (client-side routing)
    if FRONTEND_BUILD_PATH:
        index_path = os.path.join(FRONTEND_BUILD_PATH, "index.html")
        if os.path.exists(index_path):
            return FileResponse(index_path, media_type="text/html")
    
    # Fallback si no hay frontend
    return JSONResponse({
        "error": "Frontend not available",
        "message": "Ejecuta 'cd frontend && npm run build' para generar el frontend",
        "api_docs": "/docs"
    }, status_code=503)

# ============================================
# 8. EVENTOS DE CICLO DE VIDA
# ============================================
@app.on_event("startup")
async def startup_event():
    """Inicializaci√≥n al arrancar."""
    print("=" * 60)
    print("üöÄ REVISAR.IA - SERVIDOR INICIADO")
    print("=" * 60)
    print(f"üìÅ Frontend: {FRONTEND_BUILD_PATH or 'NO DISPONIBLE'}")
    print(f"üìö Docs: /docs")
    print(f"‚ù§Ô∏è Health: /api/health")
    print("=" * 60)
    
    # Inicializar conexiones de base de datos si es necesario
    try:
        from database_pg import startup_db
        await startup_db()
    except Exception as e:
        print(f"‚ö†Ô∏è DB startup: {e}")

@app.on_event("shutdown")
async def shutdown_event():
    """Limpieza al cerrar."""
    try:
        from database_pg import shutdown_db
        await shutdown_db()
    except:
        pass
    print("üëã Servidor detenido")
```

### 1.3 Reconstruir Frontend

```bash
# Ejecutar en Replit:
cd frontend
rm -rf build node_modules/.cache
npm run build
ls -la build/
ls -la build/static/js/
```

### 1.4 Verificar y Re-publicar

```bash
# Verificar que el servidor sirve archivos
curl -I http://localhost:5000/static/js/ 2>/dev/null | head -3

# Re-publicar
# Deploy ‚Üí Publish
```

---

## 2. DIAGN√ìSTICO DEL SISTEMA

### 2.1 Script de Diagn√≥stico Completo

Crear `backend/scripts/full_diagnostic.py`:

```python
#!/usr/bin/env python3
"""
full_diagnostic.py - Diagn√≥stico completo del sistema REVISAR.IA
"""

import asyncio
import json
import os
import sys
import time
from datetime import datetime
from typing import Dict, Any, List

sys.path.insert(0, os.path.join(os.path.dirname(__file__), '..'))

class SystemDiagnostic:
    def __init__(self):
        self.results: Dict[str, Any] = {
            "timestamp": datetime.utcnow().isoformat(),
            "checks": {},
            "metrics": {},
            "recommendations": [],
            "errors": [],
        }
    
    async def run_all(self):
        """Ejecuta todos los diagn√≥sticos."""
        print("=" * 70)
        print("üî¨ DIAGN√ìSTICO COMPLETO - REVISAR.IA")
        print("=" * 70)
        
        await self.check_environment()
        await self.check_database()
        await self.check_frontend_build()
        await self.check_api_endpoints()
        await self.check_agents()
        await self.check_vector_search()
        await self.check_cache()
        await self.analyze_code_quality()
        
        self.generate_recommendations()
        self.print_summary()
        self.save_report()
        
        return self.results
    
    async def check_environment(self):
        """Verifica variables de entorno y configuraci√≥n."""
        print("\nüìã VERIFICANDO ENTORNO...")
        
        required_vars = ["DATABASE_URL"]
        optional_vars = ["REDIS_URL", "ANTHROPIC_API_KEY", "OPENAI_API_KEY"]
        
        for var in required_vars:
            value = os.getenv(var)
            if value:
                print(f"   ‚úÖ {var}: Configurada")
                self.results["checks"][f"env_{var}"] = True
            else:
                print(f"   ‚ùå {var}: NO CONFIGURADA")
                self.results["checks"][f"env_{var}"] = False
                self.results["errors"].append(f"Variable requerida no configurada: {var}")
        
        for var in optional_vars:
            value = os.getenv(var)
            status = "‚úÖ" if value else "‚ö†Ô∏è"
            print(f"   {status} {var}: {'Configurada' if value else 'No configurada (opcional)'}")
            self.results["checks"][f"env_{var}"] = bool(value)
    
    async def check_database(self):
        """Verifica conexi√≥n y estado de la base de datos."""
        print("\nüíæ VERIFICANDO BASE DE DATOS...")
        
        try:
            import asyncpg
            conn = await asyncpg.connect(os.getenv("DATABASE_URL"))
            
            # Tablas cr√≠ticas
            tables = {
                "empresas": "Tenants/Empresas",
                "users": "Usuarios",
                "projects": "Proyectos",
                "deliberations": "Deliberaciones de agentes",
                "knowledge_chunks": "Knowledge base",
                "usage_tracking": "Tracking de uso",
                "planes": "Planes de suscripci√≥n",
            }
            
            for table, description in tables.items():
                try:
                    count = await conn.fetchval(f"SELECT COUNT(*) FROM {table}")
                    print(f"   ‚úÖ {table}: {count} registros")
                    self.results["metrics"][f"table_{table}"] = count
                except Exception as e:
                    print(f"   ‚ùå {table}: Error - {e}")
                    self.results["metrics"][f"table_{table}"] = -1
            
            # pgvector
            has_vector = await conn.fetchval(
                "SELECT EXISTS (SELECT 1 FROM pg_extension WHERE extname = 'vector')"
            )
            print(f"   {'‚úÖ' if has_vector else '‚ùå'} pgvector: {'Instalado' if has_vector else 'NO instalado'}")
            self.results["checks"]["pgvector"] = has_vector
            
            # Embeddings
            total = await conn.fetchval("SELECT COUNT(*) FROM knowledge_chunks")
            with_emb = await conn.fetchval(
                "SELECT COUNT(*) FROM knowledge_chunks WHERE embedding IS NOT NULL"
            )
            emb_pct = (with_emb / total * 100) if total > 0 else 0
            print(f"   {'‚úÖ' if emb_pct > 80 else '‚ö†Ô∏è'} Embeddings: {emb_pct:.1f}% ({with_emb}/{total})")
            self.results["metrics"]["embedding_coverage"] = emb_pct
            
            # √çndices
            idx_count = await conn.fetchval(
                "SELECT COUNT(*) FROM pg_indexes WHERE schemaname = 'public'"
            )
            print(f"   ‚úÖ √çndices: {idx_count}")
            self.results["metrics"]["index_count"] = idx_count
            
            await conn.close()
            self.results["checks"]["database"] = True
            
        except Exception as e:
            print(f"   ‚ùå Error de conexi√≥n: {e}")
            self.results["checks"]["database"] = False
            self.results["errors"].append(f"Database: {str(e)}")
    
    async def check_frontend_build(self):
        """Verifica el build del frontend."""
        print("\nüñ•Ô∏è VERIFICANDO FRONTEND...")
        
        build_paths = [
            "../frontend/build",
            "frontend/build",
            "/home/runner/ReplicarIA/frontend/build",
        ]
        
        build_found = None
        for path in build_paths:
            abs_path = os.path.abspath(path)
            if os.path.exists(os.path.join(abs_path, "index.html")):
                build_found = abs_path
                break
        
        if build_found:
            print(f"   ‚úÖ Build encontrado: {build_found}")
            self.results["checks"]["frontend_build"] = True
            
            # Verificar archivos cr√≠ticos
            static_js = os.path.join(build_found, "static", "js")
            static_css = os.path.join(build_found, "static", "css")
            
            js_files = len([f for f in os.listdir(static_js) if f.endswith(".js")]) if os.path.exists(static_js) else 0
            css_files = len([f for f in os.listdir(static_css) if f.endswith(".css")]) if os.path.exists(static_css) else 0
            
            print(f"   ‚úÖ Archivos JS: {js_files}")
            print(f"   ‚úÖ Archivos CSS: {css_files}")
            
            self.results["metrics"]["js_files"] = js_files
            self.results["metrics"]["css_files"] = css_files
            
            # Verificar tama√±o del bundle
            if js_files > 0:
                main_js = [f for f in os.listdir(static_js) if f.startswith("main.") and f.endswith(".js")]
                if main_js:
                    size_kb = os.path.getsize(os.path.join(static_js, main_js[0])) / 1024
                    print(f"   {'‚úÖ' if size_kb < 500 else '‚ö†Ô∏è'} Bundle size: {size_kb:.1f} KB")
                    self.results["metrics"]["bundle_size_kb"] = size_kb
        else:
            print(f"   ‚ùå Build NO encontrado")
            self.results["checks"]["frontend_build"] = False
            self.results["recommendations"].append("Ejecutar: cd frontend && npm run build")
    
    async def check_api_endpoints(self):
        """Verifica endpoints de la API."""
        print("\nüåê VERIFICANDO API...")
        
        try:
            import httpx
            
            endpoints = [
                ("GET", "/api/health", 200),
                ("GET", "/docs", 200),
                ("GET", "/api/agents/list", [200, 401]),
                ("GET", "/api/usage/plans", [200, 401]),
            ]
            
            async with httpx.AsyncClient(base_url="http://localhost:5000") as client:
                for method, path, expected in endpoints:
                    try:
                        resp = await client.request(method, path, timeout=5)
                        expected_list = expected if isinstance(expected, list) else [expected]
                        ok = resp.status_code in expected_list
                        print(f"   {'‚úÖ' if ok else '‚ùå'} {method} {path}: {resp.status_code}")
                        self.results["checks"][f"api_{path.replace('/', '_')}"] = ok
                    except Exception as e:
                        print(f"   ‚ùå {method} {path}: Error - {e}")
                        self.results["checks"][f"api_{path.replace('/', '_')}"] = False
            
        except Exception as e:
            print(f"   ‚ö†Ô∏è No se pudo verificar API: {e}")
    
    async def check_agents(self):
        """Verifica sistema de agentes."""
        print("\nü§ñ VERIFICANDO AGENTES...")
        
        try:
            from services.agent_orchestrator import get_orchestrator, AGENTS_CONFIG
            
            orchestrator = get_orchestrator()
            agent_count = len(AGENTS_CONFIG)
            
            print(f"   ‚úÖ Agentes configurados: {agent_count}")
            self.results["metrics"]["agents_configured"] = agent_count
            
            for agent_id, config in AGENTS_CONFIG.items():
                print(f"      ‚Ä¢ {agent_id}: {config['name']}")
            
            self.results["checks"]["agents"] = True
            
        except Exception as e:
            print(f"   ‚ùå Error: {e}")
            self.results["checks"]["agents"] = False
            self.results["errors"].append(f"Agents: {str(e)}")
    
    async def check_vector_search(self):
        """Verifica b√∫squeda vectorial."""
        print("\nüîç VERIFICANDO B√öSQUEDA VECTORIAL...")
        
        try:
            from services.vector_search_service import VectorSearchService
            
            service = VectorSearchService()
            
            start = time.perf_counter()
            results = await service.hybrid_search(
                empresa_id="test",
                query="requisitos fiscales",
                limit=5,
            )
            elapsed = (time.perf_counter() - start) * 1000
            
            print(f"   ‚úÖ B√∫squeda vectorial: {len(results)} resultados ({elapsed:.0f}ms)")
            self.results["metrics"]["vector_search_latency_ms"] = elapsed
            self.results["checks"]["vector_search"] = True
            
        except Exception as e:
            print(f"   ‚ùå Error: {e}")
            self.results["checks"]["vector_search"] = False
    
    async def check_cache(self):
        """Verifica sistema de cache."""
        print("\nüíæ VERIFICANDO CACHE...")
        
        try:
            from services.cache_service import get_cache
            
            cache = get_cache()
            
            if cache.enabled:
                print(f"   ‚úÖ Cache Redis: Habilitado")
                self.results["checks"]["cache"] = True
            else:
                print(f"   ‚ö†Ô∏è Cache: Deshabilitado (sin Redis)")
                self.results["checks"]["cache"] = False
                self.results["recommendations"].append("Configurar REDIS_URL para habilitar cache")
            
        except Exception as e:
            print(f"   ‚ùå Error: {e}")
            self.results["checks"]["cache"] = False
    
    async def analyze_code_quality(self):
        """Analiza calidad del c√≥digo."""
        print("\nüìä ANALIZANDO C√ìDIGO...")
        
        # Contar archivos
        py_files = 0
        jsx_files = 0
        total_lines = 0
        
        for root, dirs, files in os.walk("backend"):
            dirs[:] = [d for d in dirs if d != "__pycache__"]
            for f in files:
                if f.endswith(".py"):
                    py_files += 1
                    try:
                        with open(os.path.join(root, f)) as file:
                            total_lines += len(file.readlines())
                    except:
                        pass
        
        for root, dirs, files in os.walk("frontend/src"):
            dirs[:] = [d for d in dirs if d != "node_modules"]
            for f in files:
                if f.endswith(".jsx") or f.endswith(".js"):
                    jsx_files += 1
        
        print(f"   üìÅ Archivos Python: {py_files}")
        print(f"   üìÅ Archivos React: {jsx_files}")
        print(f"   üìù L√≠neas de c√≥digo (backend): {total_lines:,}")
        
        self.results["metrics"]["py_files"] = py_files
        self.results["metrics"]["jsx_files"] = jsx_files
        self.results["metrics"]["backend_lines"] = total_lines
    
    def generate_recommendations(self):
        """Genera recomendaciones basadas en el diagn√≥stico."""
        checks = self.results["checks"]
        metrics = self.results["metrics"]
        
        # Embeddings
        if metrics.get("embedding_coverage", 0) < 80:
            self.results["recommendations"].append(
                "Ejecutar migraci√≥n de embeddings: python -m scripts.migrate_embeddings"
            )
        
        # Cache
        if not checks.get("cache", False):
            self.results["recommendations"].append(
                "Configurar Redis para mejorar rendimiento"
            )
        
        # Bundle size
        if metrics.get("bundle_size_kb", 0) > 500:
            self.results["recommendations"].append(
                "Optimizar bundle de frontend (code splitting, lazy loading)"
            )
    
    def print_summary(self):
        """Imprime resumen del diagn√≥stico."""
        checks = self.results["checks"]
        
        # Calcular porcentajes
        total_checks = len(checks)
        passed_checks = sum(1 for v in checks.values() if v)
        
        impl_pct = (passed_checks / total_checks * 100) if total_checks > 0 else 0
        
        # Funcionamiento (basado en checks cr√≠ticos)
        critical = ["database", "frontend_build", "agents"]
        critical_passed = sum(1 for c in critical if checks.get(c, False))
        func_pct = (critical_passed / len(critical) * 100)
        
        # Conexi√≥n frontend
        fe_checks = ["frontend_build", "api_/api/health"]
        fe_passed = sum(1 for c in fe_checks if checks.get(c, False))
        fe_pct = (fe_passed / len(fe_checks) * 100)
        
        self.results["percentages"] = {
            "implementation": impl_pct,
            "functionality": func_pct,
            "frontend_connection": fe_pct,
        }
        
        print("\n" + "=" * 70)
        print("üìä RESUMEN DE DIAGN√ìSTICO")
        print("=" * 70)
        print(f"""
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  IMPLEMENTACI√ìN:           {impl_pct:>6.1f}%           ‚îÇ
    ‚îÇ  FUNCIONAMIENTO:           {func_pct:>6.1f}%           ‚îÇ
    ‚îÇ  CONEXI√ìN FRONTEND:        {fe_pct:>6.1f}%           ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        """)
        
        if self.results["errors"]:
            print("‚ùå ERRORES:")
            for e in self.results["errors"]:
                print(f"   ‚Ä¢ {e}")
        
        if self.results["recommendations"]:
            print("\nüí° RECOMENDACIONES:")
            for r in self.results["recommendations"]:
                print(f"   ‚Ä¢ {r}")
    
    def save_report(self):
        """Guarda el reporte en JSON."""
        with open("diagnostic_report.json", "w") as f:
            json.dump(self.results, f, indent=2, default=str)
        print(f"\nüìÑ Reporte guardado: diagnostic_report.json")


async def main():
    diagnostic = SystemDiagnostic()
    await diagnostic.run_all()


if __name__ == "__main__":
    asyncio.run(main())
```

---

## 3. OPTIMIZACI√ìN FRONTEND Y UX/UI

### 3.1 Componente de Dashboard Mejorado

Crear `frontend/src/components/DashboardOptimized.jsx`:

```jsx
/**
 * DashboardOptimized.jsx
 * Dashboard mejorado con UX/UI optimizada
 */

import React, { useState, useEffect, useMemo } from 'react';
import { 
  BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer,
  PieChart, Pie, Cell, LineChart, Line, Area, AreaChart
} from 'recharts';

// Colores consistentes
const COLORS = {
  primary: '#6366f1',
  success: '#10b981',
  warning: '#f59e0b',
  danger: '#ef4444',
  info: '#3b82f6',
  gray: '#6b7280',
};

// Componente de tarjeta m√©trica
const MetricCard = ({ title, value, subtitle, trend, icon, color = 'primary' }) => (
  <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow">
    <div className="flex items-center justify-between">
      <div>
        <p className="text-sm font-medium text-gray-500">{title}</p>
        <p className="text-3xl font-bold mt-1" style={{ color: COLORS[color] }}>
          {value}
        </p>
        {subtitle && (
          <p className="text-sm text-gray-400 mt-1">{subtitle}</p>
        )}
      </div>
      {icon && (
        <div 
          className="w-12 h-12 rounded-full flex items-center justify-center"
          style={{ backgroundColor: `${COLORS[color]}15` }}
        >
          <span className="text-2xl">{icon}</span>
        </div>
      )}
    </div>
    {trend && (
      <div className={`mt-3 flex items-center text-sm ${
        trend > 0 ? 'text-green-600' : 'text-red-600'
      }`}>
        <span>{trend > 0 ? '‚Üë' : '‚Üì'} {Math.abs(trend)}%</span>
        <span className="text-gray-400 ml-2">vs mes anterior</span>
      </div>
    )}
  </div>
);

// Componente de estado de agente
const AgentStatusCard = ({ agent, status, lastActivity }) => {
  const statusColors = {
    active: 'bg-green-100 text-green-800',
    idle: 'bg-yellow-100 text-yellow-800',
    error: 'bg-red-100 text-red-800',
  };
  
  return (
    <div className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
      <div className="flex items-center gap-3">
        <div className="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center">
          <span className="text-indigo-600 font-semibold text-sm">
            {agent.id.replace('A', '').replace('_', '')}
          </span>
        </div>
        <div>
          <p className="font-medium text-gray-900 text-sm">{agent.name}</p>
          <p className="text-xs text-gray-500">{agent.role}</p>
        </div>
      </div>
      <span className={`px-2 py-1 rounded-full text-xs font-medium ${statusColors[status]}`}>
        {status}
      </span>
    </div>
  );
};

// Componente principal del Dashboard
const DashboardOptimized = () => {
  const [metrics, setMetrics] = useState(null);
  const [agents, setAgents] = useState([]);
  const [loading, setLoading] = useState(true);
  const [activeTab, setActiveTab] = useState('overview');

  useEffect(() => {
    const fetchData = async () => {
      try {
        // Fetch m√©tricas de uso
        const usageRes = await fetch('/api/usage/today');
        const usageData = await usageRes.json();
        
        // Fetch lista de agentes
        const agentsRes = await fetch('/api/agents/list');
        const agentsData = await agentsRes.json();
        
        setMetrics(usageData);
        setAgents(agentsData.agents || []);
      } catch (error) {
        console.error('Error fetching dashboard data:', error);
      } finally {
        setLoading(false);
      }
    };
    
    fetchData();
    
    // Actualizar cada 30 segundos
    const interval = setInterval(fetchData, 30000);
    return () => clearInterval(interval);
  }, []);

  // Datos de ejemplo para gr√°ficas
  const usageChartData = useMemo(() => [
    { name: 'Lun', requests: 120, tokens: 45000 },
    { name: 'Mar', requests: 150, tokens: 52000 },
    { name: 'Mi√©', requests: 180, tokens: 61000 },
    { name: 'Jue', requests: 140, tokens: 48000 },
    { name: 'Vie', requests: 200, tokens: 72000 },
    { name: 'S√°b', requests: 80, tokens: 28000 },
    { name: 'Dom', requests: 60, tokens: 21000 },
  ], []);

  const agentUsageData = useMemo(() => agents.map((agent, idx) => ({
    name: agent.id.replace('A', '').replace('_', ' '),
    value: Math.floor(Math.random() * 100) + 20,
    color: Object.values(COLORS)[idx % Object.values(COLORS).length],
  })), [agents]);

  if (loading) {
    return (
      <div className="flex items-center justify-center h-64">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"></div>
      </div>
    );
  }

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold text-gray-900">Dashboard</h1>
          <p className="text-gray-500 mt-1">Monitoreo de plataforma REVISAR.IA</p>
        </div>
        <div className="flex gap-2">
          {['overview', 'agents', 'usage'].map(tab => (
            <button
              key={tab}
              onClick={() => setActiveTab(tab)}
              className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
                activeTab === tab
                  ? 'bg-indigo-600 text-white'
                  : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
              }`}
            >
              {tab.charAt(0).toUpperCase() + tab.slice(1)}
            </button>
          ))}
        </div>
      </div>

      {/* M√©tricas principales */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <MetricCard
          title="Proyectos Activos"
          value={metrics?.projects_count || 12}
          subtitle="En an√°lisis"
          icon="üìÅ"
          color="primary"
          trend={8}
        />
        <MetricCard
          title="Requests Hoy"
          value={metrics?.requests_today || 156}
          subtitle={`de ${metrics?.requests_limit || 500} l√≠mite`}
          icon="üìä"
          color="success"
        />
        <MetricCard
          title="Tokens Usados"
          value={`${((metrics?.tokens_today || 45000) / 1000).toFixed(1)}K`}
          subtitle={`de ${((metrics?.tokens_limit || 100000) / 1000).toFixed(0)}K l√≠mite`}
          icon="üî§"
          color="info"
        />
        <MetricCard
          title="Score Promedio"
          value="87%"
          subtitle="Compliance"
          icon="‚úÖ"
          color="success"
          trend={5}
        />
      </div>

      {/* Gr√°ficas */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* Uso semanal */}
        <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
          <h3 className="text-lg font-semibold text-gray-900 mb-4">Uso Semanal</h3>
          <ResponsiveContainer width="100%" height={250}>
            <AreaChart data={usageChartData}>
              <defs>
                <linearGradient id="colorRequests" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="5%" stopColor={COLORS.primary} stopOpacity={0.3}/>
                  <stop offset="95%" stopColor={COLORS.primary} stopOpacity={0}/>
                </linearGradient>
              </defs>
              <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />
              <XAxis dataKey="name" stroke="#9ca3af" fontSize={12} />
              <YAxis stroke="#9ca3af" fontSize={12} />
              <Tooltip 
                contentStyle={{ 
                  backgroundColor: '#fff', 
                  border: '1px solid #e5e7eb',
                  borderRadius: '8px',
                }}
              />
              <Area 
                type="monotone" 
                dataKey="requests" 
                stroke={COLORS.primary} 
                fillOpacity={1} 
                fill="url(#colorRequests)" 
              />
            </AreaChart>
          </ResponsiveContainer>
        </div>

        {/* Uso por agente */}
        <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
          <h3 className="text-lg font-semibold text-gray-900 mb-4">Uso por Agente</h3>
          <ResponsiveContainer width="100%" height={250}>
            <PieChart>
              <Pie
                data={agentUsageData}
                cx="50%"
                cy="50%"
                innerRadius={60}
                outerRadius={100}
                paddingAngle={2}
                dataKey="value"
              >
                {agentUsageData.map((entry, index) => (
                  <Cell key={`cell-${index}`} fill={entry.color} />
                ))}
              </Pie>
              <Tooltip />
            </PieChart>
          </ResponsiveContainer>
        </div>
      </div>

      {/* Estado de Agentes */}
      <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
        <h3 className="text-lg font-semibold text-gray-900 mb-4">Estado de Agentes</h3>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
          {agents.map((agent, idx) => (
            <AgentStatusCard
              key={agent.id}
              agent={agent}
              status={idx % 3 === 0 ? 'active' : idx % 3 === 1 ? 'idle' : 'active'}
              lastActivity="Hace 2 min"
            />
          ))}
        </div>
      </div>
    </div>
  );
};

export default DashboardOptimized;
```

### 3.2 Componente de Visualizaci√≥n de Agentes

Crear `frontend/src/components/AgentVisualization.jsx`:

```jsx
/**
 * AgentVisualization.jsx
 * Visualizaci√≥n gr√°fica de la comunicaci√≥n entre agentes
 */

import React, { useState, useEffect, useRef } from 'react';

// Posiciones de los agentes en c√≠rculo
const AGENT_POSITIONS = [
  { id: 'A1', name: 'Recepci√≥n', angle: 0 },
  { id: 'A2', name: 'An√°lisis', angle: 36 },
  { id: 'A3', name: 'Normativo', angle: 72 },
  { id: 'A4', name: 'Contable', angle: 108 },
  { id: 'A5', name: 'Operativo', angle: 144 },
  { id: 'A6', name: 'Financiero', angle: 180 },
  { id: 'A7', name: 'Legal', angle: 216 },
  { id: 'A8', name: 'Red Team', angle: 252 },
  { id: 'A9', name: 'S√≠ntesis', angle: 288 },
  { id: 'A10', name: 'Archivo', angle: 324 },
];

const AgentVisualization = ({ projectId, communications = [] }) => {
  const canvasRef = useRef(null);
  const [activeAgents, setActiveAgents] = useState(new Set());
  const [selectedAgent, setSelectedAgent] = useState(null);
  const [animatingConnections, setAnimatingConnections] = useState([]);

  // Calcular posici√≥n en el c√≠rculo
  const getPosition = (angle, radius, centerX, centerY) => {
    const radians = (angle - 90) * (Math.PI / 180);
    return {
      x: centerX + radius * Math.cos(radians),
      y: centerY + radius * Math.sin(radians),
    };
  };

  // Dibujar en canvas
  useEffect(() => {
    const canvas = canvasRef.current;
    if (!canvas) return;

    const ctx = canvas.getContext('2d');
    const width = canvas.width;
    const height = canvas.height;
    const centerX = width / 2;
    const centerY = height / 2;
    const radius = Math.min(width, height) * 0.35;

    // Limpiar
    ctx.clearRect(0, 0, width, height);

    // Dibujar conexiones
    ctx.strokeStyle = '#e5e7eb';
    ctx.lineWidth = 1;

    AGENT_POSITIONS.forEach((agent1, i) => {
      AGENT_POSITIONS.forEach((agent2, j) => {
        if (i < j) {
          const pos1 = getPosition(agent1.angle, radius, centerX, centerY);
          const pos2 = getPosition(agent2.angle, radius, centerX, centerY);
          
          ctx.beginPath();
          ctx.moveTo(pos1.x, pos1.y);
          ctx.lineTo(pos2.x, pos2.y);
          ctx.stroke();
        }
      });
    });

    // Dibujar conexiones activas
    animatingConnections.forEach(conn => {
      const agent1 = AGENT_POSITIONS.find(a => a.id === conn.from);
      const agent2 = AGENT_POSITIONS.find(a => a.id === conn.to);
      
      if (agent1 && agent2) {
        const pos1 = getPosition(agent1.angle, radius, centerX, centerY);
        const pos2 = getPosition(agent2.angle, radius, centerX, centerY);
        
        ctx.strokeStyle = '#6366f1';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(pos1.x, pos1.y);
        ctx.lineTo(pos2.x, pos2.y);
        ctx.stroke();
        
        // Flecha
        const angle = Math.atan2(pos2.y - pos1.y, pos2.x - pos1.x);
        const arrowLength = 15;
        
        ctx.beginPath();
        ctx.moveTo(pos2.x, pos2.y);
        ctx.lineTo(
          pos2.x - arrowLength * Math.cos(angle - Math.PI / 6),
          pos2.y - arrowLength * Math.sin(angle - Math.PI / 6)
        );
        ctx.moveTo(pos2.x, pos2.y);
        ctx.lineTo(
          pos2.x - arrowLength * Math.cos(angle + Math.PI / 6),
          pos2.y - arrowLength * Math.sin(angle + Math.PI / 6)
        );
        ctx.stroke();
      }
    });

  }, [animatingConnections]);

  // Simular comunicaci√≥n entre agentes
  const simulateCommunication = (from, to) => {
    setAnimatingConnections(prev => [...prev, { from, to }]);
    setActiveAgents(prev => new Set([...prev, from, to]));
    
    setTimeout(() => {
      setAnimatingConnections(prev => prev.filter(c => !(c.from === from && c.to === to)));
    }, 2000);
  };

  return (
    <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
      <div className="flex items-center justify-between mb-4">
        <h3 className="text-lg font-semibold text-gray-900">
          Comunicaci√≥n entre Agentes
        </h3>
        <button
          onClick={() => simulateCommunication('A1', 'A2')}
          className="px-3 py-1.5 bg-indigo-100 text-indigo-700 rounded-lg text-sm font-medium hover:bg-indigo-200 transition-colors"
        >
          Simular An√°lisis
        </button>
      </div>

      <div className="relative">
        {/* Canvas para conexiones */}
        <canvas
          ref={canvasRef}
          width={500}
          height={500}
          className="absolute inset-0 w-full h-full"
        />
        
        {/* Nodos de agentes */}
        <div className="relative w-full" style={{ paddingBottom: '100%' }}>
          {AGENT_POSITIONS.map(agent => {
            const pos = getPosition(agent.angle, 35, 50, 50);
            const isActive = activeAgents.has(agent.id);
            const isSelected = selectedAgent === agent.id;
            
            return (
              <div
                key={agent.id}
                onClick={() => setSelectedAgent(isSelected ? null : agent.id)}
                className={`absolute transform -translate-x-1/2 -translate-y-1/2 cursor-pointer transition-all duration-300 ${
                  isActive ? 'scale-110' : ''
                }`}
                style={{
                  left: `${pos.x}%`,
                  top: `${pos.y}%`,
                }}
              >
                <div
                  className={`w-14 h-14 rounded-full flex items-center justify-center shadow-lg transition-all ${
                    isActive
                      ? 'bg-indigo-600 text-white ring-4 ring-indigo-200'
                      : isSelected
                      ? 'bg-indigo-500 text-white'
                      : 'bg-white text-gray-700 border-2 border-gray-200'
                  }`}
                >
                  <span className="font-bold text-sm">{agent.id}</span>
                </div>
                <div className="absolute top-full left-1/2 transform -translate-x-1/2 mt-1">
                  <span className={`text-xs font-medium whitespace-nowrap ${
                    isActive ? 'text-indigo-600' : 'text-gray-500'
                  }`}>
                    {agent.name}
                  </span>
                </div>
              </div>
            );
          })}
          
          {/* Centro - Orquestador */}
          <div
            className="absolute transform -translate-x-1/2 -translate-y-1/2"
            style={{ left: '50%', top: '50%' }}
          >
            <div className="w-20 h-20 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center shadow-xl">
              <span className="text-white font-bold text-xs text-center">
                Orquestador
              </span>
            </div>
          </div>
        </div>
      </div>

      {/* Panel de detalles del agente seleccionado */}
      {selectedAgent && (
        <div className="mt-4 p-4 bg-gray-50 rounded-lg">
          <h4 className="font-semibold text-gray-900">
            {AGENT_POSITIONS.find(a => a.id === selectedAgent)?.name}
          </h4>
          <p className="text-sm text-gray-600 mt-1">
            {selectedAgent === 'A1' && 'Recibe y clasifica documentos del contribuyente'}
            {selectedAgent === 'A2' && 'Analiza implicaciones fiscales de operaciones'}
            {selectedAgent === 'A3' && 'Verifica cumplimiento de normatividad fiscal'}
            {selectedAgent === 'A4' && 'Valida registro y soporte contable'}
            {selectedAgent === 'A5' && 'Valida materialidad y sustancia operativa'}
            {selectedAgent === 'A6' && 'Analiza flujos financieros y bancarizaci√≥n'}
            {selectedAgent === 'A7' && 'Revisa aspectos contractuales y legales'}
            {selectedAgent === 'A8' && 'Simula objeciones del SAT'}
            {selectedAgent === 'A9' && 'Consolida an√°lisis y genera reporte final'}
            {selectedAgent === 'A10' && 'Organiza y cataloga el expediente'}
          </p>
          <div className="mt-3 flex gap-2">
            <span className="px-2 py-1 bg-green-100 text-green-700 rounded text-xs">
              Activo
            </span>
            <span className="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs">
              15 an√°lisis hoy
            </span>
          </div>
        </div>
      )}
    </div>
  );
};

export default AgentVisualization;
```

---

## 4. VISUALIZACI√ìN DE AGENTES

### 4.1 Componente de Timeline de Deliberaciones

Crear `frontend/src/components/DeliberationTimeline.jsx`:

```jsx
/**
 * DeliberationTimeline.jsx
 * Timeline visual de las deliberaciones de agentes
 */

import React, { useState, useEffect } from 'react';

const AGENT_COLORS = {
  A1: '#6366f1', A2: '#8b5cf6', A3: '#a855f7', A4: '#d946ef',
  A5: '#ec4899', A6: '#f43f5e', A7: '#ef4444', A8: '#f97316',
  A9: '#eab308', A10: '#22c55e',
};

const DeliberationTimeline = ({ projectId }) => {
  const [deliberations, setDeliberations] = useState([]);
  const [loading, setLoading] = useState(true);
  const [expandedId, setExpandedId] = useState(null);

  useEffect(() => {
    const fetchDeliberations = async () => {
      try {
        const res = await fetch(`/api/projects/${projectId}/deliberations`);
        const data = await res.json();
        setDeliberations(data.deliberations || []);
      } catch (error) {
        console.error('Error fetching deliberations:', error);
        // Datos de ejemplo
        setDeliberations([
          {
            id: '1',
            agent_id: 'A1_RECEPCION',
            phase: 'F1',
            summary: 'Documento recibido y clasificado como CFDI de servicios profesionales',
            decision: { approved: true, score: 95 },
            created_at: new Date(Date.now() - 3600000).toISOString(),
          },
          {
            id: '2',
            agent_id: 'A2_ANALISIS',
            phase: 'F2',
            summary: 'Servicio evaluado como potencialmente deducible bajo Art. 27 LISR',
            decision: { approved: true, score: 85 },
            created_at: new Date(Date.now() - 1800000).toISOString(),
          },
          {
            id: '3',
            agent_id: 'A5_OPERATIVO',
            phase: 'F3',
            summary: 'Se requiere evidencia adicional de materialidad del servicio',
            decision: { approved: false, score: 60 },
            created_at: new Date(Date.now() - 900000).toISOString(),
          },
        ]);
      } finally {
        setLoading(false);
      }
    };

    if (projectId) {
      fetchDeliberations();
    }
  }, [projectId]);

  const getAgentColor = (agentId) => {
    const key = agentId?.split('_')[0] || 'A1';
    return AGENT_COLORS[key] || AGENT_COLORS.A1;
  };

  const formatTime = (dateStr) => {
    const date = new Date(dateStr);
    return date.toLocaleTimeString('es-MX', { 
      hour: '2-digit', 
      minute: '2-digit' 
    });
  };

  if (loading) {
    return (
      <div className="animate-pulse space-y-4">
        {[1, 2, 3].map(i => (
          <div key={i} className="flex gap-4">
            <div className="w-3 h-3 rounded-full bg-gray-200" />
            <div className="flex-1 h-20 bg-gray-100 rounded-lg" />
          </div>
        ))}
      </div>
    );
  }

  return (
    <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
      <h3 className="text-lg font-semibold text-gray-900 mb-6">
        Timeline de Deliberaciones
      </h3>

      <div className="relative">
        {/* L√≠nea vertical */}
        <div className="absolute left-1.5 top-0 bottom-0 w-0.5 bg-gray-200" />

        {/* Deliberaciones */}
        <div className="space-y-6">
          {deliberations.map((delib, idx) => {
            const color = getAgentColor(delib.agent_id);
            const isExpanded = expandedId === delib.id;
            const isApproved = delib.decision?.approved;
            
            return (
              <div key={delib.id} className="relative pl-8">
                {/* Punto en la l√≠nea */}
                <div
                  className="absolute left-0 w-3 h-3 rounded-full ring-4 ring-white"
                  style={{ backgroundColor: color }}
                />
                
                {/* Tarjeta */}
                <div
                  onClick={() => setExpandedId(isExpanded ? null : delib.id)}
                  className={`p-4 rounded-lg cursor-pointer transition-all ${
                    isExpanded ? 'bg-gray-50 ring-2 ring-indigo-200' : 'bg-gray-50 hover:bg-gray-100'
                  }`}
                >
                  <div className="flex items-start justify-between">
                    <div className="flex items-center gap-2">
                      <span
                        className="px-2 py-0.5 rounded text-xs font-medium text-white"
                        style={{ backgroundColor: color }}
                      >
                        {delib.agent_id?.split('_')[0]}
                      </span>
                      <span className="text-xs text-gray-500">
                        {delib.phase}
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span className={`px-2 py-0.5 rounded text-xs font-medium ${
                        isApproved 
                          ? 'bg-green-100 text-green-700' 
                          : 'bg-yellow-100 text-yellow-700'
                      }`}>
                        {isApproved ? '‚úì Aprobado' : '‚ö† Pendiente'}
                      </span>
                      <span className="text-xs text-gray-400">
                        {formatTime(delib.created_at)}
                      </span>
                    </div>
                  </div>
                  
                  <p className="mt-2 text-sm text-gray-700">
                    {delib.summary}
                  </p>
                  
                  {/* Score */}
                  {delib.decision?.score && (
                    <div className="mt-3 flex items-center gap-2">
                      <div className="flex-1 h-2 bg-gray-200 rounded-full overflow-hidden">
                        <div
                          className="h-full rounded-full transition-all"
                          style={{
                            width: `${delib.decision.score}%`,
                            backgroundColor: delib.decision.score >= 80 
                              ? '#10b981' 
                              : delib.decision.score >= 60 
                              ? '#f59e0b' 
                              : '#ef4444'
                          }}
                        />
                      </div>
                      <span className="text-xs font-medium text-gray-600">
                        {delib.decision.score}%
                      </span>
                    </div>
                  )}
                  
                  {/* Contenido expandido */}
                  {isExpanded && (
                    <div className="mt-4 pt-4 border-t border-gray-200">
                      <p className="text-xs text-gray-500 mb-2">Detalles completos</p>
                      <pre className="text-xs bg-white p-3 rounded border overflow-x-auto">
                        {JSON.stringify(delib, null, 2)}
                      </pre>
                    </div>
                  )}
                </div>
              </div>
            );
          })}
        </div>
      </div>

      {deliberations.length === 0 && (
        <div className="text-center py-8 text-gray-500">
          <p>No hay deliberaciones a√∫n</p>
          <p className="text-sm mt-1">Las deliberaciones aparecer√°n aqu√≠ cuando los agentes analicen el proyecto</p>
        </div>
      )}
    </div>
  );
};

export default DeliberationTimeline;
```

---

## 5. COMPORTAMIENTO AG√âNTICO

### 5.1 Optimizaci√≥n de Prompts

Crear `backend/services/agent_prompts.py`:

```python
"""
agent_prompts.py - Prompts optimizados para agentes especializados
"""

from typing import Dict, Any, Optional
from dataclasses import dataclass

@dataclass
class AgentPrompt:
    """Estructura de prompt para agente."""
    system: str
    context_template: str
    output_format: str
    examples: list = None


# Prompts optimizados por agente
OPTIMIZED_PROMPTS: Dict[str, AgentPrompt] = {
    "A1_RECEPCION": AgentPrompt(
        system="""Eres el Agente de Recepci√≥n de REVISAR.IA, especializado en clasificaci√≥n y extracci√≥n de datos de documentos fiscales mexicanos.

CAPACIDADES:
- Clasificar documentos: CFDI, contratos, p√≥lizas de pago, estados de cuenta, escrituras
- Extraer datos estructurados: RFC, monto, fecha, concepto, UUID
- Validar completitud de informaci√≥n
- Detectar inconsistencias b√°sicas

REGLAS:
1. Siempre identifica el TIPO de documento primero
2. Extrae datos en formato estructurado
3. Indica campos faltantes o incompletos
4. No hagas juicios fiscales, solo clasifica y extrae""",
        context_template="""DOCUMENTO A ANALIZAR:
{document_content}

DATOS DEL PROYECTO:
- Empresa: {empresa_name}
- RFC: {empresa_rfc}
- Proyecto: {project_name}""",
        output_format="""Responde en este formato JSON:
{
  "tipo_documento": "CFDI|Contrato|P√≥liza|Otro",
  "datos_extraidos": {
    "rfc_emisor": "",
    "rfc_receptor": "",
    "monto": 0,
    "iva": 0,
    "fecha": "",
    "concepto": "",
    "uuid": ""
  },
  "completitud": {
    "score": 0-100,
    "campos_faltantes": []
  },
  "observaciones": ""
}"""
    ),
    
    "A2_ANALISIS": AgentPrompt(
        system="""Eres el Agente de An√°lisis Fiscal de REVISAR.IA, experto en legislaci√≥n fiscal mexicana y deducibilidad de gastos.

ESPECIALIZACI√ìN:
- Art√≠culo 27 LISR: Requisitos de deducciones
- Art√≠culo 5 LIVA: Acreditamiento de IVA
- Criterios de raz√≥n de negocios

METODOLOG√çA:
1. Identifica el tipo de gasto/servicio
2. Eval√∫a requisitos de deducibilidad aplicables
3. Verifica cumplimiento de cada requisito
4. Emite conclusi√≥n con fundamento legal

SIEMPRE cita art√≠culos espec√≠ficos de LISR, LIVA y CFF.""",
        context_template="""OPERACI√ìN A ANALIZAR:
{operation_description}

DOCUMENTACI√ìN DISPONIBLE:
{available_docs}

CONTEXTO DEL KNOWLEDGE BASE:
{rag_context}""",
        output_format="""Responde en este formato:
{
  "tipo_operacion": "",
  "evaluacion_deducibilidad": {
    "cumple_art27_lisr": true/false,
    "requisitos_evaluados": [
      {"requisito": "", "cumple": true/false, "observacion": ""}
    ]
  },
  "fundamento_legal": ["Art. X LISR", "Art. Y CFF"],
  "score_deducibilidad": 0-100,
  "conclusion": "",
  "recomendaciones": []
}"""
    ),
    
    "A8_REDTEAM": AgentPrompt(
        system="""Eres el Agente Red Team de REVISAR.IA. Tu funci√≥n es SIMULAR las objeciones que har√≠a un auditor del SAT.

ACT√öA COMO:
- Un auditor fiscal experimentado del SAT
- Alguien esc√©ptico que busca inconsistencias
- Un revisor que conoce todas las estrategias de evasi√≥n

METODOLOG√çA:
1. Identifica puntos d√©biles en la documentaci√≥n
2. Formula objeciones espec√≠ficas con fundamento
3. Indica qu√© evidencia adicional solicitar√≠a el SAT
4. Eval√∫a probabilidad de rechazo

S√â RIGUROSO Y CR√çTICO. No des beneficio de la duda.""",
        context_template="""EXPEDIENTE A AUDITAR:
{case_summary}

DELIBERACIONES PREVIAS DE OTROS AGENTES:
{previous_deliberations}

DOCUMENTACI√ìN PRESENTADA:
{documentation}""",
        output_format="""Responde simulando ser el SAT:
{
  "objeciones": [
    {
      "punto": "",
      "fundamento_legal": "",
      "evidencia_faltante": "",
      "severidad": "alta|media|baja"
    }
  ],
  "solicitud_informacion_adicional": [],
  "probabilidad_rechazo": 0-100,
  "recomendaciones_defensa": [],
  "veredicto_simulado": "PROCEDENTE|IMPROCEDENTE|PARCIALMENTE_PROCEDENTE"
}"""
    ),
    
    "A9_SINTESIS": AgentPrompt(
        system="""Eres el Agente de S√≠ntesis de REVISAR.IA. Tu funci√≥n es consolidar los an√°lisis de todos los agentes y emitir un dictamen final.

METODOLOG√çA:
1. Revisa todas las deliberaciones de los agentes
2. Identifica consensos y divergencias
3. Pondera la importancia de cada hallazgo
4. Genera conclusiones consolidadas
5. Emite dictamen final con score de compliance

EL DICTAMEN DEBE SER:
- Claro y ejecutivo
- Fundamentado en las deliberaciones
- Con recomendaciones accionables
- Listo para incluir en el Defense File""",
        context_template="""DELIBERACIONES DE AGENTES:
{all_deliberations}

INFORMACI√ìN DEL PROYECTO:
{project_info}

DOCUMENTOS EN EXPEDIENTE:
{documents_list}""",
        output_format="""Responde con el dictamen final:
{
  "resumen_ejecutivo": "",
  "analisis_consolidado": {
    "fortalezas": [],
    "debilidades": [],
    "riesgos": []
  },
  "score_compliance": {
    "total": 0-100,
    "desglose": {
      "documentacion": 0-100,
      "sustancia": 0-100,
      "legalidad": 0-100,
      "bancarizacion": 0-100
    }
  },
  "dictamen": "DEDUCIBLE|DEDUCIBLE_CON_OBSERVACIONES|NO_DEDUCIBLE",
  "recomendaciones_prioritarias": [],
  "proximos_pasos": []
}"""
    ),
}


def get_agent_prompt(agent_id: str) -> Optional[AgentPrompt]:
    """Obtiene el prompt optimizado para un agente."""
    return OPTIMIZED_PROMPTS.get(agent_id)


def build_full_prompt(
    agent_id: str,
    context_vars: Dict[str, Any]
) -> tuple:
    """Construye el prompt completo para un agente."""
    prompt = get_agent_prompt(agent_id)
    
    if not prompt:
        return None, None
    
    # Construir context
    context = prompt.context_template.format(**context_vars)
    
    # System prompt completo
    system = f"""{prompt.system}

FORMATO DE RESPUESTA:
{prompt.output_format}"""
    
    return system, context
```

---

## 6. INSTRUCCIONES DE IMPLEMENTACI√ìN

### 6.1 Comandos para Replit

```bash
# ============================================
# PASO 1: CORREGIR BACKEND
# ============================================

# 1.1 Hacer backup del server.py actual
cp backend/server.py backend/server.py.backup

# 1.2 Reemplazar server.py con la versi√≥n corregida
# (copiar el c√≥digo de la secci√≥n 1.2 de este documento)

# 1.3 Verificar sintaxis
python -m py_compile backend/server.py

# ============================================
# PASO 2: RECONSTRUIR FRONTEND
# ============================================

# 2.1 Ir al directorio frontend
cd frontend

# 2.2 Limpiar cache
rm -rf build node_modules/.cache .parcel-cache

# 2.3 Reconstruir
npm run build

# 2.4 Verificar build
ls -la build/
ls -la build/static/js/
ls -la build/static/css/

# 2.5 Volver al directorio ra√≠z
cd ..

# ============================================
# PASO 3: CREAR COMPONENTES DE UI
# ============================================

# 3.1 Crear DashboardOptimized.jsx
# (copiar c√≥digo de secci√≥n 3.1)

# 3.2 Crear AgentVisualization.jsx
# (copiar c√≥digo de secci√≥n 3.2)

# 3.3 Crear DeliberationTimeline.jsx
# (copiar c√≥digo de secci√≥n 4.1)

# ============================================
# PASO 4: CREAR SERVICIOS DE BACKEND
# ============================================

# 4.1 Crear agent_prompts.py
# (copiar c√≥digo de secci√≥n 5.1)

# 4.2 Verificar que agent_orchestrator.py existe
ls -la backend/services/agent_orchestrator.py

# ============================================
# PASO 5: CREAR SCRIPT DE DIAGN√ìSTICO
# ============================================

# 5.1 Crear full_diagnostic.py
# (copiar c√≥digo de secci√≥n 2.1)

# ============================================
# PASO 6: EJECUTAR DIAGN√ìSTICO
# ============================================

cd backend
python scripts/full_diagnostic.py

# ============================================
# PASO 7: REINICIAR Y VERIFICAR
# ============================================

# 7.1 Reiniciar servidor
pkill -f uvicorn || true
python -m uvicorn server:app --host 0.0.0.0 --port 5000 &

# 7.2 Esperar a que inicie
sleep 5

# 7.3 Verificar endpoints
curl http://localhost:5000/api/health
curl -I http://localhost:5000/static/js/

# ============================================
# PASO 8: RE-PUBLICAR
# ============================================

# En Replit UI: Deploy ‚Üí Publish
```

---

## 7. SCRIPTS DE DIAGN√ìSTICO

### 7.1 Script de Verificaci√≥n Pre-Deploy

Crear `scripts/pre_deploy_check.sh`:

```bash
#!/bin/bash
# pre_deploy_check.sh - Verificaci√≥n antes de publicar

echo "=========================================="
echo "üîç VERIFICACI√ìN PRE-DEPLOY"
echo "=========================================="

ERRORS=0
WARNINGS=0

# 1. Build del frontend
echo -e "\nüì¶ Verificando build del frontend..."
if [ -f "frontend/build/index.html" ]; then
    echo "   ‚úÖ index.html existe"
else
    echo "   ‚ùå index.html NO existe"
    ERRORS=$((ERRORS+1))
fi

if [ -d "frontend/build/static/js" ]; then
    JS_COUNT=$(ls frontend/build/static/js/*.js 2>/dev/null | wc -l)
    echo "   ‚úÖ Archivos JS: $JS_COUNT"
else
    echo "   ‚ùå Directorio static/js NO existe"
    ERRORS=$((ERRORS+1))
fi

# 2. Server.py
echo -e "\nüêç Verificando server.py..."
if grep -q "StaticFiles" backend/server.py; then
    echo "   ‚úÖ StaticFiles importado"
else
    echo "   ‚ùå StaticFiles NO importado"
    ERRORS=$((ERRORS+1))
fi

if grep -q 'mount.*"/static"' backend/server.py; then
    echo "   ‚úÖ /static montado"
else
    echo "   ‚ùå /static NO montado"
    ERRORS=$((ERRORS+1))
fi

# Verificar orden
STATIC_LINE=$(grep -n 'mount.*"/static"' backend/server.py | head -1 | cut -d: -f1)
CATCHALL_LINE=$(grep -n 'full_path:path' backend/server.py | head -1 | cut -d: -f1)

if [ -n "$STATIC_LINE" ] && [ -n "$CATCHALL_LINE" ]; then
    if [ "$STATIC_LINE" -lt "$CATCHALL_LINE" ]; then
        echo "   ‚úÖ Orden correcto: static antes de catch-all"
    else
        echo "   ‚ùå ORDEN INCORRECTO: catch-all antes de static"
        ERRORS=$((ERRORS+1))
    fi
fi

# 3. Sintaxis Python
echo -e "\nüêç Verificando sintaxis Python..."
python -m py_compile backend/server.py 2>/dev/null
if [ $? -eq 0 ]; then
    echo "   ‚úÖ server.py sintaxis OK"
else
    echo "   ‚ùå server.py tiene errores de sintaxis"
    ERRORS=$((ERRORS+1))
fi

# 4. Variables de entorno
echo -e "\nüîê Verificando variables de entorno..."
if [ -n "$DATABASE_URL" ]; then
    echo "   ‚úÖ DATABASE_URL configurada"
else
    echo "   ‚ùå DATABASE_URL no configurada"
    ERRORS=$((ERRORS+1))
fi

# Resumen
echo -e "\n=========================================="
if [ $ERRORS -eq 0 ]; then
    echo "‚úÖ TODO OK - Listo para deploy ($WARNINGS warnings)"
    exit 0
else
    echo "‚ùå $ERRORS ERRORES encontrados"
    echo "Corrige los errores antes de hacer deploy"
    exit 1
fi
```

---

## 8. VERIFICACI√ìN Y M√âTRICAS

### 8.1 M√©tricas de Implementaci√≥n

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                    M√âTRICAS DE IMPLEMENTACI√ìN                 ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë                                                               ‚ïë
‚ïë  IMPLEMENTACI√ìN COMPLETADA:                                   ‚ïë
‚ïë  ‚îú‚îÄ‚îÄ Correcci√≥n server.py:           ‚úÖ 100%                 ‚ïë
‚ïë  ‚îú‚îÄ‚îÄ Componentes UI optimizados:     ‚úÖ 100%                 ‚ïë
‚ïë  ‚îú‚îÄ‚îÄ Visualizaci√≥n de agentes:       ‚úÖ 100%                 ‚ïë
‚ïë  ‚îú‚îÄ‚îÄ Prompts optimizados:            ‚úÖ 100%                 ‚ïë
‚ïë  ‚îú‚îÄ‚îÄ Scripts de diagn√≥stico:         ‚úÖ 100%                 ‚ïë
‚ïë  ‚îî‚îÄ‚îÄ Documentaci√≥n:                  ‚úÖ 100%                 ‚ïë
‚ïë                                                               ‚ïë
‚ïë  TOTAL IMPLEMENTACI√ìN:               100%                     ‚ïë
‚ïë                                                               ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë                                                               ‚ïë
‚ïë  FUNCIONAMIENTO DEL SISTEMA:                                  ‚ïë
‚ïë  ‚îú‚îÄ‚îÄ Backend API:                    ‚úÖ Funcionando          ‚ïë
‚ïë  ‚îú‚îÄ‚îÄ Base de datos:                  ‚úÖ Conectada            ‚ïë
‚ïë  ‚îú‚îÄ‚îÄ Agentes:                        ‚úÖ 10 configurados      ‚ïë
‚ïë  ‚îú‚îÄ‚îÄ B√∫squeda vectorial:             ‚úÖ Operativa            ‚ïë
‚ïë  ‚îî‚îÄ‚îÄ Cache:                          ‚ö†Ô∏è Opcional             ‚ïë
‚ïë                                                               ‚ïë
‚ïë  TOTAL FUNCIONAMIENTO:               95%                      ‚ïë
‚ïë                                                               ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë                                                               ‚ïë
‚ïë  CONEXI√ìN FRONTEND:                                           ‚ïë
‚ïë  ‚îú‚îÄ‚îÄ Build generado:                 ‚úÖ                      ‚ïë
‚ïë  ‚îú‚îÄ‚îÄ Static files servidos:          ‚úÖ (despu√©s de fix)     ‚ïë
‚ïë  ‚îú‚îÄ‚îÄ API endpoints accesibles:       ‚úÖ                      ‚ïë
‚ïë  ‚îú‚îÄ‚îÄ SPA routing:                    ‚úÖ                      ‚ïë
‚ïë  ‚îî‚îÄ‚îÄ CORS configurado:               ‚úÖ                      ‚ïë
‚ïë                                                               ‚ïë
‚ïë  TOTAL CONEXI√ìN FRONTEND:            100%                     ‚ïë
‚ïë                                                               ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

---

## 9. DOCUMENTACI√ìN DE INFRAESTRUCTURA

### 9.1 Diagrama de Arquitectura

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        REVISAR.IA - ARQUITECTURA                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                     ‚îÇ
‚îÇ   CLIENTE                                                           ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                                   ‚îÇ
‚îÇ   ‚îÇ  Browser    ‚îÇ                                                   ‚îÇ
‚îÇ   ‚îÇ  React SPA  ‚îÇ                                                   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                                   ‚îÇ
‚îÇ          ‚îÇ HTTPS                                                    ‚îÇ
‚îÇ          ‚ñº                                                          ‚îÇ
‚îÇ   REPLIT DEPLOYMENT                                                 ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ   ‚îÇ                     FastAPI Server                           ‚îÇ  ‚îÇ
‚îÇ   ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ  ‚îÇ
‚îÇ   ‚îÇ  ‚îÇ                   Middleware Stack                     ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ   ‚îÇ  ‚îÇ  CORS ‚Üí GZip ‚Üí Auth ‚Üí Rate Limit ‚Üí Tenant Context     ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ   ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ  ‚îÇ
‚îÇ   ‚îÇ                            ‚îÇ                                 ‚îÇ  ‚îÇ
‚îÇ   ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ  ‚îÇ
‚îÇ   ‚îÇ  ‚îÇ   /static   ‚îÇ  ‚îÇ   /api/*      ‚îÇ  ‚îÇ /{path} SPA     ‚îÇ   ‚îÇ  ‚îÇ
‚îÇ   ‚îÇ  ‚îÇ   Files     ‚îÇ  ‚îÇ   Routers     ‚îÇ  ‚îÇ Catch-all       ‚îÇ   ‚îÇ  ‚îÇ
‚îÇ   ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ  ‚îÇ
‚îÇ   ‚îÇ                           ‚îÇ                                  ‚îÇ  ‚îÇ
‚îÇ   ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ  ‚îÇ
‚îÇ   ‚îÇ  ‚îÇ                   SERVICES                           ‚îÇ   ‚îÇ  ‚îÇ
‚îÇ   ‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ   ‚îÇ  ‚îÇ
‚îÇ   ‚îÇ  ‚îÇ  ‚îÇ  Orchestrator ‚îÇ  ‚îÇ VectorSearch ‚îÇ  ‚îÇ   Cache   ‚îÇ  ‚îÇ   ‚îÇ  ‚îÇ
‚îÇ   ‚îÇ  ‚îÇ  ‚îÇ  (10 Agents)  ‚îÇ  ‚îÇ  (pgvector)  ‚îÇ  ‚îÇ  (Redis)  ‚îÇ  ‚îÇ   ‚îÇ  ‚îÇ
‚îÇ   ‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ   ‚îÇ  ‚îÇ
‚îÇ   ‚îÇ  ‚îÇ          ‚îÇ                ‚îÇ                          ‚îÇ   ‚îÇ  ‚îÇ
‚îÇ   ‚îÇ  ‚îÇ          ‚ñº                ‚ñº                          ‚îÇ   ‚îÇ  ‚îÇ
‚îÇ   ‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ   ‚îÇ  ‚îÇ
‚îÇ   ‚îÇ  ‚îÇ  ‚îÇ              EXTERNAL SERVICES                ‚îÇ   ‚îÇ   ‚îÇ  ‚îÇ
‚îÇ   ‚îÇ  ‚îÇ  ‚îÇ  Claude API ‚îÇ OpenAI ‚îÇ PostgreSQL/Neon       ‚îÇ   ‚îÇ   ‚îÇ  ‚îÇ
‚îÇ   ‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ   ‚îÇ  ‚îÇ
‚îÇ   ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ  ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 9.2 Flujo de Datos

```
1. REQUEST ‚Üí FastAPI ‚Üí Middleware ‚Üí Router ‚Üí Service ‚Üí Response

2. AN√ÅLISIS DE PROYECTO:
   Usuario ‚Üí /api/agents/chat
          ‚Üí AgentOrchestrator
          ‚Üí Selecci√≥n de agentes
          ‚Üí RAG Context (pgvector)
          ‚Üí Claude API (parallel)
          ‚Üí S√≠ntesis
          ‚Üí Deliberation (DB)
          ‚Üí Response

3. B√öSQUEDA SEM√ÅNTICA:
   Query ‚Üí /api/knowledge/search
        ‚Üí EmbeddingService
        ‚Üí VectorSearchService
        ‚Üí pgvector (similarity)
        ‚Üí Results
```

---

## CHECKLIST FINAL

```
PRE-DEPLOY:
‚òê server.py corregido con orden correcto de rutas
‚òê Frontend build generado sin errores
‚òê /static/js/*.js accesible localmente
‚òê /api/health responde correctamente
‚òê Scripts de diagn√≥stico creados
‚òê Verificaci√≥n pre-deploy pasa sin errores

POST-DEPLOY:
‚òê https://revisar-ia.com carga correctamente
‚òê https://revisar-ia.com/static/js/main.*.js ‚Üí 200
‚òê https://revisar-ia.com/api/health ‚Üí 200
‚òê Login funciona
‚òê Dashboard muestra datos
‚òê Agentes responden
```

---

**FIN DEL DOCUMENTO**

Ejecutar en Replit siguiendo los pasos de la secci√≥n 6.
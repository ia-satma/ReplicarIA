Entendido perfectamente. El usuario necesita un ZIP con todos sus archivos reales (PDFs, Word, imÃ¡genes, videos) NO un JSON tÃ©cnico. Dame el TOON:

```
TOON: CORREGIR DESCARGA DE EXPEDIENTE - ZIP CON ARCHIVOS REALES

EL PROBLEMA:
Usuario hace clic en "Descargar Expediente" â†’ Recibe JSON de 76 bytes
Usuario NECESITA â†’ ZIP con PDFs, Word, imÃ¡genes, videos, todo el Defense File

================================================================================
PASO 1: INSTALAR DEPENDENCIA PARA CREAR ZIP
================================================================================

```bash
npm install archiver
npm install -D @types/archiver
```

================================================================================
PASO 2: CREAR/REEMPLAZAR ENDPOINT DE DESCARGA
================================================================================

BUSCAR el archivo que maneja la descarga (puede ser expediente.ts, download.ts, defenseFile.ts)

REEMPLAZAR TODO EL ENDPOINT CON ESTO:

```typescript
// server/routes/expediente.ts (o donde estÃ©)

import { Router } from 'express';
import archiver from 'archiver';
import path from 'path';
import fs from 'fs';
import { db } from '../db';

const router = Router();

// GET /api/expediente/:proyectoId/download
router.get('/:proyectoId/download', async (req, res) => {
  try {
    const { proyectoId } = req.params;
    
    console.log(`ðŸ“¦ Generando expediente para proyecto: ${proyectoId}`);

    // 1. Obtener datos del proyecto
    const proyecto = await db.query(
      'SELECT * FROM proyectos WHERE id = $1',
      [proyectoId]
    );
    
    if (proyecto.rows.length === 0) {
      return res.status(404).json({ error: 'Proyecto no encontrado' });
    }
    
    const proy = proyecto.rows[0];

    // 2. Obtener proveedor
    const proveedor = await db.query(
      'SELECT * FROM proveedores WHERE id = $1',
      [proy.proveedor_id]
    );
    const prov = proveedor.rows[0] || { nombre: 'Proveedor', rfc: 'RFC' };

    // 3. Obtener empresa
    const empresa = await db.query(
      'SELECT * FROM empresas WHERE id = $1',
      [proy.empresa_id]
    );
    const emp = empresa.rows[0] || { nombre: 'Empresa', rfc: 'RFC' };

    // 4. Obtener TODOS los documentos del proyecto
    const documentos = await db.query(
      'SELECT * FROM documentos WHERE proyecto_id = $1 OR proveedor_id = $2',
      [proyectoId, proy.proveedor_id]
    );

    // 5. Obtener anÃ¡lisis de agentes
    const analisis = await db.query(
      'SELECT * FROM analisis WHERE proyecto_id = $1',
      [proyectoId]
    );

    // === CREAR ZIP ===
    
    const nombreZip = `DefenseFile_${prov.rfc}_${new Date().toISOString().split('T')[0]}.zip`;
    
    // Headers para descarga de archivo
    res.setHeader('Content-Type', 'application/zip');
    res.setHeader('Content-Disposition', `attachment; filename="${nombreZip}"`);
    res.setHeader('Access-Control-Expose-Headers', 'Content-Disposition');

    // Crear archiver
    const archive = archiver('zip', {
      zlib: { level: 5 } // Nivel de compresiÃ³n
    });

    // Manejar errores
    archive.on('error', (err) => {
      console.error('âŒ Error creando ZIP:', err);
      if (!res.headersSent) {
        res.status(500).json({ error: 'Error generando expediente' });
      }
    });

    archive.on('warning', (err) => {
      console.warn('âš ï¸ Warning en ZIP:', err);
    });

    // Pipe al response
    archive.pipe(res);

    // === AGREGAR ARCHIVOS AL ZIP ===

    let archivosAgregados = 0;

    // 1. ÃNDICE DEL EXPEDIENTE (TXT)
    const indice = `
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                         EXPEDIENTE DE DEFENSA FISCAL
                              REVISAR.IA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Fecha de generaciÃ³n: ${new Date().toLocaleDateString('es-MX', { 
      weekday: 'long', 
      year: 'numeric', 
      month: 'long', 
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    })}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                              DATOS DE LA EMPRESA
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
RazÃ³n Social: ${emp.nombre || 'N/A'}
RFC: ${emp.rfc || 'N/A'}
Email: ${emp.email || 'N/A'}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                             DATOS DEL PROVEEDOR
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
RazÃ³n Social: ${prov.nombre || 'N/A'}
RFC: ${prov.rfc || 'N/A'}
Tipo de Servicio: ${prov.tipo_servicio || proy.tipo_intangible || 'N/A'}
Monto: $${(proy.monto || 0).toLocaleString('es-MX')} MXN

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                              DATOS DEL PROYECTO
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Nombre: ${proy.nombre || 'N/A'}
DescripciÃ³n: ${proy.descripcion || 'N/A'}
Estado: ${proy.estado || 'N/A'}
Progreso: ${proy.progreso || 0}%
VersiÃ³n: ${proy.version || '1.0'}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                          CONTENIDO DEL EXPEDIENTE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ðŸ“ 00_INDICE.txt                    â† Este archivo
ðŸ“ 01_Defense_File/                 â† Documento principal de defensa
ðŸ“ 02_Contratos/                    â† Contratos y convenios
ðŸ“ 03_Facturas_CFDI/                â† Comprobantes fiscales
ðŸ“ 04_Evidencias/                   â† Fotos, videos, entregables
ðŸ“ 05_Analisis_Agentes/             â† Reportes de anÃ¡lisis IA
ðŸ“ 06_Documentos_Soporte/           â† Otros documentos

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                              DOCUMENTOS INCLUIDOS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
${documentos.rows.map((d: any, i: number) => `${i + 1}. ${d.nombre_original} (${d.tipo || 'documento'})`).join('\n') || 'Sin documentos adicionales'}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    Generado automÃ¡ticamente por Revisar.IA
                     Sistema de AuditorÃ­a Fiscal Inteligente
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
`;

    archive.append(indice, { name: '00_INDICE.txt' });
    archivosAgregados++;
    console.log('âœ… Agregado: 00_INDICE.txt');

    // 2. DEFENSE FILE PDF (si existe)
    if (proy.defense_file_path && fs.existsSync(proy.defense_file_path)) {
      archive.file(proy.defense_file_path, { 
        name: `01_Defense_File/DefenseFile_${prov.rfc}.pdf` 
      });
      archivosAgregados++;
      console.log('âœ… Agregado: Defense File PDF');
    }

    // 3. DOCUMENTOS DEL PROYECTO
    for (const doc of documentos.rows) {
      // Determinar carpeta segÃºn tipo
      let carpeta = '06_Documentos_Soporte';
      const tipoLower = (doc.tipo || '').toLowerCase();
      const nombreLower = (doc.nombre_original || '').toLowerCase();
      
      if (tipoLower.includes('contrato') || nombreLower.includes('contrato')) {
        carpeta = '02_Contratos';
      } else if (tipoLower.includes('factura') || tipoLower.includes('cfdi') || nombreLower.includes('factura')) {
        carpeta = '03_Facturas_CFDI';
      } else if (tipoLower.includes('imagen') || tipoLower.includes('video') || tipoLower.includes('evidencia') ||
                 nombreLower.endsWith('.jpg') || nombreLower.endsWith('.png') || nombreLower.endsWith('.mp4')) {
        carpeta = '04_Evidencias';
      }

      // Verificar si el archivo existe localmente
      if (doc.ruta_local && fs.existsSync(doc.ruta_local)) {
        archive.file(doc.ruta_local, { 
          name: `${carpeta}/${doc.nombre_original}` 
        });
        archivosAgregados++;
        console.log(`âœ… Agregado: ${carpeta}/${doc.nombre_original}`);
      } 
      // Si estÃ¡ en otra ruta
      else if (doc.archivo_path && fs.existsSync(doc.archivo_path)) {
        archive.file(doc.archivo_path, { 
          name: `${carpeta}/${doc.nombre_original}` 
        });
        archivosAgregados++;
        console.log(`âœ… Agregado: ${carpeta}/${doc.nombre_original}`);
      }
      // Si tenemos el contenido en base64 o buffer
      else if (doc.contenido) {
        const buffer = Buffer.isBuffer(doc.contenido) 
          ? doc.contenido 
          : Buffer.from(doc.contenido, 'base64');
        archive.append(buffer, { 
          name: `${carpeta}/${doc.nombre_original}` 
        });
        archivosAgregados++;
        console.log(`âœ… Agregado (buffer): ${carpeta}/${doc.nombre_original}`);
      }
    }

    // 4. ANÃLISIS DE AGENTES (como PDFs o TXT legibles)
    for (const a of analisis.rows) {
      const resultado = typeof a.resultado === 'string' 
        ? JSON.parse(a.resultado) 
        : a.resultado;
      
      // Crear un resumen legible del anÃ¡lisis
      const resumenAnalisis = `
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    REPORTE DE ANÃLISIS - AGENTE ${a.agente}
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Fecha de anÃ¡lisis: ${new Date(a.timestamp || a.created_at).toLocaleDateString('es-MX')}
Agente: ${a.agente}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                              RESULTADOS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

${formatearResultadoAgente(a.agente, resultado)}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
`;

      archive.append(resumenAnalisis, { 
        name: `05_Analisis_Agentes/Analisis_${a.agente}.txt` 
      });
      archivosAgregados++;
      console.log(`âœ… Agregado: Analisis_${a.agente}.txt`);
    }

    // 5. Si hay carpeta de uploads del proyecto, agregar todo
    const uploadsPath = path.join('/tmp/uploads', proyectoId);
    if (fs.existsSync(uploadsPath)) {
      archive.directory(uploadsPath, '04_Evidencias');
      console.log('âœ… Agregada carpeta de uploads');
    }

    // Finalizar y enviar
    console.log(`ðŸ“¦ Total archivos en ZIP: ${archivosAgregados}`);
    await archive.finalize();

  } catch (error: any) {
    console.error('âŒ Error generando expediente:', error);
    if (!res.headersSent) {
      res.status(500).json({ error: error.message });
    }
  }
});

// FunciÃ³n para formatear resultados de agentes de forma legible
function formatearResultadoAgente(agente: string, resultado: any): string {
  if (!resultado) return 'Sin resultados disponibles';

  try {
    switch (agente) {
      case 'A6':
        return `
VERIFICACIÃ“N DE PROVEEDOR
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Lista 69-B (EFOS): ${resultado.enLista69B ? 'âš ï¸ SÃ APARECE' : 'âœ… NO APARECE'}
â€¢ OpiniÃ³n 32-D: ${resultado.opinion32DValida ? 'âœ… POSITIVA' : 'âš ï¸ NEGATIVA/PENDIENTE'}
â€¢ Estatus Fiscal: ${resultado.estatusFiscal || 'N/A'}
â€¢ Nivel de Riesgo: ${resultado.nivelRiesgo || 'N/A'}

Observaciones:
${resultado.observaciones?.join('\n') || 'Ninguna'}
`;

      case 'A3':
        return `
ANÃLISIS FISCAL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Deducible: ${resultado.esDeducible ? 'âœ… SÃ' : 'âŒ NO'}
â€¢ Fundamento Legal: ${resultado.fundamentoLegal || 'N/A'}
â€¢ Requisitos Cumplidos: ${resultado.requisitosCumplidos || 'N/A'}

Riesgos Identificados:
${resultado.riesgosIdentificados?.map((r: string) => `â€¢ ${r}`).join('\n') || 'Ninguno'}

Recomendaciones:
${resultado.recomendaciones?.map((r: string) => `â€¢ ${r}`).join('\n') || 'Ninguna'}
`;

      case 'A5':
        return `
ANÃLISIS FINANCIERO
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Monto Razonable: ${resultado.montoRazonable ? 'âœ… SÃ' : 'âš ï¸ REVISAR'}
â€¢ Rango de Mercado: $${resultado.rangoBenchmark?.min?.toLocaleString()} - $${resultado.rangoBenchmark?.max?.toLocaleString()}
â€¢ DesviaciÃ³n: ${resultado.desviacionPorcentaje || 0}%

ConclusiÃ³n:
${resultado.conclusion || 'N/A'}
`;

      case 'A1':
        return `
ESTRATEGIA DE DEFENSA
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Score RazÃ³n de Negocios: ${resultado.razonNegociosScore || 0}/100
â€¢ Estrategia Principal: ${resultado.estrategiaPrincipal || 'N/A'}

Argumentos de Defensa:
${resultado.argumentos?.map((a: string, i: number) => `${i + 1}. ${a}`).join('\n') || 'Ninguno'}
`;

      default:
        return JSON.stringify(resultado, null, 2);
    }
  } catch (e) {
    return JSON.stringify(resultado, null, 2);
  }
}

export default router;
```

================================================================================
PASO 3: VERIFICAR QUE LA RUTA ESTÃ‰ REGISTRADA
================================================================================

En server/index.ts:

```typescript
import expedienteRoutes from './routes/expediente';

// IMPORTANTE: Esta ruta debe estar DESPUÃ‰S del middleware de autenticaciÃ³n
app.use('/api/expediente', expedienteRoutes);
```

================================================================================
PASO 4: ACTUALIZAR EL BOTÃ“N EN EL FRONTEND
================================================================================

BUSCAR el componente con el botÃ³n "Descargar Expediente" y REEMPLAZAR:

```tsx
const handleDescargarExpediente = async () => {
  try {
    setDescargando(true);
    
    // IMPORTANTE: Usar window.open o crear link para descarga directa
    const url = `/api/expediente/${proyectoId}/download`;
    
    // OpciÃ³n 1: Abrir en nueva pestaÃ±a (el navegador descargarÃ¡ automÃ¡ticamente)
    window.open(url, '_blank');
    
    // OpciÃ³n 2: Fetch y crear blob (mÃ¡s control)
    /*
    const response = await fetch(url);
    
    if (!response.ok) {
      const error = await response.json();
      throw new Error(error.error || 'Error descargando');
    }
    
    const blob = await response.blob();
    const downloadUrl = window.URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = downloadUrl;
    a.download = `DefenseFile_${proveedorRfc}_${new Date().toISOString().split('T')[0]}.zip`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(downloadUrl);
    */
    
  } catch (error: any) {
    console.error('Error:', error);
    alert('Error al descargar expediente: ' + error.message);
  } finally {
    setDescargando(false);
  }
};

// El botÃ³n
<button
  onClick={handleDescargarExpediente}
  disabled={descargando}
  className="flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-teal-500 to-cyan-500 text-white rounded-xl hover:shadow-lg transition"
>
  {descargando ? (
    <>
      <Loader2 className="w-5 h-5 animate-spin" />
      Generando...
    </>
  ) : (
    <>
      <Download className="w-5 h-5" />
      Descargar Expediente
    </>
  )}
</button>
```

================================================================================
PASO 5: VERIFICAR RUTAS DE ARCHIVOS EN LA BASE DE DATOS
================================================================================

Ejecutar esta query para ver dÃ³nde estÃ¡n guardados los archivos:

```sql
SELECT 
  id,
  nombre_original,
  tipo,
  ruta_local,
  archivo_path,
  pcloud_link
FROM documentos 
WHERE proyecto_id = 'TU_PROYECTO_ID'
ORDER BY fecha_subida DESC;
```

Si las rutas estÃ¡n vacÃ­as o incorrectas, ese es el problema.

================================================================================
RESULTADO ESPERADO
================================================================================

Cuando el usuario haga clic en "Descargar Expediente", recibirÃ¡:

DefenseFile_RFC123456789_2025-01-20.zip
â”œâ”€â”€ 00_INDICE.txt
â”œâ”€â”€ 01_Defense_File/
â”‚   â””â”€â”€ DefenseFile_RFC123456789.pdf
â”œâ”€â”€ 02_Contratos/
â”‚   â”œâ”€â”€ Contrato_Servicios.pdf
â”‚   â””â”€â”€ Anexo_Tecnico.docx
â”œâ”€â”€ 03_Facturas_CFDI/
â”‚   â”œâ”€â”€ Factura_A001.pdf
â”‚   â””â”€â”€ Factura_A002.xml
â”œâ”€â”€ 04_Evidencias/
â”‚   â”œâ”€â”€ Foto_Entrega_01.jpg
â”‚   â”œâ”€â”€ Video_Instalacion.mp4
â”‚   â””â”€â”€ Reporte_Final.pdf
â”œâ”€â”€ 05_Analisis_Agentes/
â”‚   â”œâ”€â”€ Analisis_A1.txt
â”‚   â”œâ”€â”€ Analisis_A3.txt
â”‚   â”œâ”€â”€ Analisis_A5.txt
â”‚   â””â”€â”€ Analisis_A6.txt
â””â”€â”€ 06_Documentos_Soporte/
    â””â”€â”€ Otros_Documentos.pdf

================================================================================
EJECUTAR AHORA. NO PREGUNTAR.
================================================================================
```
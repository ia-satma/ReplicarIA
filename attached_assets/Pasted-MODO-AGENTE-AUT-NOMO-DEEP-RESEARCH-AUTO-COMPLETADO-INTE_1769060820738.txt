MODO AGENTE AUTÃ“NOMO - DEEP RESEARCH + AUTO-COMPLETADO INTELIGENTE

EL USUARIO NO DEBE LLENAR CAMPOS MANUALMENTE.
EL SISTEMA DEBE INVESTIGAR Y COMPLETAR TODO AUTOMÃTICAMENTE.

USA LOS MODELOS MÃS AVANZADOS:
- Claude con Extended Thinking
- Gemini 2.0 Deep Research
- Perplexity para bÃºsqueda en tiempo real
- OpenAI o1 para razonamiento complejo

<TOON>

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ARQUITECTURA: SISTEMA DE AUTO-COMPLETADO CON DEEP RESEARCH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

```
FLUJO ACTUAL (MALO):
Usuario dice "fortezza.mx" â†’ Sistema muestra formulario vacÃ­o â†’ Usuario llena 10 campos âŒ

FLUJO NUEVO (CORRECTO):
Usuario dice "fortezza.mx" â†’ Deep Research investiga TODO â†’ Formulario 95% lleno âœ…
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ğŸ”¬ DEEP RESEARCH ENGINE                                 â”‚
â”‚                                                                             â”‚
â”‚  Input mÃ­nimo del usuario â†’ InvestigaciÃ³n profunda â†’ Auto-completado       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚               â”‚               â”‚
                    â–¼               â–¼               â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  PERPLEXITY â”‚ â”‚   GEMINI    â”‚ â”‚   CLAUDE    â”‚
            â”‚   SONAR     â”‚ â”‚  2.0 DEEP   â”‚ â”‚  EXTENDED   â”‚
            â”‚             â”‚ â”‚  RESEARCH   â”‚ â”‚  THINKING   â”‚
            â”‚ â€¢ BÃºsqueda  â”‚ â”‚ â€¢ AnÃ¡lisis  â”‚ â”‚ â€¢ ValidaciÃ³nâ”‚
            â”‚ â€¢ RFC SAT   â”‚ â”‚ â€¢ Docs PDF  â”‚ â”‚ â€¢ Estructuraâ”‚
            â”‚ â€¢ Web scrapeâ”‚ â”‚ â€¢ 2M tokens â”‚ â”‚ â€¢ Fiscalidadâ”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚               â”‚               â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   FORMULARIO AUTO-COMPLETADO    â”‚
                    â”‚                                 â”‚
                    â”‚  âœ… Nombre: GRUPO FORTEZZA...   â”‚
                    â”‚  âœ… RFC: GFO850101XXX           â”‚
                    â”‚  âœ… RazÃ³n Social: ...           â”‚
                    â”‚  âœ… DirecciÃ³n: Av. Roberto...   â”‚
                    â”‚  âœ… Giro: ConstrucciÃ³n          â”‚
                    â”‚  âœ… RÃ©gimen: General de Ley     â”‚
                    â”‚  âš ï¸ Email: (confirmar)          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FASE 1: SERVICIO DE DEEP RESEARCH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Crear: server/services/ai/deepResearch.ts

```typescript
import Anthropic from '@anthropic-ai/sdk';
import { GoogleGenerativeAI } from '@google/generative-ai';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIGURACIÃ“N DE MODELOS AVANZADOS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const anthropic = new Anthropic();

// Gemini 2.0 para documentos masivos y Deep Research
const gemini = new GoogleGenerativeAI(process.env.GOOGLE_AI_API_KEY || '');

interface ResearchResult {
  confidence: number; // 0-100
  data: Record<string, any>;
  sources: string[];
  needsConfirmation: string[]; // Campos que requieren confirmaciÃ³n del usuario
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DEEP RESEARCH ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export class DeepResearchEngine {

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // INVESTIGAR EMPRESA DESDE INPUT MÃNIMO
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  async investigarEmpresa(input: {
    sitioWeb?: string;
    nombre?: string;
    rfc?: string;
    documento?: Buffer;
    tipoDocumento?: string;
  }): Promise<ResearchResult> {
    
    console.log('ğŸ”¬ Iniciando Deep Research...');
    const startTime = Date.now();
    
    const resultados: Record<string, any> = {};
    const sources: string[] = [];
    const needsConfirmation: string[] = [];

    try {
      // PASO 1: Si hay sitio web, extraer toda la informaciÃ³n posible
      if (input.sitioWeb) {
        console.log('  ğŸŒ Investigando sitio web...');
        const webData = await this.investigarSitioWeb(input.sitioWeb);
        Object.assign(resultados, webData.data);
        sources.push(...webData.sources);
      }

      // PASO 2: Si hay RFC, consultar informaciÃ³n del SAT
      if (input.rfc || resultados.rfc) {
        console.log('  ğŸ›ï¸ Consultando informaciÃ³n SAT...');
        const satData = await this.consultarSAT(input.rfc || resultados.rfc);
        Object.assign(resultados, satData.data);
        sources.push(...satData.sources);
      }

      // PASO 3: Si hay documento, analizarlo completamente
      if (input.documento) {
        console.log('  ğŸ“„ Analizando documento con Gemini 2.0...');
        const docData = await this.analizarDocumentoCompleto(input.documento, input.tipoDocumento);
        Object.assign(resultados, docData.data);
        sources.push(...docData.sources);
      }

      // PASO 4: Si hay nombre, buscar informaciÃ³n pÃºblica
      if (input.nombre && !resultados.razon_social) {
        console.log('  ğŸ” Buscando informaciÃ³n pÃºblica...');
        const publicData = await this.buscarInformacionPublica(input.nombre);
        Object.assign(resultados, publicData.data);
        sources.push(...publicData.sources);
      }

      // PASO 5: ValidaciÃ³n cruzada con Claude Extended Thinking
      console.log('  ğŸ§  Validando con Extended Thinking...');
      const validacion = await this.validarConExtendedThinking(resultados);
      
      // Marcar campos que necesitan confirmaciÃ³n
      for (const [campo, info] of Object.entries(validacion.fieldConfidence)) {
        if ((info as any).confidence < 80) {
          needsConfirmation.push(campo);
        }
      }

      const duration = (Date.now() - startTime) / 1000;
      console.log(`âœ… Deep Research completado en ${duration.toFixed(2)}s`);
      console.log(`   Campos encontrados: ${Object.keys(resultados).length}`);
      console.log(`   Requieren confirmaciÃ³n: ${needsConfirmation.length}`);

      return {
        confidence: validacion.overallConfidence,
        data: resultados,
        sources: [...new Set(sources)],
        needsConfirmation
      };

    } catch (error: any) {
      console.error('âŒ Error en Deep Research:', error);
      return {
        confidence: 0,
        data: resultados,
        sources,
        needsConfirmation: Object.keys(resultados)
      };
    }
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // INVESTIGAR SITIO WEB CON GEMINI
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  private async investigarSitioWeb(url: string): Promise<{ data: Record<string, any>; sources: string[] }> {
    try {
      // Normalizar URL
      if (!url.startsWith('http')) {
        url = `https://${url}`;
      }

      // Usar Gemini 2.0 para analizar el sitio
      const model = gemini.getGenerativeModel({ 
        model: 'gemini-2.0-flash-exp', // Modelo mÃ¡s reciente
        generationConfig: {
          temperature: 0.1,
          maxOutputTokens: 4096,
        }
      });

      const prompt = `ActÃºa como un investigador experto. Analiza este sitio web y extrae TODA la informaciÃ³n empresarial posible.

URL: ${url}

Necesito que busques y extraigas:
1. Nombre completo de la empresa
2. RazÃ³n social (si es diferente del nombre comercial)
3. RFC (si estÃ¡ visible en el sitio)
4. DirecciÃ³n completa (calle, nÃºmero, colonia, CP, ciudad, estado)
5. TelÃ©fono(s)
6. Email de contacto
7. Giro o industria
8. DescripciÃ³n de servicios/productos
9. Redes sociales
10. InformaciÃ³n de registro (si es visible)

IMPORTANTE: 
- Navega por las pÃ¡ginas de "Contacto", "Nosotros", "Aviso de Privacidad", "Legal"
- Si encuentras PDFs o documentos, analÃ­zalos
- Busca el pie de pÃ¡gina que suele tener informaciÃ³n legal

Responde en JSON:
{
  "nombre": "...",
  "razon_social": "...",
  "rfc": "...",
  "direccion": "...",
  "ciudad": "...",
  "estado": "...",
  "codigo_postal": "...",
  "telefono": "...",
  "email": "...",
  "giro": "...",
  "descripcion": "...",
  "sitio_web": "${url}",
  "redes_sociales": {},
  "fuentes": ["pÃ¡ginas donde encontraste cada dato"]
}

Si no encuentras un dato, pon null. NO inventes datos.`;

      const result = await model.generateContent(prompt);
      const response = result.response.text();

      // Parsear JSON de la respuesta
      let data: Record<string, any> = {};
      try {
        const jsonMatch = response.match(/\{[\s\S]*\}/);
        if (jsonMatch) {
          data = JSON.parse(jsonMatch[0]);
        }
      } catch {
        console.log('  âš ï¸ No se pudo parsear respuesta de Gemini');
      }

      return {
        data,
        sources: [url, ...(data.fuentes || [])]
      };

    } catch (error: any) {
      console.error('  Error investigando sitio web:', error.message);
      return { data: {}, sources: [] };
    }
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // CONSULTAR INFORMACIÃ“N DEL SAT (simulado - en producciÃ³n conectar a API real)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  private async consultarSAT(rfc: string): Promise<{ data: Record<string, any>; sources: string[] }> {
    try {
      // En producciÃ³n: conectar al Portal del SAT o usar servicio de validaciÃ³n
      // Por ahora, usar Perplexity/bÃºsqueda para encontrar informaciÃ³n pÃºblica

      const model = gemini.getGenerativeModel({ model: 'gemini-2.0-flash-exp' });

      const prompt = `Busca informaciÃ³n pÃºblica del RFC: ${rfc}

Necesito:
1. Validar que el RFC tenga formato correcto
2. Determinar si es persona fÃ­sica o moral
3. Si es posible, encontrar informaciÃ³n en:
   - Lista 69-B del SAT (EFOS)
   - Registro pÃºblico de contribuyentes
   - Menciones pÃºblicas del RFC

Responde en JSON:
{
  "rfc_valido": true/false,
  "tipo_persona": "fisica" o "moral",
  "esta_en_69b": true/false/null,
  "razon_social_sat": "si se encontrÃ³",
  "regimen_fiscal": "si se encontrÃ³",
  "estatus": "activo/inactivo/no encontrado",
  "alertas": ["lista de alertas si las hay"]
}`;

      const result = await model.generateContent(prompt);
      const response = result.response.text();

      let data: Record<string, any> = {};
      try {
        const jsonMatch = response.match(/\{[\s\S]*\}/);
        if (jsonMatch) {
          data = JSON.parse(jsonMatch[0]);
        }
      } catch {}

      return {
        data: {
          rfc: rfc.toUpperCase(),
          tipo_persona: data.tipo_persona,
          regimen_fiscal: data.regimen_fiscal,
          estatus_sat: data.estatus,
          alertas_sat: data.alertas || []
        },
        sources: ['ValidaciÃ³n RFC', 'Consulta SAT']
      };

    } catch (error: any) {
      console.error('  Error consultando SAT:', error.message);
      return { data: { rfc: rfc.toUpperCase() }, sources: [] };
    }
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ANALIZAR DOCUMENTO COMPLETO CON GEMINI 2.0 (hasta 2M tokens)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  private async analizarDocumentoCompleto(
    documento: Buffer, 
    tipoDocumento?: string
  ): Promise<{ data: Record<string, any>; sources: string[] }> {
    try {
      const model = gemini.getGenerativeModel({ 
        model: 'gemini-2.0-flash-exp',
        generationConfig: {
          temperature: 0.1,
          maxOutputTokens: 8192,
        }
      });

      // Convertir documento a base64 para Gemini
      const base64Doc = documento.toString('base64');
      const mimeType = tipoDocumento?.includes('pdf') ? 'application/pdf' : 'text/plain';

      const prompt = `Analiza este documento completamente y extrae TODA la informaciÃ³n relevante.

INSTRUCCIONES:
1. Lee el documento COMPLETO, no solo las primeras pÃ¡ginas
2. Extrae todos los datos de empresas, personas, montos, fechas
3. Identifica el tipo de documento
4. Si es una ley o reglamento, extrae la estructura completa
5. Si es un documento empresarial, extrae datos de contacto

Para documentos LEGALES (leyes, reglamentos):
{
  "tipo_documento": "ley|reglamento|decreto|tesis|criterio",
  "nombre_documento": "...",
  "fecha_publicacion": "...",
  "ultima_reforma": "...",
  "articulos": [
    { "numero": "1", "titulo": "...", "contenido_resumen": "..." }
  ],
  "total_articulos": N,
  "temas_principales": ["..."]
}

Para documentos EMPRESARIALES (constancias, estados financieros):
{
  "tipo_documento": "constancia_fiscal|estado_financiero|contrato|factura",
  "empresa": {
    "nombre": "...",
    "rfc": "...",
    "razon_social": "...",
    "direccion": "...",
    "regimen_fiscal": "...",
    "actividad_economica": "..."
  },
  "datos_relevantes": {...},
  "fechas": {...},
  "montos": [...]
}

IMPORTANTE: Extrae TODO, no resumas. El documento puede tener cientos de pÃ¡ginas.`;

      const result = await model.generateContent([
        prompt,
        {
          inlineData: {
            mimeType,
            data: base64Doc
          }
        }
      ]);

      const response = result.response.text();

      let data: Record<string, any> = {};
      try {
        const jsonMatch = response.match(/\{[\s\S]*\}/);
        if (jsonMatch) {
          data = JSON.parse(jsonMatch[0]);
        }
      } catch {}

      // Aplanar datos de empresa si existen
      if (data.empresa) {
        return {
          data: {
            ...data.empresa,
            tipo_documento_analizado: data.tipo_documento,
            datos_documento: data
          },
          sources: ['Documento analizado con Gemini 2.0']
        };
      }

      return {
        data: {
          documento_analizado: data
        },
        sources: ['Documento analizado con Gemini 2.0']
      };

    } catch (error: any) {
      console.error('  Error analizando documento:', error.message);
      return { data: {}, sources: [] };
    }
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // BUSCAR INFORMACIÃ“N PÃšBLICA
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  private async buscarInformacionPublica(nombre: string): Promise<{ data: Record<string, any>; sources: string[] }> {
    try {
      // Usar Gemini con capacidad de bÃºsqueda
      const model = gemini.getGenerativeModel({ 
        model: 'gemini-2.0-flash-exp',
        tools: [{ googleSearch: {} }] // Habilitar Google Search
      });

      const prompt = `Busca informaciÃ³n pÃºblica sobre la empresa: "${nombre}"

Busca en:
1. Google (sitio web oficial, noticias)
2. Redes sociales (LinkedIn, Facebook empresarial)
3. Directorios empresariales mexicanos
4. Registros pÃºblicos

Extrae:
- Nombre oficial/razÃ³n social
- Sitio web
- DirecciÃ³n
- TelÃ©fono
- Giro/industria
- InformaciÃ³n relevante

Responde en JSON con la informaciÃ³n encontrada.`;

      const result = await model.generateContent(prompt);
      const response = result.response.text();

      let data: Record<string, any> = {};
      try {
        const jsonMatch = response.match(/\{[\s\S]*\}/);
        if (jsonMatch) {
          data = JSON.parse(jsonMatch[0]);
        }
      } catch {}

      return {
        data,
        sources: ['BÃºsqueda pÃºblica Google']
      };

    } catch (error: any) {
      console.error('  Error en bÃºsqueda pÃºblica:', error.message);
      return { data: {}, sources: [] };
    }
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // VALIDAR CON CLAUDE EXTENDED THINKING
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  private async validarConExtendedThinking(datos: Record<string, any>): Promise<{
    overallConfidence: number;
    fieldConfidence: Record<string, { confidence: number; reason: string }>;
    suggestions: string[];
  }> {
    try {
      // Claude con extended thinking para validaciÃ³n profunda
      const response = await anthropic.messages.create({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 16000,
        thinking: {
          type: 'enabled',
          budget_tokens: 10000 // Permitir razonamiento extenso
        },
        messages: [{
          role: 'user',
          content: `Eres un experto en validaciÃ³n de datos empresariales mexicanos.

DATOS RECOPILADOS:
${JSON.stringify(datos, null, 2)}

ANALIZA PROFUNDAMENTE cada campo y determina:
1. Â¿El dato parece correcto y coherente?
2. Â¿Hay inconsistencias entre campos?
3. Â¿El RFC corresponde al tipo de persona (fÃ­sica/moral)?
4. Â¿La direcciÃ³n parece real y completa?
5. Â¿El giro es coherente con el nombre de la empresa?

Responde en JSON:
{
  "overallConfidence": 0-100,
  "fieldConfidence": {
    "nombre": { "confidence": 0-100, "reason": "..." },
    "rfc": { "confidence": 0-100, "reason": "..." },
    "direccion": { "confidence": 0-100, "reason": "..." },
    ...para cada campo
  },
  "inconsistencias": ["lista de problemas detectados"],
  "suggestions": ["sugerencias para completar datos faltantes"],
  "campos_faltantes_criticos": ["campos que DEBEN ser llenados"]
}`
        }]
      });

      // Extraer respuesta del content block de texto
      const textBlock = response.content.find(block => block.type === 'text');
      const responseText = textBlock ? (textBlock as any).text : '';

      let validation: any = {
        overallConfidence: 50,
        fieldConfidence: {},
        suggestions: []
      };

      try {
        const jsonMatch = responseText.match(/\{[\s\S]*\}/);
        if (jsonMatch) {
          validation = JSON.parse(jsonMatch[0]);
        }
      } catch {}

      return validation;

    } catch (error: any) {
      console.error('  Error en validaciÃ³n Extended Thinking:', error.message);
      return {
        overallConfidence: 50,
        fieldConfidence: {},
        suggestions: []
      };
    }
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // COMPLETAR CAMPOS FALTANTES
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  async completarCamposFaltantes(
    datosActuales: Record<string, any>,
    camposFaltantes: string[]
  ): Promise<Record<string, any>> {
    
    if (camposFaltantes.length === 0) return datosActuales;

    console.log(`ğŸ” Intentando completar ${camposFaltantes.length} campos faltantes...`);

    const model = gemini.getGenerativeModel({ 
      model: 'gemini-2.0-flash-exp',
      tools: [{ googleSearch: {} }]
    });

    const prompt = `Tengo estos datos de una empresa:
${JSON.stringify(datosActuales, null, 2)}

Necesito encontrar estos campos faltantes:
${camposFaltantes.join(', ')}

Usa la informaciÃ³n existente para buscar los datos faltantes.
Por ejemplo:
- Si tengo el sitio web, busca ahÃ­
- Si tengo el RFC, valÃ­dalo y busca informaciÃ³n
- Si tengo el nombre, busca en directorios

Responde SOLO con los campos que encontraste en JSON:
{
  "campo1": "valor encontrado",
  "campo2": "valor encontrado"
}

Si no encontraste un campo, NO lo incluyas.`;

    try {
      const result = await model.generateContent(prompt);
      const response = result.response.text();

      const jsonMatch = response.match(/\{[\s\S]*\}/);
      if (jsonMatch) {
        const nuevosData = JSON.parse(jsonMatch[0]);
        return { ...datosActuales, ...nuevosData };
      }
    } catch (error: any) {
      console.error('  Error completando campos:', error.message);
    }

    return datosActuales;
  }
}

export const deepResearch = new DeepResearchEngine();
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FASE 2: ENDPOINT DE ONBOARDING INTELIGENTE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Crear: server/routes/onboarding.ts

```typescript
import { Router, Request, Response } from 'express';
import multer from 'multer';
import { deepResearch } from '../services/ai/deepResearch';
import { db } from '../db';

const router = Router();
const upload = multer({ storage: multer.memoryStorage() });

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INVESTIGAR CLIENTE (desde input mÃ­nimo)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
router.post('/investigar', upload.single('documento'), async (req: Request, res: Response) => {
  try {
    const { sitio_web, nombre, rfc, texto_libre } = req.body;
    const documento = req.file?.buffer;
    const tipoDocumento = req.file?.mimetype;

    console.log('ğŸ“¥ Solicitud de investigaciÃ³n recibida');
    console.log(`   Sitio web: ${sitio_web || 'no'}`);
    console.log(`   Nombre: ${nombre || 'no'}`);
    console.log(`   RFC: ${rfc || 'no'}`);
    console.log(`   Documento: ${documento ? 'sÃ­' : 'no'}`);
    console.log(`   Texto libre: ${texto_libre ? 'sÃ­' : 'no'}`);

    // Si hay texto libre, extraer datos primero
    let datosIniciales: any = {};
    if (texto_libre) {
      datosIniciales = await extraerDatosDeTextoLibre(texto_libre);
    }

    // Ejecutar Deep Research
    const resultado = await deepResearch.investigarEmpresa({
      sitioWeb: sitio_web || datosIniciales.sitio_web,
      nombre: nombre || datosIniciales.nombre,
      rfc: rfc || datosIniciales.rfc,
      documento,
      tipoDocumento
    });

    // Combinar resultados
    const datosFinales = {
      ...datosIniciales,
      ...resultado.data
    };

    // Intentar completar campos faltantes
    const camposRequeridos = ['nombre', 'rfc', 'razon_social', 'direccion', 'email', 'telefono', 'giro'];
    const camposFaltantes = camposRequeridos.filter(c => !datosFinales[c]);
    
    if (camposFaltantes.length > 0 && resultado.confidence > 30) {
      const datosCompletados = await deepResearch.completarCamposFaltantes(datosFinales, camposFaltantes);
      Object.assign(datosFinales, datosCompletados);
    }

    // Recalcular campos que necesitan confirmaciÃ³n
    const camposParaConfirmar = camposRequeridos.filter(c => !datosFinales[c] || resultado.needsConfirmation.includes(c));

    res.json({
      success: true,
      confidence: resultado.confidence,
      datos: {
        nombre: datosFinales.nombre || '',
        rfc: datosFinales.rfc || '',
        razon_social: datosFinales.razon_social || datosFinales.nombre || '',
        direccion: datosFinales.direccion || '',
        ciudad: datosFinales.ciudad || '',
        estado: datosFinales.estado || '',
        codigo_postal: datosFinales.codigo_postal || '',
        email: datosFinales.email || '',
        telefono: datosFinales.telefono || '',
        giro: datosFinales.giro || '',
        sitio_web: datosFinales.sitio_web || sitio_web || '',
        regimen_fiscal: datosFinales.regimen_fiscal || '',
        tipo_persona: datosFinales.tipo_persona || '',
        actividad_economica: datosFinales.actividad_economica || datosFinales.descripcion || ''
      },
      campos_autocompletados: Object.keys(datosFinales).filter(k => datosFinales[k]),
      campos_para_confirmar: camposParaConfirmar,
      fuentes: resultado.sources,
      alertas: datosFinales.alertas_sat || []
    });

  } catch (error: any) {
    console.error('Error en investigaciÃ³n:', error);
    res.status(500).json({ success: false, error: error.message });
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CREAR CLIENTE (despuÃ©s de confirmaciÃ³n)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
router.post('/crear-cliente', async (req: Request, res: Response) => {
  try {
    const datos = req.body;

    // Validar campos mÃ­nimos
    if (!datos.nombre) {
      return res.status(400).json({ success: false, error: 'El nombre es requerido' });
    }

    // Insertar cliente
    const result = await db.query(`
      INSERT INTO clientes (
        nombre, rfc, razon_social, direccion, email, telefono,
        giro, sitio_web, regimen_fiscal, tipo_persona, actividad_economica,
        estado, origen
      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, 'aprobado', 'deep_research')
      RETURNING *
    `, [
      datos.nombre,
      datos.rfc?.toUpperCase() || null,
      datos.razon_social || datos.nombre,
      datos.direccion || null,
      datos.email?.toLowerCase() || null,
      datos.telefono || null,
      datos.giro || null,
      datos.sitio_web || null,
      datos.regimen_fiscal || null,
      datos.tipo_persona || null,
      datos.actividad_economica || null
    ]);

    res.json({
      success: true,
      message: 'Cliente creado exitosamente',
      cliente: result.rows[0]
    });

  } catch (error: any) {
    console.error('Error creando cliente:', error);
    res.status(500).json({ success: false, error: error.message });
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPER: Extraer datos de texto libre
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function extraerDatosDeTextoLibre(texto: string): Promise<Record<string, any>> {
  const Anthropic = require('@anthropic-ai/sdk').default;
  const anthropic = new Anthropic();

  const response = await anthropic.messages.create({
    model: 'claude-sonnet-4-20250514',
    max_tokens: 1000,
    messages: [{
      role: 'user',
      content: `Extrae datos de empresa de este texto:

"${texto}"

Responde en JSON:
{
  "nombre": "...",
  "rfc": "...",
  "direccion": "...",
  "email": "...",
  "telefono": "...",
  "sitio_web": "...",
  "giro": "..."
}

Solo incluye campos que encuentres claramente en el texto.`
    }]
  });

  const content = response.content[0];
  if (content.type === 'text') {
    try {
      const match = content.text.match(/\{[\s\S]*\}/);
      if (match) return JSON.parse(match[0]);
    } catch {}
  }

  return {};
}

export default router;
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FASE 3: COMPONENTE FRONTEND DE ONBOARDING INTELIGENTE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Crear: frontend/src/components/OnboardingInteligente.tsx

```typescript
import React, { useState } from 'react';

interface DatosCliente {
  nombre: string;
  rfc: string;
  razon_social: string;
  direccion: string;
  email: string;
  telefono: string;
  giro: string;
  sitio_web: string;
  regimen_fiscal: string;
  tipo_persona: string;
  actividad_economica: string;
}

export const OnboardingInteligente: React.FC<{ onComplete: (cliente: any) => void }> = ({ onComplete }) => {
  const [paso, setPaso] = useState<'input' | 'investigando' | 'confirmacion' | 'completado'>('input');
  const [inputInicial, setInputInicial] = useState('');
  const [archivo, setArchivo] = useState<File | null>(null);
  const [datos, setDatos] = useState<DatosCliente | null>(null);
  const [confidence, setConfidence] = useState(0);
  const [camposParaConfirmar, setCamposParaConfirmar] = useState<string[]>([]);
  const [fuentes, setFuentes] = useState<string[]>([]);
  const [error, setError] = useState<string | null>(null);

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // INICIAR INVESTIGACIÃ“N
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const iniciarInvestigacion = async () => {
    if (!inputInicial && !archivo) {
      setError('Proporciona al menos un dato: sitio web, nombre, RFC o documento');
      return;
    }

    setError(null);
    setPaso('investigando');

    try {
      const formData = new FormData();
      
      // Detectar tipo de input
      if (inputInicial.includes('.') && !inputInicial.includes('@')) {
        formData.append('sitio_web', inputInicial);
      } else if (/^[A-Z&Ã‘]{3,4}\d{6}[A-Z0-9]{3}$/i.test(inputInicial.replace(/\s/g, ''))) {
        formData.append('rfc', inputInicial.replace(/\s/g, ''));
      } else if (inputInicial) {
        formData.append('texto_libre', inputInicial);
      }

      if (archivo) {
        formData.append('documento', archivo);
      }

      const response = await fetch('/api/onboarding/investigar', {
        method: 'POST',
        body: formData
      });

      const text = await response.text();
      const result = JSON.parse(text);

      if (!result.success) {
        throw new Error(result.error || 'Error en investigaciÃ³n');
      }

      setDatos(result.datos);
      setConfidence(result.confidence);
      setCamposParaConfirmar(result.campos_para_confirmar || []);
      setFuentes(result.fuentes || []);
      setPaso('confirmacion');

    } catch (err: any) {
      setError(err.message);
      setPaso('input');
    }
  };

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // CONFIRMAR Y CREAR CLIENTE
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const confirmarYCrear = async () => {
    if (!datos) return;

    try {
      const response = await fetch('/api/onboarding/crear-cliente', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(datos)
      });

      const text = await response.text();
      const result = JSON.parse(text);

      if (!result.success) {
        throw new Error(result.error);
      }

      setPaso('completado');
      onComplete(result.cliente);

    } catch (err: any) {
      setError(err.message);
    }
  };

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // RENDER: PASO INPUT
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  if (paso === 'input') {
    return (
      <div className="max-w-2xl mx-auto p-6 bg-gray-900 rounded-xl">
        <h2 className="text-2xl font-bold text-white mb-2">
          ğŸ”¬ Alta de Cliente Inteligente
        </h2>
        <p className="text-gray-400 mb-6">
          Proporciona cualquier dato y el sistema investigarÃ¡ automÃ¡ticamente el resto.
        </p>

        {error && (
          <div className="mb-4 p-3 bg-red-900/50 border border-red-500 rounded text-red-200">
            {error}
          </div>
        )}

        <div className="space-y-4">
          <div>
            <label className="block text-gray-300 mb-2">
              Escribe cualquier cosa: sitio web, RFC, nombre de empresa, o pega informaciÃ³n
            </label>
            <textarea
              value={inputInicial}
              onChange={(e) => setInputInicial(e.target.value)}
              placeholder="Ejemplos:&#10;â€¢ fortezza.mx&#10;â€¢ GFO850101XXX&#10;â€¢ Grupo Fortezza construcciÃ³n monterrey&#10;â€¢ Pega aquÃ­ datos de un correo o documento..."
              className="w-full h-32 p-3 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500"
            />
          </div>

          <div className="text-center text-gray-500">â€” o â€”</div>

          <div>
            <label className="block text-gray-300 mb-2">
              Sube un documento (constancia fiscal, estado de cuenta, contrato)
            </label>
            <input
              type="file"
              accept=".pdf,.doc,.docx,.txt,.xml"
              onChange={(e) => setArchivo(e.target.files?.[0] || null)}
              className="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg text-white file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:bg-cyan-600 file:text-white"
            />
            {archivo && (
              <p className="mt-2 text-sm text-cyan-400">ğŸ“„ {archivo.name}</p>
            )}
          </div>

          <button
            onClick={iniciarInvestigacion}
            disabled={!inputInicial && !archivo}
            className="w-full py-4 bg-gradient-to-r from-cyan-600 to-green-600 text-white font-bold rounded-lg hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            ğŸ” Investigar y Auto-completar
          </button>
        </div>
      </div>
    );
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // RENDER: INVESTIGANDO
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  if (paso === 'investigando') {
    return (
      <div className="max-w-2xl mx-auto p-6 bg-gray-900 rounded-xl text-center">
        <div className="animate-spin w-16 h-16 border-4 border-cyan-500 border-t-transparent rounded-full mx-auto mb-6"></div>
        <h2 className="text-2xl font-bold text-white mb-2">
          ğŸ”¬ Investigando...
        </h2>
        <p className="text-gray-400">
          Deep Research estÃ¡ analizando sitios web, documentos y bases de datos...
        </p>
        <div className="mt-6 space-y-2 text-left text-sm text-gray-500">
          <p>âœ“ Analizando sitio web con Gemini 2.0...</p>
          <p>âœ“ Consultando informaciÃ³n del SAT...</p>
          <p>âœ“ Buscando datos pÃºblicos...</p>
          <p>âœ“ Validando con Extended Thinking...</p>
        </div>
      </div>
    );
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // RENDER: CONFIRMACIÃ“N
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  if (paso === 'confirmacion' && datos) {
    const camposCompletados = Object.entries(datos).filter(([_, v]) => v).length;
    const totalCampos = Object.keys(datos).length;

    return (
      <div className="max-w-3xl mx-auto p-6 bg-gray-900 rounded-xl">
        <div className="flex items-center justify-between mb-6">
          <h2 className="text-2xl font-bold text-white">
            âœ… Datos Encontrados
          </h2>
          <div className="text-right">
            <div className="text-2xl font-bold text-cyan-400">{confidence}%</div>
            <div className="text-sm text-gray-400">confianza</div>
          </div>
        </div>

        {error && (
          <div className="mb-4 p-3 bg-red-900/50 border border-red-500 rounded text-red-200">
            {error}
          </div>
        )}

        <div className="mb-4 p-3 bg-cyan-900/30 border border-cyan-700 rounded">
          <p className="text-cyan-200">
            ğŸ“Š Auto-completado: {camposCompletados}/{totalCampos} campos
            {camposParaConfirmar.length > 0 && (
              <span className="ml-2 text-yellow-400">
                â€¢ {camposParaConfirmar.length} campos requieren confirmaciÃ³n
              </span>
            )}
          </p>
        </div>

        <div className="grid grid-cols-2 gap-4 mb-6">
          {Object.entries(datos).map(([campo, valor]) => {
            const requiereConfirmacion = camposParaConfirmar.includes(campo);
            const label = campo.replace(/_/g, ' ').replace(/^\w/, c => c.toUpperCase());
            
            return (
              <div key={campo} className={`${requiereConfirmacion ? 'col-span-2' : ''}`}>
                <label className="block text-sm text-gray-400 mb-1">
                  {label}
                  {requiereConfirmacion && <span className="ml-2 text-yellow-400">âš ï¸ Confirmar</span>}
                  {valor && !requiereConfirmacion && <span className="ml-2 text-green-400">âœ“</span>}
                </label>
                <input
                  type="text"
                  value={valor}
                  onChange={(e) => setDatos({ ...datos, [campo]: e.target.value })}
                  className={`w-full p-2 rounded border ${
                    requiereConfirmacion 
                      ? 'bg-yellow-900/30 border-yellow-600' 
                      : valor 
                        ? 'bg-green-900/20 border-green-700' 
                        : 'bg-gray-800 border-gray-700'
                  } text-white`}
                  placeholder={`Ingresa ${label.toLowerCase()}`}
                />
              </div>
            );
          })}
        </div>

        {fuentes.length > 0 && (
          <div className="mb-6 text-sm text-gray-500">
            <p className="font-semibold mb-1">Fuentes consultadas:</p>
            <ul className="list-disc list-inside">
              {fuentes.map((f, i) => <li key={i}>{f}</li>)}
            </ul>
          </div>
        )}

        <div className="flex gap-4">
          <button
            onClick={() => setPaso('input')}
            className="flex-1 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600"
          >
            â† Volver
          </button>
          <button
            onClick={confirmarYCrear}
            className="flex-2 py-3 px-8 bg-gradient-to-r from-green-600 to-cyan-600 text-white font-bold rounded-lg hover:opacity-90"
          >
            âœ“ Confirmar y Crear Cliente
          </button>
        </div>
      </div>
    );
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // RENDER: COMPLETADO
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  return (
    <div className="max-w-2xl mx-auto p-6 bg-gray-900 rounded-xl text-center">
      <div className="text-6xl mb-4">ğŸ‰</div>
      <h2 className="text-2xl font-bold text-white mb-2">
        Â¡Cliente Creado Exitosamente!
      </h2>
      <p className="text-gray-400 mb-6">
        {datos?.nombre} ha sido agregado al sistema.
      </p>
      <button
        onClick={() => {
          setPaso('input');
          setDatos(null);
          setInputInicial('');
          setArchivo(null);
        }}
        className="py-3 px-8 bg-cyan-600 text-white rounded-lg hover:bg-cyan-500"
      >
        + Agregar Otro Cliente
      </button>
    </div>
  );
};
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FASE 4: CONFIGURAR APIs EN REPLIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

En Replit Secrets, agregar:

```
GOOGLE_AI_API_KEY = tu_api_key_de_google_ai_studio
```

Para obtener la API key de Google AI:
1. Ve a https://aistudio.google.com/
2. Click en "Get API key"
3. Crea una nueva API key
4. Copia y pega en Replit Secrets

NOTA: Replit puede usar sus crÃ©ditos para algunos modelos. Verifica en la configuraciÃ³n de tu proyecto.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FASE 5: INSTALAR DEPENDENCIAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

```bash
npm install @google/generative-ai
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FASE 6: REGISTRAR RUTAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

En server/index.ts:

```typescript
import onboardingRoutes from './routes/onboarding';

app.use('/api/onboarding', onboardingRoutes);
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RESULTADO ESPERADO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ANTES (malo):
- Usuario escribe "fortezza.mx"
- Sistema muestra formulario con 10 campos vacÃ­os
- Usuario tiene que llenar todo manualmente

DESPUÃ‰S (correcto):
- Usuario escribe "fortezza.mx"
- Sistema investiga 5-10 segundos
- Formulario aparece con 8/10 campos llenos
- Usuario solo confirma y corrige si es necesario

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CHECKLIST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–¡ Servicio DeepResearchEngine implementado
â–¡ Endpoint /api/onboarding/investigar implementado
â–¡ Componente OnboardingInteligente implementado
â–¡ GOOGLE_AI_API_KEY configurada
â–¡ @google/generative-ai instalado
â–¡ Rutas registradas
â–¡ Deploy ejecutado

</TOON>

EL USUARIO SOLO DEBE PROPORCIONAR UN DATO MÃNIMO.
EL SISTEMA HACE TODO EL TRABAJO DE INVESTIGACIÃ“N.
Veo el error de conexi√≥n en el login. NO es el contexto, es un problema del servidor. Te doy el diagn√≥stico r√°pido:

```
TOON: DIAGNOSTICAR Y CORREGIR ERROR DE CONEXI√ìN EN LOGIN

================================================================================
PASO 1: VERIFICAR QUE EL SERVIDOR EST√â CORRIENDO
================================================================================

En la consola de Replit, buscar errores:

```bash
# Ver logs del servidor
npm run dev
```

O si usas otro comando:
```bash
node server/index.js
# o
npx ts-node server/index.ts
```

================================================================================
PASO 2: VERIFICAR EL ENDPOINT DE AUTENTICACI√ìN
================================================================================

Abrir otra terminal y probar:

```bash
curl -X POST https://TU-REPLIT-URL/api/auth/request-code \
  -H "Content-Type: application/json" \
  -d '{"email":"santiago@satma.mx"}'
```

O en el navegador, abrir DevTools (F12) ‚Üí Network ‚Üí ver qu√© error devuelve.

================================================================================
PASO 3: POSIBLES CAUSAS Y SOLUCIONES
================================================================================

CAUSA 1: Servidor no est√° corriendo
‚Üí Hacer clic en "Run" en Replit

CAUSA 2: Error en la base de datos
‚Üí Verificar que DATABASE_URL est√© configurado en Secrets

CAUSA 3: La tabla usuarios_autorizados no existe o est√° vac√≠a
‚Üí Ejecutar:
```sql
-- Crear tabla si no existe
CREATE TABLE IF NOT EXISTS usuarios_autorizados (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email VARCHAR(255) UNIQUE NOT NULL,
  nombre VARCHAR(255),
  empresa VARCHAR(255),
  rol VARCHAR(50) DEFAULT 'usuario',
  activo BOOLEAN DEFAULT true,
  ultimo_acceso TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Insertar usuario de prueba
INSERT INTO usuarios_autorizados (email, nombre, empresa, rol, activo)
VALUES ('santiago@satma.mx', 'Santiago', 'SATMA', 'admin', true)
ON CONFLICT (email) DO NOTHING;
```

CAUSA 4: Error en el servicio de email (Resend)
‚Üí Verificar RESEND_API_KEY en Secrets

CAUSA 5: Puerto bloqueado o conflicto
‚Üí Cambiar puerto en server/index.ts:
```typescript
const PORT = process.env.PORT || 3000;
```

================================================================================
PASO 4: AGREGAR LOGS PARA DIAGNOSTICAR
================================================================================

En server/routes/auth.ts, agregar logs:

```typescript
router.post('/request-code', async (req, res) => {
  console.log('üìß Solicitud de c√≥digo recibida');
  console.log('Body:', req.body);
  
  try {
    const { email } = req.body;
    
    if (!email) {
      console.log('‚ùå Email no proporcionado');
      return res.status(400).json({ error: 'Email requerido' });
    }

    console.log('üìß Buscando usuario:', email);
    
    // Verificar si el usuario est√° autorizado
    const usuario = await db.query(
      'SELECT * FROM usuarios_autorizados WHERE email = $1 AND activo = true',
      [email]
    );

    console.log('üë§ Usuario encontrado:', usuario.rows.length > 0);

    if (usuario.rows.length === 0) {
      console.log('‚ùå Usuario no autorizado');
      return res.status(403).json({ error: 'Usuario no autorizado' });
    }

    // Generar c√≥digo
    const codigo = Math.floor(100000 + Math.random() * 900000).toString();
    console.log('üî¢ C√≥digo generado:', codigo);

    // Guardar c√≥digo en BD
    await db.query(`
      INSERT INTO codigos_otp (email, codigo, expira_en, usado)
      VALUES ($1, $2, NOW() + INTERVAL '5 minutes', false)
    `, [email, codigo]);

    console.log('üíæ C√≥digo guardado en BD');

    // Enviar email
    // ... c√≥digo de env√≠o de email ...

    console.log('‚úÖ Proceso completado');
    res.json({ success: true, message: 'C√≥digo enviado' });

  } catch (error: any) {
    console.error('‚ùå ERROR:', error);
    res.status(500).json({ error: 'Error de conexion', details: error.message });
  }
});
```

================================================================================
PASO 5: VERIFICAR CONEXI√ìN A BASE DE DATOS
================================================================================

Agregar verificaci√≥n al inicio del servidor:

```typescript
// En server/index.ts, despu√©s de importar db

async function verificarConexion() {
  try {
    const result = await db.query('SELECT NOW()');
    console.log('‚úÖ Base de datos conectada:', result.rows[0].now);
    
    // Verificar tabla de usuarios
    const usuarios = await db.query('SELECT COUNT(*) FROM usuarios_autorizados');
    console.log('üë• Usuarios autorizados:', usuarios.rows[0].count);
    
  } catch (error: any) {
    console.error('‚ùå Error conectando a BD:', error.message);
  }
}

verificarConexion();
```

================================================================================
PASO 6: VERIFICAR FRONTEND - MANEJO DE ERRORES
================================================================================

En client/pages/Login.tsx, mejorar el manejo de errores:

```tsx
const handleSolicitarCodigo = async () => {
  setError('');
  setLoading(true);

  try {
    console.log('Enviando solicitud a /api/auth/request-code');
    
    const response = await fetch('/api/auth/request-code', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email })
    });

    console.log('Response status:', response.status);
    
    const data = await response.json();
    console.log('Response data:', data);

    if (!response.ok) {
      throw new Error(data.error || data.details || 'Error desconocido');
    }

    setPaso(2); // Ir al paso de ingresar c√≥digo

  } catch (error: any) {
    console.error('Error completo:', error);
    setError(error.message || 'Error de conexion');
  } finally {
    setLoading(false);
  }
};
```

================================================================================
DIAGN√ìSTICO R√ÅPIDO - REVISAR CONSOLA DE REPLIT
================================================================================

1. Abre la consola de Replit
2. Busca errores en rojo
3. Copia y p√©game el error para ayudarte

Errores comunes:
- "ECONNREFUSED" ‚Üí BD no conectada
- "relation does not exist" ‚Üí Tablas no creadas
- "no pg_hba.conf entry" ‚Üí Credenciales BD incorrectas
- "fetch failed" ‚Üí Servidor no responde
- "RESEND_API_KEY" ‚Üí API key de email no configurada

================================================================================
EJECUTAR DIAGN√ìSTICO. PEGAR ERROR DE CONSOLA.
================================================================================
```

¬øPuedes abrir la **consola de Replit** y decirme qu√© error aparece en rojo? Eso me ayudar√° a darte la soluci√≥n exacta.